<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å³æ™‚è‚¡åƒ¹ä¿®å¾©é©—è­‰æ¸¬è©¦ - v1.0.2.0382</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f2f2f2;
        }
        .highlight {
            background-color: #fff3cd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å³æ™‚è‚¡åƒ¹ä¿®å¾©é©—è­‰æ¸¬è©¦ - v1.0.2.0382</h1>
        <p><strong>ä¿®å¾©ç›®æ¨™ï¼š</strong>è§£æ±ºé›²ç«¯ç’°å¢ƒç²å–å‰ä¸€å¤©æ”¶ç›¤åƒ¹è€Œéå³æ™‚åƒ¹æ ¼çš„å•é¡Œ</p>
        <p><strong>ä¿®å¾©æ–¹æ¡ˆï¼š</strong>çµ±ä¸€æœ¬æ©Ÿç«¯å’Œé›²ç«¯çš„è‚¡åƒ¹ç²å–é‚è¼¯ï¼Œå„ªå…ˆä½¿ç”¨ indicators.quote ä¸­çš„å³æ™‚äº¤æ˜“è³‡æ–™</p>
    </div>

    <div class="container">
        <div class="test-section">
            <h3>ğŸ“Š æ¸¬è©¦ 1ï¼šVercel Edge Functions API ä¿®å¾©é©—è­‰</h3>
            <p>æ¸¬è©¦ä¿®å¾©å¾Œçš„ Vercel API æ˜¯å¦èƒ½æ­£ç¢ºç²å–å³æ™‚è‚¡åƒ¹</p>
            <button onclick="testVercelAPI()">æ¸¬è©¦ Vercel API</button>
            <div id="vercel-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”„ æ¸¬è©¦ 2ï¼šæœ¬æ©Ÿç«¯ vs é›²ç«¯é‚è¼¯å°æ¯”</h3>
            <p>å°æ¯”æœ¬æ©Ÿç«¯å’Œé›²ç«¯çš„è‚¡åƒ¹ç²å–é‚è¼¯æ˜¯å¦ä¸€è‡´</p>
            <button onclick="testLogicComparison()">å°æ¯”é‚è¼¯</button>
            <div id="logic-result"></div>
        </div>

        <div class="test-section">
            <h3>â° æ¸¬è©¦ 3ï¼šå¸‚å ´ç‹€æ…‹åˆ¤æ–·</h3>
            <p>æ¸¬è©¦å¸‚å ´ç‹€æ…‹åˆ¤æ–·å’Œåƒ¹æ ¼é¡å‹æ¨™ç¤º</p>
            <button onclick="testMarketState()">æ¸¬è©¦å¸‚å ´ç‹€æ…‹</button>
            <div id="market-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ æ¸¬è©¦ 4ï¼šå¤šæ”¯è‚¡ç¥¨æ‰¹é‡æ¸¬è©¦</h3>
            <p>æ¸¬è©¦å¤šæ”¯è‚¡ç¥¨çš„å³æ™‚è‚¡åƒ¹ç²å–</p>
            <button onclick="testBatchStocks()">æ‰¹é‡æ¸¬è©¦</button>
            <div id="batch-result"></div>
        </div>
    </div>

    <script>
        // æ¸¬è©¦è‚¡ç¥¨åˆ—è¡¨
        const testSymbols = ['2330', '2317', '2454', '0050', '00940', '6188'];

        // æ¸¬è©¦ Vercel Edge Functions API
        async function testVercelAPI() {
            const resultDiv = document.getElementById('vercel-result');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ æ¸¬è©¦ä¸­...</div>';

            try {
                const symbol = '2330';
                const response = await fetch(`https://vercel-stock-api.vercel.app/api/stock-price?symbol=${symbol}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                let html = '<div class="success">âœ… Vercel API æ¸¬è©¦æˆåŠŸ</div>';
                html += `<table class="comparison-table">
                    <tr><th>é …ç›®</th><th>å€¼</th><th>èªªæ˜</th></tr>
                    <tr><td>è‚¡ç¥¨ä»£ç¢¼</td><td>${data.symbol}</td><td>åŸå§‹ä»£ç¢¼</td></tr>
                    <tr><td>å®Œæ•´ä»£ç¢¼</td><td>${data.fullSymbol}</td><td>åŒ…å«å¾Œç¶´</td></tr>
                    <tr><td>è‚¡åƒ¹</td><td>${data.price}</td><td>ç•¶å‰åƒ¹æ ¼</td></tr>
                    <tr><td>æ¼²è·Œ</td><td>${data.change}</td><td>åƒ¹æ ¼è®ŠåŒ–</td></tr>
                    <tr><td>æ¼²è·Œå¹…</td><td>${data.changePercent}%</td><td>ç™¾åˆ†æ¯”è®ŠåŒ–</td></tr>
                    <tr class="highlight"><td>ä¾†æº</td><td>${data.source}</td><td>ä¿®å¾©å¾Œçš„ä¾†æºæ¨™ç¤º</td></tr>
                    <tr><td>å¸‚å ´ç‹€æ…‹</td><td>${data.marketState}</td><td>äº¤æ˜“ç‹€æ…‹</td></tr>
                    <tr><td>æ›´æ–°æ™‚é–“</td><td>${new Date(data.timestamp).toLocaleString('zh-TW')}</td><td>æœ€å¾Œæ›´æ–°</td></tr>
                </table>`;

                // æª¢æŸ¥æ˜¯å¦åŒ…å«å¸‚å ´ç‹€æ…‹è³‡è¨Š
                if (data.marketState) {
                    html += '<div class="success">âœ… ä¿®å¾©æˆåŠŸï¼šåŒ…å«å¸‚å ´ç‹€æ…‹è³‡è¨Š</div>';
                } else {
                    html += '<div class="error">âŒ ç¼ºå°‘å¸‚å ´ç‹€æ…‹è³‡è¨Š</div>';
                }

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ Vercel API æ¸¬è©¦å¤±æ•—: ${error.message}</div>`;
            }
        }

        // æ¸¬è©¦é‚è¼¯å°æ¯”
        async function testLogicComparison() {
            const resultDiv = document.getElementById('logic-result');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ å°æ¯”ä¸­...</div>';

            let html = '<div class="success">âœ… é‚è¼¯å°æ¯”åˆ†æ</div>';
            html += `<table class="comparison-table">
                <tr><th>é …ç›®</th><th>ä¿®å¾©å‰ï¼ˆé›²ç«¯ï¼‰</th><th>ä¿®å¾©å¾Œï¼ˆçµ±ä¸€ï¼‰</th></tr>
                <tr><td>åƒ¹æ ¼ä¾†æº</td><td>åªä½¿ç”¨ meta.regularMarketPrice</td><td class="highlight">å„ªå…ˆä½¿ç”¨ indicators.quote</td></tr>
                <tr><td>å³æ™‚æ€§</td><td>éäº¤æ˜“æ™‚é–“è¿”å›å‰ä¸€å¤©æ”¶ç›¤åƒ¹</td><td class="highlight">äº¤æ˜“æ™‚é–“ç²å–å³æ™‚åƒ¹æ ¼</td></tr>
                <tr><td>åƒ¹æ ¼é¸æ“‡é †åº</td><td>regularMarketPrice â†’ previousClose</td><td class="highlight">close â†’ open â†’ high â†’ low â†’ regularMarketPrice</td></tr>
                <tr><td>å¸‚å ´ç‹€æ…‹</td><td>ç„¡æ¨™ç¤º</td><td class="highlight">é¡¯ç¤º REGULAR/CLOSED/PRE ç‹€æ…‹</td></tr>
                <tr><td>æ—¥èªŒè¨˜éŒ„</td><td>ç°¡å–®</td><td class="highlight">è©³ç´°è¨˜éŒ„å³æ™‚è³‡æ–™ç²å–éç¨‹</td></tr>
            </table>`;

            html += '<div class="info">ğŸ“ ä¿®å¾©é‡é»ï¼šçµ±ä¸€æœ¬æ©Ÿç«¯å’Œé›²ç«¯ä½¿ç”¨ç›¸åŒçš„è‚¡åƒ¹ç²å–é‚è¼¯</div>';

            resultDiv.innerHTML = html;
        }

        // æ¸¬è©¦å¸‚å ´ç‹€æ…‹åˆ¤æ–·
        async function testMarketState() {
            const resultDiv = document.getElementById('market-result');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ æ¸¬è©¦ä¸­...</div>';

            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            const currentTime = hour * 60 + minute;
            const marketOpen = 9 * 60; // 09:00
            const marketClose = 13 * 60 + 30; // 13:30
            const isMarketHours = currentTime >= marketOpen && currentTime <= marketClose;
            const isWeekday = now.getDay() >= 1 && now.getDay() <= 5;
            const isMarketOpen = isMarketHours && isWeekday;

            let html = '<div class="success">âœ… å¸‚å ´ç‹€æ…‹åˆ¤æ–·</div>';
            html += `<table class="comparison-table">
                <tr><th>é …ç›®</th><th>å€¼</th><th>èªªæ˜</th></tr>
                <tr><td>ç•¶å‰æ™‚é–“</td><td>${now.toLocaleString('zh-TW')}</td><td>ç³»çµ±æ™‚é–“</td></tr>
                <tr><td>äº¤æ˜“æ™‚é–“</td><td>09:00 - 13:30</td><td>å°è‚¡äº¤æ˜“æ™‚é–“</td></tr>
                <tr><td>æ˜¯å¦äº¤æ˜“æ™‚é–“</td><td>${isMarketHours ? 'æ˜¯' : 'å¦'}</td><td>æ™‚é–“ç¯„åœåˆ¤æ–·</td></tr>
                <tr><td>æ˜¯å¦å·¥ä½œæ—¥</td><td>${isWeekday ? 'æ˜¯' : 'å¦'}</td><td>é€±ä¸€åˆ°é€±äº”</td></tr>
                <tr class="highlight"><td>å¸‚å ´ç‹€æ…‹</td><td>${isMarketOpen ? 'é–‹å¸‚' : 'ä¼‘å¸‚'}</td><td>ç¶œåˆåˆ¤æ–·</td></tr>
                <tr><td>åƒ¹æ ¼é¡å‹</td><td>${isMarketOpen ? 'å³æ™‚åƒ¹' : 'æ”¶ç›¤åƒ¹'}</td><td>æ ¹æ“šå¸‚å ´ç‹€æ…‹</td></tr>
            </table>`;

            resultDiv.innerHTML = html;
        }

        // æ‰¹é‡æ¸¬è©¦å¤šæ”¯è‚¡ç¥¨
        async function testBatchStocks() {
            const resultDiv = document.getElementById('batch-result');
            resultDiv.innerHTML = '<div class="info">ğŸ”„ æ‰¹é‡æ¸¬è©¦ä¸­...</div>';

            let html = '<div class="success">âœ… æ‰¹é‡è‚¡åƒ¹æ¸¬è©¦</div>';
            html += `<table class="comparison-table">
                <tr><th>è‚¡ç¥¨ä»£ç¢¼</th><th>è‚¡åƒ¹</th><th>æ¼²è·Œ</th><th>ä¾†æº</th><th>ç‹€æ…‹</th></tr>`;

            for (const symbol of testSymbols) {
                try {
                    const response = await fetch(`https://vercel-stock-api.vercel.app/api/stock-price?symbol=${symbol}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        html += `<tr>
                            <td>${data.symbol}</td>
                            <td>${data.price}</td>
                            <td style="color: ${data.change >= 0 ? 'green' : 'red'}">${data.change >= 0 ? '+' : ''}${data.change}</td>
                            <td>${data.source}</td>
                            <td style="color: green">âœ… æˆåŠŸ</td>
                        </tr>`;
                    } else {
                        html += `<tr>
                            <td>${symbol}</td>
                            <td colspan="3">HTTP ${response.status}</td>
                            <td style="color: red">âŒ å¤±æ•—</td>
                        </tr>`;
                    }
                } catch (error) {
                    html += `<tr>
                        <td>${symbol}</td>
                        <td colspan="3">${error.message}</td>
                        <td style="color: red">âŒ éŒ¯èª¤</td>
                    </tr>`;
                }

                // æ·»åŠ å°å»¶é²é¿å…éæ–¼é »ç¹çš„è«‹æ±‚
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            html += '</table>';
            html += '<div class="info">ğŸ“Š æ¸¬è©¦å®Œæˆï¼šé©—è­‰ä¿®å¾©å¾Œçš„ Vercel API ç©©å®šæ€§</div>';

            resultDiv.innerHTML = html;
        }

        // é é¢è¼‰å…¥æ™‚é¡¯ç¤ºåŸºæœ¬è³‡è¨Š
        window.onload = function() {
            console.log('ğŸ”§ å³æ™‚è‚¡åƒ¹ä¿®å¾©é©—è­‰æ¸¬è©¦ - v1.0.2.0382');
            console.log('ä¿®å¾©å…§å®¹ï¼šçµ±ä¸€æœ¬æ©Ÿç«¯å’Œé›²ç«¯è‚¡åƒ¹ç²å–é‚è¼¯');
            console.log('æ¸¬è©¦ç›®æ¨™ï¼šé©—è­‰é›²ç«¯ç’°å¢ƒèƒ½æ­£ç¢ºç²å–å³æ™‚è‚¡åƒ¹');
        };
    </script>
</body>
</html>