# Stock Portfolio System Requirements Document

## 簡介

Stock Portfolio System is a web-based stock portfolio management application designed to help individual investors track stock holdings, price changes, dividend income, and investment performance across multiple accounts. The system integrates real-time stock price APIs, provides real-time price updates, comprehensive dividend management features, and cross-device data synchronization capabilities.

## 詞彙表

- **系統 (System)**: Stock Portfolio System web application
- **使用者 (User)**: 使用本系統管理股票投資組合的個人投資者
- **股票記錄 (Stock Record)**: 包含股票代碼、名稱、持股數、成本價等資訊的單筆股票持股資料
- **帳戶 (Account)**: 用於分類管理不同券商或投資帳戶的股票群組
- **股息記錄 (Dividend Record)**: 記錄股票配息的詳細資料，包含除息日期、每股股息金額等
- **調整成本價 (Adjusted Cost Price)**: 扣除已收股息後的實際成本價格
- **股價API (Stock Price API)**: 提供即時股價資料的外部服務介面，優先使用台灣證券交易所官方API
- **證交所API (TWSE API)**: 台灣證券交易所官方股價資料介面
- **響應式設計 (Responsive Design)**: 能夠適應不同螢幕尺寸和裝置類型的使用者介面設計
- **本地儲存 (Local Storage)**: 瀏覽器localStorage機制
- **雲端同步 (Cloud Sync)**: 透過GitHub Gist進行跨裝置資料同步的功能
- **隱私模式 (Privacy Mode)**: 隱藏敏感金額資訊的顯示模式
- **模態框 (Modal)**: 彈出式對話框介面元件
- **ETF代碼格式 (ETF Code Format)**: 台灣ETF的各種代碼格式，包含5位數字（如00646）和6位數字加字母（如00981A、00679B）等格式
- **股票代碼驗證 (Stock Code Validation)**: 驗證輸入的股票代碼是否符合台灣證券市場的標準格式規範
- **文字對齊 (Text Alignment)**: 介面中文字元素的對齊方式，影響視覺平衡和使用者體驗
- **匯出 (Export)**: 將系統資料轉換為外部檔案格式的功能
- **匯入 (Import)**: 從外部檔案讀取資料並載入到系統的功能
- **資料格式 (Data Format)**: 匯入匯出支援的檔案格式，如JSON、CSV、Excel等

## 需求

### 需求 1 - 股票投資組合管理

**使用者故事：** 作為一個投資者，我想要管理我的股票投資組合，以便追蹤我的持股狀況和投資績效。

#### 驗收標準

1. WHEN 使用者輸入股票代碼、名稱、持股數、成本價和購買日期 THEN 系統 SHALL 建立新的股票記錄並儲存至指定帳戶
2. WHEN 使用者輸入4位數以上的股票代碼 THEN 系統 SHALL 自動查詢並填入對應的股票名稱
3. WHEN 使用者輸入ETF代碼（包含00981A、00679B等6位數字加字母格式） THEN 系統 SHALL 正確識別並查詢對應的ETF資訊
4. WHEN 使用者選擇刪除股票記錄 THEN 系統 SHALL 顯示確認對話框並在確認後移除該記錄
5. WHEN 使用者點擊股票記錄的持股數或成本價欄位 THEN 系統 SHALL 提供即時編輯功能
6. WHEN 使用者新增已存在的股票代碼至同一帳戶 THEN 系統 SHALL 詢問是否合併持股或建立獨立記錄

### 需求 2 - 多帳戶管理系統

**使用者故事：** 作為一個在多個券商開戶的投資者，我想要分別管理不同帳戶的股票，以便清楚區分各帳戶的投資狀況。

#### 驗收標準

1. WHEN 系統初始化 THEN 系統 SHALL 提供預設的「帳戶1」和「帳戶2」
2. WHEN 使用者輸入新帳戶名稱 THEN 系統 SHALL 建立新帳戶並加入帳戶清單
3. WHEN 使用者選擇刪除帳戶且該帳戶包含股票記錄 THEN 系統 SHALL 警告資料將遺失並要求確認
4. WHEN 使用者重新命名帳戶 THEN 系統 SHALL 更新帳戶名稱並同步更新所有相關股票記錄的帳戶歸屬
5. WHEN 使用者點擊帳戶標籤 THEN 系統 SHALL 切換顯示該帳戶的股票清單和統計資料

### 需求 3 - 即時股價更新系統

**使用者故事：** 作為一個投資者，我想要獲得來自台灣證交所的官方即時股價資訊，以便了解我的投資組合當前市值和損益狀況。

#### 驗收標準

1. WHEN 系統載入完成 THEN 系統 SHALL 優先使用台灣證券交易所官方API獲取股價資料
2. WHEN 證交所API無法取得資料 THEN 系統 SHALL 依序嘗試Yahoo Finance和Investing.com作為備用來源
3. WHEN 股價API回應成功 THEN 系統 SHALL 更新股票記錄的現價、資料來源標示和最後更新時間
4. WHEN 使用者點擊全域更新按鈕 THEN 系統 SHALL 立即從證交所API更新所有股票的股價
5. WHEN 非交易時間或證交所API維護 THEN 系統 SHALL 自動切換至備用API並顯示資料來源提示

### 需求 4 - 完整股息管理功能

**使用者故事：** 作為一個存股投資者，我想要追蹤股息收入並自動調整成本價，以便計算真實的投資報酬率。

#### 驗收標準

1. WHEN 使用者新增股票記錄並輸入購買日期 THEN 系統 SHALL 根據內建股息資料庫自動計算該股票的歷史應得股息
2. WHEN 系統計算歷史股息 THEN 系統 SHALL 僅計算購買日期之後的除息記錄
3. WHEN 使用者新增股息記錄 THEN 系統 SHALL 儲存股息資料並重新計算調整成本價
4. WHEN 啟用股息調整成本價功能 THEN 系統 SHALL 從原始成本價扣除每股累計股息得出調整成本價
5. WHEN 使用者查看股息管理介面 THEN 系統 SHALL 顯示總股息收入、年度股息收入和平均殖利率統計

### 需求 5 - 投資績效計算與顯示

**使用者故事：** 作為一個投資者，我想要清楚看到每支股票和整體投資組合的績效表現，以便評估投資決策的成效。

#### 驗收標準

1. WHEN 系統顯示股票清單 THEN 系統 SHALL 計算並顯示每支股票的市值、損益金額和損益率
2. WHEN 計算損益 THEN 系統 SHALL 使用調整成本價（如有股息調整）作為計算基準
3. WHEN 系統顯示總報酬欄位 THEN 系統 SHALL 將資本利得和股息收入合併計算總報酬
4. WHEN 使用者切換帳戶 THEN 系統 SHALL 更新該帳戶的總市值、今日變化和整體統計資料
5. WHEN 股價或持股數變更 THEN 系統 SHALL 即時重新計算所有相關的績效指標

### 需求 6 - 隱私保護功能

**使用者故事：** 作為一個注重隱私的使用者，我想要能夠隱藏敏感的金額資訊，以便在公共場所或與他人分享螢幕時保護我的財務隱私。

#### 驗收標準

1. WHEN 系統初始化 THEN 系統 SHALL 預設啟用總市值隱私模式並顯示星號遮罩
2. WHEN 使用者點擊總市值旁的隱私按鈕 THEN 系統 SHALL 切換總市值的顯示/隱藏狀態
3. WHEN 啟用隱私模式 THEN 系統 SHALL 將金額顯示替換為星號符號（******）
4. WHEN 切換隱私模式 THEN 系統 SHALL 顯示隱私狀態提示訊息並在3秒後自動隱藏
5. WHEN 隱私模式變更 THEN 系統 SHALL 更新隱私按鈕的圖示以反映當前狀態

### 需求 7 - 響應式使用者介面與跨裝置體驗

**使用者故事：** 作為一個使用者，我想要在手機和電腦上都能獲得最佳的使用體驗，並且希望介面簡潔乾淨以專注於股票資訊，以便隨時隨地高效管理我的投資組合。

#### 驗收標準

1. WHEN 系統初始載入 THEN 系統 SHALL 預設隱藏功能選單並將版面重點放在股票清單和投資組合資訊
2. WHEN 使用者點擊選單按鈕或漢堡圖示 THEN 系統 SHALL 展開功能選單並提供所有操作選項
3. WHEN 使用者在手機裝置開啟系統 THEN 系統 SHALL 提供專為觸控優化的隱藏式選單和適當的按鈕尺寸
4. WHEN 使用者在桌面電腦開啟系統 THEN 系統 SHALL 充分利用大螢幕空間顯示股票資訊並提供可收合的側邊功能面板
5. WHEN 螢幕寬度小於768px THEN 系統 SHALL 自動切換為行動版佈局並將所有功能按鈕收納至隱藏選單

### 需求 8 - 資料儲存與同步

**使用者故事：** 作為一個多裝置使用者，我想要我的投資資料能夠安全儲存並在不同裝置間同步，以便隨時隨地存取我的投資組合資訊。

#### 驗收標準

1. WHEN 使用者進行任何資料變更 THEN 系統 SHALL 自動將資料儲存至瀏覽器本地儲存
2. WHEN 使用者設定GitHub Token THEN 系統 SHALL 啟用雲端同步功能並建立GitHub Gist
3. WHEN 雲端同步啟用 THEN 系統 SHALL 在資料變更時自動上傳至雲端並顯示同步狀態
4. WHEN 使用者在新裝置開啟系統 THEN 系統 SHALL 提供從雲端下載資料的選項
5. WHEN 本地資料與雲端資料衝突 THEN 系統 SHALL 提供選擇保留本地或雲端資料的選項

### 需求 9 - 系統穩定性與錯誤處理

**使用者故事：** 作為一個使用者，我希望系統能夠穩定運行並在發生錯誤時提供清楚的提示，以便我能夠順利完成投資管理任務。

#### 驗收標準

1. WHEN 股價API請求失敗 THEN 系統 SHALL 嘗試備用API並在所有來源都失敗時保持上次價格
2. WHEN 使用者輸入無效資料 THEN 系統 SHALL 顯示具體的錯誤訊息並阻止提交
3. WHEN 系統發生JavaScript錯誤 THEN 系統 SHALL 記錄錯誤資訊並嘗試恢復正常運作
4. WHEN 本地儲存空間不足 THEN 系統 SHALL 警告使用者並建議清理舊資料或啟用雲端同步
5. WHEN 網路連線中斷 THEN 系統 SHALL 顯示離線狀態並在連線恢復時自動重試失敗的操作

### 需求 10 - 系統效能與最佳化

**使用者故事：** 作為一個使用者，我希望系統能夠快速回應並有效利用系統資源，以便提供流暢的使用體驗。

#### 驗收標準

1. WHEN 系統載入 THEN 系統 SHALL 在3秒內完成初始化並顯示使用者介面
2. WHEN 股價更新執行 THEN 系統 SHALL 使用批次請求以減少API呼叫次數
3. WHEN 使用者進行資料操作 THEN 系統 SHALL 在500毫秒內提供視覺回饋
4. WHEN 系統處理大量股票資料 THEN 系統 SHALL 使用虛擬滾動或分頁以維持介面流暢度
5. WHEN 使用者長時間未操作 THEN 系統 SHALL 暫停自動股價更新以節省資源

### 需求 11 - 跨裝置UI適配與互動最佳化

**使用者故事：** 作為一個使用者，我想要在不同裝置上都能獲得直觀易用的介面和良好的互動體驗，並且希望版面保持簡潔以突出重要的股票資訊，以便高效地管理我的投資組合。

#### 驗收標準

1. WHEN 使用者點擊功能選單外的區域 THEN 系統 SHALL 自動收合功能選單以保持版面整潔
2. WHEN 使用者完成功能操作（如新增股票） THEN 系統 SHALL 自動隱藏功能選單並返回股票清單主畫面
3. WHEN 使用者旋轉行動裝置 THEN 系統 SHALL 自動調整介面佈局並維持功能選單的隱藏狀態
4. WHEN 使用者在觸控裝置上操作 THEN 系統 SHALL 提供適當的觸控回饋和手勢支援（如滑動收合選單）
5. WHEN 使用者使用鍵盤導航 THEN 系統 SHALL 支援ESC鍵關閉選單和Tab鍵在股票清單間導航

### 需求 12 - 簡潔介面設計與資訊呈現最佳化

**使用者故事：** 作為一個投資者，我想要有一個簡潔乾淨的介面來專注查看股票資訊，並且能夠快速存取所需功能，以便更有效率地分析我的投資組合。

#### 驗收標準

1. WHEN 系統顯示主畫面 THEN 系統 SHALL 將80%以上的螢幕空間用於顯示股票清單和投資統計資訊
2. WHEN 使用者開啟新增股票功能 THEN 系統 SHALL 顯示模態框並自動聚焦到股票代碼輸入欄位
3. WHEN 使用者點擊表格中的可編輯欄位 THEN 系統 SHALL 提供即時編輯功能並顯示編輯圖示提示
4. WHEN 系統執行長時間操作 THEN 系統 SHALL 顯示載入指示器並在完成後提供回饋訊息
5. WHEN 功能選單展開時 THEN 系統 SHALL 使用半透明遮罩突出選單並淡化背景股票資訊以避免干擾

### 需求 14 - UI設計改進與使用者體驗優化

**使用者故事：** 作為一個使用者，我想要有更好的視覺設計和使用者體驗，包括適當的文字對齊和更直觀的介面元素，以便更舒適地使用系統。

#### 驗收標準

1. WHEN 系統顯示標題列 THEN 系統 SHALL 使用適當的文字對齊方式以提供最佳的視覺平衡
2. WHEN 使用者查看主介面 THEN 系統 SHALL 確保所有文字元素都有適當的對齊和間距
3. WHEN 系統顯示股票代碼輸入欄位 THEN 系統 SHALL 支援所有有效的台灣股票和ETF代碼格式
4. WHEN 使用者輸入特殊格式的ETF代碼（如00981A、00679B、00646L等） THEN 系統 SHALL 正確驗證並處理這些代碼
5. WHEN 系統進行股票代碼驗證 THEN 系統 SHALL 支援4位數字、5位數字、6位數字加字母等所有台灣市場的標準格式

### 需求 13 - 資料匯入匯出功能

**使用者故事：** 作為一個投資者，我想要能夠匯出我的投資組合資料進行備份或分析，並且能夠匯入外部資料來快速建立投資組合，以便更靈活地管理我的投資資料。

#### 驗收標準

1. WHEN 使用者選擇匯出功能 THEN 系統 SHALL 提供選擇匯出範圍的選項（全部帳戶或指定帳戶）
2. WHEN 使用者選擇匯出特定帳戶 THEN 系統 SHALL 僅匯出該帳戶的股票記錄和相關資料
3. WHEN 使用者選擇匯出格式 THEN 系統 SHALL 支援JSON、CSV和Excel格式的資料匯出
4. WHEN 使用者匯入資料檔案 THEN 系統 SHALL 驗證檔案格式並顯示匯入預覽
5. WHEN 匯入資料與現有資料衝突 THEN 系統 SHALL 提供選擇覆蓋、合併或跳過的處理選項
