---
inclusion: always
---

# 版本號管理規範

## 版本號格式

Stock Portfolio System 採用四碼版本控制，格式為：

```
v{MAJOR}.{MINOR}.{RELEASE}.{PATCH}
```

### 版本號組成

- **MAJOR（主版本號）**：當進行不相容的 API 修改時遞增
- **MINOR（次版本號）**：當新增向下相容的功能時遞增  
- **RELEASE（發布號）**：Release or upload to GitHub 時遞增
- **PATCH（修訂版本號）**：當進行向下相容的問題修正時遞增

### 版本號範例

- `v1.0.0.0001` - 首次正式發布
- `v1.0.0.0002` - 錯誤修正
- `v1.0.1.0001` - 新功能發布
- `v1.1.0.0001` - 次版本功能更新
- `v2.0.0.0001` - 重大更新，可能不向下相容

## 版本號更新原則

### MAJOR 版本更新（主版本）

**觸發條件**：
- 重大架構變更
- 不向下相容的 API 修改
- 資料格式重大變更
- 使用者介面重大改版

**範例**：
- 從 React 遷移到 Vue
- 資料庫結構重大變更
- 完全重新設計的使用者介面

### MINOR 版本更新（次版本）

**觸發條件**：
- 新增功能模組
- 新增 API 端點
- 效能顯著改善
- 新增設定選項

**範例**：
- 新增股息管理功能
- 新增資料匯出格式
- 新增圖表顯示功能
- 新增多語言支援

### RELEASE 版本更新（發布號）

**觸發條件**：
- 發布到 GitHub Repository
- 建立 Release 標籤
- 部署到生產環境
- 建立發布包

**範例**：
- 將開發版本發布到 GitHub
- 建立正式發布版本
- 部署更新到伺服器

### PATCH 版本更新（修訂版本）

**觸發條件**：
- 錯誤修正
- 安全性修補
- 文件更新
- 小幅 UI 調整
- 效能微調
- **任何程式碼修改或調整**

**範例**：
- 修正計算錯誤
- 修正 UI 顯示問題
- 修正資料驗證邏輯
- 更新相依套件版本
- 調整樣式或佈局
- 修改文字內容
- 新增註解或文件
- 配置檔案修改

**⚠️ 重要規則**：
- **每一次的程式碼修改或調整都必須更新第四碼（PATCH）**
- **無論修改大小，都需要遞增 PATCH 版本號**
- **這包括但不限於：程式碼變更、樣式調整、文件修改、配置更新**
- **開發過程中的每個 commit 都應該對應一個新的 PATCH 版本**

**範例**：
- 修正計算錯誤
- 修正 UI 顯示問題
- 修正資料驗證邏輯
- 更新相依套件版本

## 版本號顯示規範

### 顯示位置

版本號必須顯示在應用程式的以下位置：

1. **主畫面底部**：`Stock Portfolio System v{version}`
2. **關於頁面**：完整版本資訊
3. **設定頁面**：版本號和建置資訊

### 顯示格式

```typescript
// 主畫面顯示
<p className="text-sm text-slate-500">
  Stock Portfolio System v{version}
</p>

// 詳細版本資訊
interface VersionInfo {
  version: string;        // "1.0.0.0003"
  buildDate: string;      // "2024-01-08"
  commitHash: string;     // "a1b2c3d"
  environment: string;    // "production" | "development"
}
```

## 版本號管理流程

### 開發階段

**自動版本更新規則**：
1. **每次程式碼修改**：自動遞增 PATCH 版本號（第四碼）
2. **版本更新時機**：
   - 完成任何程式碼修改後
   - 提交 commit 之前
   - 測試完成後
3. **自動執行項目**：
   - 更新 `src/constants/version.ts` 中的 PATCH 值
   - 同步更新 UI 顯示
   - 確保版本號一致性

**開發流程**：
1. **功能開發**：在 `package.json` 和版本常數中維護版本號
2. **測試階段**：使用預發布版本號（如 `v1.1.0.0001-beta.1`）
3. **發布準備**：確認版本號符合變更內容，**需要用戶明確同意**

### 發布流程

**⚠️ 重要：正式發布授權規則**
- **正式發布或上傳到 GitHub 需要用戶明確同意**
- **開發者不得在未經用戶同意的情況下進行正式發布**
- **RELEASE 版本號的更新必須經過用戶確認**

1. **更新版本號**：
   ```bash
   # 開發過程中的修改（自動執行）
   npm version patch    # 修訂版本 (1.0.0.0001 -> 1.0.0.0002)
   
   # 需要用戶同意的發布（需明確授權）
   npm version prerelease --preid=release  # 發布版本 (1.0.0.0001 -> 1.0.1.0001)
   npm version minor    # 次版本 (1.0.0.0001 -> 1.1.0.0001)
   npm version major    # 主版本 (1.0.0.0001 -> 2.0.0.0001)
   ```

2. **發布前確認**：
   - 向用戶說明發布內容和變更
   - 等待用戶明確同意
   - 確認發布範圍和影響

3. **更新顯示**：同步更新 UI 中的版本顯示

4. **建立標籤**：在 Git 中建立對應的版本標籤

5. **發布記錄**：更新 CHANGELOG.md

## 版本號在程式碼中的使用

### 版本常數定義

```typescript
// src/constants/version.ts
export const VERSION = {
  MAJOR: 1,
  MINOR: 0,
  RELEASE: 0,
  PATCH: 3,
  get FULL() {
    return `${this.MAJOR}.${this.MINOR}.${this.RELEASE}.${this.PATCH.toString().padStart(4, '0')}`;
  },
  get DISPLAY() {
    return `v${this.FULL}`;
  }
};
```

### 版本檢查機制

```typescript
// 檢查版本相容性
export function isVersionCompatible(requiredVersion: string, currentVersion: string): boolean {
  // 實作版本相容性檢查邏輯
}
```

## 強制性版本管理規則

### 🔴 必須執行的規則

1. **每次修改必須更新版本**：
   - 任何程式碼修改、樣式調整、文件更新都必須遞增 PATCH 版本號
   - 不允許在不更新版本號的情況下進行任何修改
   - 版本號更新是開發流程的必要步驟

2. **發布授權要求**：
   - 正式發布（RELEASE、MINOR、MAJOR）需要用戶明確同意
   - 開發者不得擅自進行正式發布
   - 必須向用戶說明發布內容並獲得授權

3. **版本號同步**：
   - 所有顯示版本號的位置必須保持一致
   - 修改版本號後必須同步更新所有相關檔案
   - 使用統一的版本常數管理

### 🟡 開發者執行檢查清單

每次修改後必須執行：
- [ ] 遞增 PATCH 版本號（第四碼）
- [ ] 更新 `src/constants/version.ts`
- [ ] 確認 UI 顯示版本號正確
- [ ] 測試版本號顯示功能
- [ ] 記錄變更內容

正式發布前必須執行：
- [ ] 獲得用戶明確同意
- [ ] 確認發布範圍和影響
- [ ] 更新 CHANGELOG.md
- [ ] 建立 Git 標籤
- [ ] 完成發布測試

## 注意事項

1. **版本號一致性**：確保所有顯示位置的版本號保持一致
2. **自動化更新**：建議使用自動化工具同步更新版本號
3. **向下相容性**：MINOR 和 PATCH 更新必須保持向下相容
4. **文件同步**：版本更新時同步更新相關文件
5. **測試覆蓋**：每次版本更新都應進行完整測試

## 版本發布檢查清單

- [ ] 版本號符合語義化版本控制規範
- [ ] 所有顯示位置的版本號已更新
- [ ] CHANGELOG.md 已更新
- [ ] 相關文件已同步更新
- [ ] 測試通過
- [ ] Git 標籤已建立
- [ ] 發布說明已準備