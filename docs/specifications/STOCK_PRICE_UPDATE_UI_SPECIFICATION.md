# 股價更新 UI 規格文件 (Stock Price Update UI Specification)

## 🎯 核心要求

### 用戶體驗原則
- ✅ **進度可見性**：用戶必須能清楚看到更新進度
- ✅ **Console 簡潔**：避免過多 debug 日誌干擾
- ✅ **狀態反饋**：提供明確的開始、進行中、完成狀態
- ✅ **錯誤處理**：清楚顯示失敗的股票和原因

## 📊 進度顯示規範

### 必須顯示的信息
1. **當前進度**：`更新進度 X/Y: 股票代號`
2. **成功狀態**：`✅ 股票代號 更新完成 (價格)`
3. **失敗狀態**：`❌ 股票代號 更新失敗: 原因`
4. **最終統計**：`批量股價更新完成: 成功 X 支，失敗 Y 支，總計 Z 支`

### 日誌等級規範
```typescript
// ✅ 必須顯示 (INFO 等級)
logger.info('stock', `更新進度 ${current}/${total}: ${symbol}`);
logger.info('stock', `✅ ${symbol} 更新完成 (${price})`);
logger.info('stock', `批量股價更新完成`, { success, fail, total });

// ⚠️ 警告信息 (WARN 等級)
logger.warn('stock', `❌ ${symbol} 更新失敗: ${reason}`);

// ❌ 禁止顯示 (DEBUG 等級 - 已註解)
// logger.debug('stock', `開始更新 ${symbol} 股價`);
// logger.debug('stock', `${symbol} 後端代理獲取結果`);
// logger.debug('stock', `${symbol} Vercel Edge Functions 獲取結果`);
```

## 🚫 禁止的日誌輸出

### 過度詳細的 Debug 信息
- ❌ API 調用詳細結果
- ❌ 每個步驟的中間狀態
- ❌ 服務導入成功信息
- ❌ 除權息處理的詳細過程

### 重複或冗餘信息
- ❌ 相同信息的多次輸出
- ❌ 過長的物件內容輸出
- ❌ 不必要的成功確認

## 📱 UI 組件規範

### 更新按鈕狀態
```typescript
// 更新中狀態
<Button disabled={isUpdatingPrices} className="opacity-75">
  {isUpdatingPrices ? '更新中...' : '更新股價'}
</Button>

// 進度顯示 (如果有 UI 進度條)
{isUpdatingPrices && (
  <div className="text-xs text-slate-400">
    {priceUpdateProgress.current}/{priceUpdateProgress.total}
  </div>
)}
```

### 狀態指示器
- **待機狀態**：更新圖示正常顯示
- **更新中**：圖示旋轉動畫 + 半透明
- **完成狀態**：短暫的成功指示（可選）

## 🔧 實作檢查清單

### 開發時必須確認
- [ ] 進度信息使用 `logger.info` 等級
- [ ] 每支股票顯示 `X/Y: 股票代號` 格式
- [ ] 成功更新顯示價格信息
- [ ] 失敗更新顯示具體原因
- [ ] 最終統計包含成功/失敗/總計數量
- [ ] Debug 日誌已註解或移除
- [ ] Console 輸出簡潔易讀

### 測試檢查
- [ ] 更新 1 支股票時進度顯示正確
- [ ] 更新多支股票時進度遞增
- [ ] 網路錯誤時顯示失敗信息
- [ ] 全部成功時統計正確
- [ ] 部分失敗時統計正確

## 💡 最佳實踐

### 進度信息設計
1. **簡潔明確**：`更新進度 5/23: 2330` 比 `開始更新台積電股價...` 更好
2. **狀態清楚**：使用 ✅ ❌ 等符號快速識別結果
3. **統計完整**：最終提供完整的成功/失敗統計

### 錯誤處理
1. **具體原因**：顯示具體的失敗原因而非通用錯誤
2. **不中斷流程**：單支股票失敗不影響其他股票更新
3. **用戶友好**：錯誤信息要讓用戶能理解和採取行動

### 性能考量
1. **批次處理**：避免過於頻繁的 UI 更新
2. **適當延遲**：API 調用間加入適當間隔
3. **記憶體管理**：避免累積過多日誌信息

## 🎯 用戶體驗目標

### 理想的更新流程
```
[INFO] 開始批量更新：股價 + 除權息
[INFO] 更新進度 1/23: 2330
[INFO] ✅ 2330 更新完成 (1760.0)
[INFO] 更新進度 2/23: 2886
[INFO] ✅ 2886 更新完成 (40.55)
[INFO] 更新進度 3/23: 6188
[WARN] ❌ 6188 更新失敗: 網路連線超時
...
[INFO] 批量股價更新完成: 成功 22 支，失敗 1 支，總計 23 支
[INFO] 批量更新完成
```

### 避免的輸出
```
❌ [DEBUG] 開始更新 2330 股價
❌ [DEBUG] 2330 後端代理獲取結果 {price: 1760, source: "Yahoo"}
❌ [DEBUG] 準備更新股價: 1760
❌ [DEBUG] 批量更新: 開始處理 2330 的除權息資料
❌ [DEBUG] RightsEventService 導入成功
❌ [DEBUG] 2330: 檢查除權息資料...
❌ [DEBUG] 2330 除權息處理完成，結果: {...}
```

---

**制定日期**: 2026-01-31  
**版本**: 1.0.0  
**觸發原因**: 用戶反饋更新時進度不見了，需要平衡進度可見性和 Console 簡潔性  
**目標**: 提供清楚的更新進度同時保持 Console 輸出簡潔