# Stock Portfolio System å®Œæ•´è¦æ ¼æ–‡æª”

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

### åŸºæœ¬è³‡è¨Š
- **å°ˆæ¡ˆåç¨±**: Stock Portfolio System
- **ç•¶å‰ç‰ˆæœ¬**: v1.0.2.0365
- **é¡å‹**: ç¾ä»£åŒ–è‚¡ç¥¨æŠ•è³‡çµ„åˆç®¡ç†ç³»çµ±
- **æŠ€è¡“æ£§**: React 18 + TypeScript + Vite + Zustand + TailwindCSS
- **ç›®æ¨™ç”¨æˆ¶**: å€‹äººæŠ•è³‡è€…ã€è‚¡ç¥¨äº¤æ˜“å“¡
- **éƒ¨ç½²ç’°å¢ƒ**: æœ¬æ©Ÿç«¯é–‹ç™¼ + é›²ç«¯ç”Ÿç”¢ç’°å¢ƒ + Vercel Edge Functions

### å°ˆæ¡ˆç›®æ¨™
æä¾›ä¸€å€‹åŠŸèƒ½å®Œæ•´ã€ç”¨æˆ¶å‹å¥½çš„è‚¡ç¥¨æŠ•è³‡çµ„åˆç®¡ç†ç³»çµ±ï¼Œæ”¯æ´å¤šå¸³æˆ¶ç®¡ç†ã€å³æ™‚è‚¡åƒ¹æ›´æ–°ã€é™¤æ¬Šæ¯è¨ˆç®—ã€é›²ç«¯åŒæ­¥ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç³»çµ±è¨­è¨ˆç‚ºæœ¬æ©Ÿç«¯å’Œé›²ç«¯é›™ç’°å¢ƒé‹è¡Œï¼Œç¢ºä¿åœ¨ä¸åŒç’°å¢ƒä¸‹éƒ½èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ¶é«”é©—ã€‚

### ğŸ†• v1.0.2.0365 æœ€æ–°åŠŸèƒ½
- **GitHub Actions ä¿®å¾©**: ä¿®å¾©è‡ªå‹•æ›´æ–°å·¥ä½œæµç¨‹ï¼Œå®Œå–„éŒ¯èª¤è™•ç†
- **Stock List çµ±ä¸€ç®¡ç†**: æœ¬æ©Ÿç’°å¢ƒè·³éå¾Œç«¯æª¢æŸ¥ï¼Œè§£æ±º 503 éŒ¯èª¤
- **æœ€æ–°è‚¡ç¥¨è³‡æ–™**: æ›´æ–°åˆ° 1/29 è³‡æ–™ï¼ˆ4056æ”¯è‚¡ç¥¨ï¼‰
- **è¦æ ¼æ–‡æª”å®Œå–„**: æ›´æ–°æŠ€è¡“æ£§èªªæ˜å’Œæ ¸å¿ƒåŠŸèƒ½æè¿°

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æ•´é«”æ¶æ§‹åœ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Stock Portfolio System                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯æ‡‰ç”¨ (React + TypeScript + Vite + Zustand)            â”‚
â”‚  â”œâ”€â”€ ç”¨æˆ¶ä»‹é¢å±¤ (UI Components)                             â”‚
â”‚  â”œâ”€â”€ ç‹€æ…‹ç®¡ç†å±¤ (Zustand Store)                            â”‚
â”‚  â”œâ”€â”€ æœå‹™å±¤ (API Services)                                 â”‚
â”‚  â””â”€â”€ å·¥å…·å±¤ (Utils & Helpers)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ç’°å¢ƒé©é…å±¤                                â”‚
â”‚  â”œâ”€â”€ æœ¬æ©Ÿç«¯ç’°å¢ƒ (localhost:5173)                           â”‚
â”‚  â””â”€â”€ é›²ç«¯ç’°å¢ƒ (GitHub Pages / Netlify)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å¾Œç«¯æœå‹™å±¤                                â”‚
â”‚  â”œâ”€â”€ æœ¬æ©Ÿç«¯å¾Œç«¯ (Node.js Express - localhost:3001)        â”‚
â”‚  â”œâ”€â”€ Netlify Functions (é›²ç«¯ç„¡æœå‹™å™¨å‡½æ•¸)                   â”‚
â”‚  â””â”€â”€ å¤–éƒ¨ API æœå‹™                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    è³‡æ–™ä¾†æºå±¤                                â”‚
â”‚  â”œâ”€â”€ Vercel Edge Functions (ä¼æ¥­ç´šè‚¡åƒ¹æœå‹™ - é¦–é¸)         â”‚
â”‚  â”œâ”€â”€ Yahoo Finance API (ä¸»è¦è‚¡åƒ¹ä¾†æº)                      â”‚
â”‚  â”œâ”€â”€ FinMind API (å°è‚¡å°ˆç”¨è³‡æ–™ + é…è‚¡é…æ¯)                  â”‚
â”‚  â”œâ”€â”€ å°ç£è­‰äº¤æ‰€ OpenAPI (å®˜æ–¹è³‡æ–™)                          â”‚
â”‚  â””â”€â”€ GitHub Gist API (é›²ç«¯åŒæ­¥)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯æŠ€è¡“æ£§
```
React 18              - UI æ¡†æ¶ï¼Œæ”¯æ´ Concurrent Features
TypeScript 5.9.3      - é¡å‹å®‰å…¨ï¼Œæå‡é–‹ç™¼é«”é©—
Vite 4.5.14           - ç¾ä»£åŒ–å»ºç½®å·¥å…·ï¼Œå¿«é€Ÿç†±é‡è¼‰
Zustand 4.x           - è¼•é‡ç´šç‹€æ…‹ç®¡ç†ï¼Œæ”¯æ´æŒä¹…åŒ–
TailwindCSS 3.x       - åŸå­åŒ– CSS æ¡†æ¶ï¼ŒéŸ¿æ‡‰å¼è¨­è¨ˆ
Vitest                - å–®å…ƒæ¸¬è©¦æ¡†æ¶
ESLint + Prettier     - ä»£ç¢¼å“è³ªæ§åˆ¶
```

### æ ¸å¿ƒæœå‹™æ¶æ§‹
```
ç‹€æ…‹ç®¡ç†å±¤:
â”œâ”€â”€ useAppStore (Zustand)     - ä¸»è¦æ‡‰ç”¨ç‹€æ…‹
â”œâ”€â”€ æŒä¹…åŒ–æ©Ÿåˆ¶ (localStorage) - ç‰ˆæœ¬åŒ–ç‹€æ…‹æŒä¹…åŒ– (v7)
â””â”€â”€ ç‹€æ…‹é·ç§»ç³»çµ±              - ç‰ˆæœ¬å‡ç´šæ™‚çš„è³‡æ–™é·ç§»

æœå‹™å±¤:
â”œâ”€â”€ RightsEventService        - çµ±ä¸€é…è‚¡é…æ¯è™•ç†æœå‹™
â”œâ”€â”€ StockListService          - è‚¡ç¥¨æ¸…å–®ç®¡ç†æœå‹™ (4056æ”¯è‚¡ç¥¨)
â”œâ”€â”€ CloudStockPriceService    - é›²ç«¯è‚¡åƒ¹ç²å–æœå‹™
â”œâ”€â”€ DividendApiService        - é™¤æ¬Šæ¯è³‡æ–™æœå‹™
â”œâ”€â”€ GitHubGistService         - é›²ç«¯åŒæ­¥æœå‹™
â”œâ”€â”€ StockEnhancementService   - è‚¡ç¥¨è³‡æ–™å¢å¼·æœå‹™
â”œâ”€â”€ DividendAutoService       - è‡ªå‹•é…è‚¡é…æ¯æœå‹™
â””â”€â”€ Logger System             - çµæ§‹åŒ–æ—¥èªŒç³»çµ± (5ç´šåˆ¥)

API æ•´åˆå±¤:
â”œâ”€â”€ Vercel Edge Functions     - ä¼æ¥­ç´šè‚¡åƒ¹æœå‹™ï¼ˆé¦–é¸ï¼‰
â”œâ”€â”€ Yahoo Finance API         - ä¸»è¦è‚¡åƒ¹ä¾†æºï¼ˆæ™ºèƒ½å¾Œç¶´åˆ¤æ–·ï¼‰
â”œâ”€â”€ FinMind API              - å°è‚¡å°ˆç”¨è³‡æ–™ï¼ˆ4056æ”¯è‚¡ç¥¨æ¸…å–®ï¼‰
â”œâ”€â”€ å°ç£è­‰äº¤æ‰€ OpenAPI        - å®˜æ–¹é™¤æ¬Šæ¯è³‡æ–™
â””â”€â”€ GitHub Gist API          - é›²ç«¯è³‡æ–™åŒæ­¥
```

### å¾Œç«¯æœå‹™æ¶æ§‹
```
æœ¬æ©Ÿç«¯å¾Œç«¯æœå‹™:
â”œâ”€â”€ Node.js Express Server (localhost:3001)
â”‚   â”œâ”€â”€ CORS æ”¯æ´
â”‚   â”œâ”€â”€ è‚¡åƒ¹ API ä»£ç†
â”‚   â”œâ”€â”€ å¿«å–æ©Ÿåˆ¶
â”‚   â””â”€â”€ éŒ¯èª¤è™•ç†

é›²ç«¯ç„¡æœå‹™å™¨å‡½æ•¸:
â”œâ”€â”€ Netlify Functions
â”‚   â”œâ”€â”€ /stock - è‚¡åƒ¹æŸ¥è©¢
â”‚   â”œâ”€â”€ /stock-search - è‚¡ç¥¨æœå°‹
â”‚   â”œâ”€â”€ /dividend - é™¤æ¬Šæ¯æŸ¥è©¢
â”‚   â””â”€â”€ /health - å¥åº·æª¢æŸ¥

è‡ªå‹•åŒ–æœå‹™:
â”œâ”€â”€ GitHub Actions
â”‚   â”œâ”€â”€ æ¯æ—¥è‚¡ç¥¨æ¸…å–®æ›´æ–° (UTC 22:00)
â”‚   â”œâ”€â”€ è‡ªå‹•ç‰ˆæœ¬ç®¡ç†
â”‚   â””â”€â”€ éƒ¨ç½²æµç¨‹è‡ªå‹•åŒ–
```

---

## ğŸŒ ç’°å¢ƒæ¶æ§‹èˆ‡å·¥ä½œæ©Ÿåˆ¶

### æœ¬æ©Ÿç«¯ç’°å¢ƒ (Development Environment)

#### ç’°å¢ƒç‰¹å¾µ
- **å‰ç«¯**: `http://localhost:5173` (Vite Dev Server)
- **å¾Œç«¯**: `http://localhost:3001` (Node.js Express Server)
- **æª¢æ¸¬æ–¹å¼**: `window.location.hostname === 'localhost'`
- **å„ªå‹¢**: ç„¡ CORS é™åˆ¶ï¼Œå®Œæ•´åŠŸèƒ½ï¼Œå¿«é€Ÿé–‹ç™¼

#### å·¥ä½œæ©Ÿåˆ¶
```typescript
// æœ¬æ©Ÿç«¯ç’°å¢ƒæª¢æ¸¬
const isLocalhost = window.location.hostname === 'localhost' || 
                   window.location.hostname === '127.0.0.1';

if (isLocalhost) {
  // ä½¿ç”¨æœ¬æ©Ÿç«¯å¾Œç«¯ä»£ç†
  const apiUrl = 'http://localhost:3001/api/stock/2330';
  // å¾Œç«¯ä»£ç†æœƒèª¿ç”¨ Yahoo Finance API ä¸¦è¿”å›çµæœ
}
```

#### è‚¡åƒ¹ç²å–æµç¨‹
```
ç”¨æˆ¶è«‹æ±‚è‚¡åƒ¹
    â†“
å‰ç«¯èª¿ç”¨æœ¬æ©Ÿç«¯å¾Œç«¯ API (localhost:3001)
    â†“
å¾Œç«¯ä»£ç†èª¿ç”¨ Yahoo Finance API
    â†“
å¾Œç«¯è™•ç†ä¸¦å¿«å–çµæœ
    â†“
è¿”å›è‚¡åƒ¹è³‡æ–™çµ¦å‰ç«¯
    â†“
å‰ç«¯é¡¯ç¤ºè‚¡åƒ¹ (ä¾†æº: Yahoo)
```

#### æœ¬æ©Ÿç«¯å¾Œç«¯æœå‹™åŠŸèƒ½
- **è‚¡åƒ¹ä»£ç†**: ä»£ç† Yahoo Finance API è«‹æ±‚
- **CORS è™•ç†**: è§£æ±ºè·¨åŸŸå•é¡Œ
- **å¿«å–æ©Ÿåˆ¶**: 5ç§’å¿«å–é¿å…é‡è¤‡è«‹æ±‚
- **éŒ¯èª¤è™•ç†**: å„ªé›…è™•ç† API å¤±æ•—
- **æ—¥èªŒè¨˜éŒ„**: è©³ç´°çš„è«‹æ±‚æ—¥èªŒ

### é›²ç«¯ç’°å¢ƒ (Production Environment)

#### ç’°å¢ƒç‰¹å¾µ
- **GitHub Pages**: `https://username.github.io/repository`
- **Netlify**: `https://app-name.netlify.app`
- **æª¢æ¸¬æ–¹å¼**: `!window.location.hostname.includes('localhost')`
- **é™åˆ¶**: CORS é™åˆ¶ï¼Œéœ€è¦ä»£ç†æœå‹™

#### å·¥ä½œæ©Ÿåˆ¶
```typescript
// é›²ç«¯ç’°å¢ƒæª¢æ¸¬
const isGitHubPages = window.location.hostname.includes('github.io');

if (isGitHubPages) {
  // GitHub Pages ä½¿ç”¨ Netlify Functions ä½œç‚ºä»£ç†
  const apiUrl = 'https://stock-portfolio-system.netlify.app/.netlify/functions/stock?symbol=2330';
} else {
  // Netlify ç’°å¢ƒä½¿ç”¨ç›¸å°è·¯å¾‘
  const apiUrl = '/.netlify/functions/stock?symbol=2330';
}
```

#### è‚¡åƒ¹ç²å–æµç¨‹
```
ç”¨æˆ¶è«‹æ±‚è‚¡åƒ¹
    â†“
å‰ç«¯èª¿ç”¨ Netlify Functions
    â†“
Netlify Functions èª¿ç”¨å¤šå€‹ API:
â”œâ”€â”€ Yahoo Finance API (å„ªå…ˆ)
â”œâ”€â”€ FinMind API (å‚™æ´)
â””â”€â”€ è­‰äº¤æ‰€ API (æœ€å¾Œå‚™æ´)
    â†“
è¿”å›è‚¡åƒ¹è³‡æ–™çµ¦å‰ç«¯
    â†“
å‰ç«¯é¡¯ç¤ºè‚¡åƒ¹ (ä¾†æº: Yahoo Finance (Netlify))
```

#### Netlify Functions åŠŸèƒ½
- **å¤šé‡ API å‚™æ´**: Yahoo Finance â†’ FinMind â†’ è­‰äº¤æ‰€
- **æ™ºèƒ½å¾Œç¶´åˆ¤æ–·**: è‡ªå‹•åˆ¤æ–· .TW æˆ– .TWO
- **éŒ¯èª¤è™•ç†**: 404 å’Œ 500 éŒ¯èª¤è™•ç†
- **å¿«å–æ§åˆ¶**: HTTP å¿«å–æ¨™é ­
- **CORS æ”¯æ´**: è·¨åŸŸè«‹æ±‚æ”¯æ´

### ç’°å¢ƒåˆ‡æ›é‚è¼¯

#### API é…ç½®è‡ªå‹•åˆ‡æ›
```typescript
// src/config/api.ts
export const shouldUseBackendProxy = (): boolean => {
  const isLocalhost = window.location.hostname === 'localhost' || 
                     window.location.hostname === '127.0.0.1';
  
  if (isLocalhost) {
    return true;  // æœ¬æ©Ÿç«¯ä½¿ç”¨å¾Œç«¯ä»£ç†
  }
  
  return false;   // é›²ç«¯ç’°å¢ƒä½¿ç”¨ Netlify Functions
};
```

#### è‚¡åƒ¹æœå‹™è‡ªå‹•é©é…
```typescript
// src/services/stockPriceService.ts
async getStockPrice(symbol: string): Promise<StockPrice | null> {
  if (!shouldUseBackendProxy()) {
    // é›²ç«¯ç’°å¢ƒï¼šä½¿ç”¨ UnifiedStockPriceService
    const unifiedService = new UnifiedStockPriceService();
    return await unifiedService.getStockPrice(symbol);
  }
  
  // æœ¬æ©Ÿç«¯ç’°å¢ƒï¼šä½¿ç”¨å¾Œç«¯ä»£ç†
  const response = await fetch(`${API_CONFIG.BACKEND_PROXY.baseUrl}/api/stock/${symbol}`);
  // ...
}
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¦æ ¼

### 1. å¤šå¸³æˆ¶ç®¡ç†ç³»çµ±

#### 1.1 å¸³æˆ¶è³‡æ–™çµæ§‹
```typescript
interface Account {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  name: string;                  // å¸³æˆ¶åç¨±
  brokerageFee: number;          // è­‰åˆ¸æ‰‹çºŒè²»ç‡ (é è¨­ 0.1425%)
  transactionTax: number;        // äº¤æ˜“ç¨…ç‡ (å›ºå®š 0.3%)
  stockCount: number;            // è‚¡ç¥¨æ•¸é‡
  createdAt: Date;               // å»ºç«‹æ™‚é–“
  updatedAt: Date;               // æ›´æ–°æ™‚é–“
}
```

#### 1.2 å¸³æˆ¶ç®¡ç†åŠŸèƒ½
- **æ–°å¢å¸³æˆ¶**: å‹•æ…‹å»ºç«‹æ–°æŠ•è³‡å¸³æˆ¶
- **ç·¨è¼¯å¸³æˆ¶**: ä¿®æ”¹å¸³æˆ¶åç¨±å’Œè²»ç‡è¨­å®š
- **åˆªé™¤å¸³æˆ¶**: åˆªé™¤å¸³æˆ¶åŠå…¶æ‰€æœ‰è‚¡ç¥¨è¨˜éŒ„
- **å¸³æˆ¶æ’åº**: æ”¯æ´æ‹–æ‹½é‡æ–°æ’åº
- **å¸³æˆ¶åˆ‡æ›**: å¿«é€Ÿåˆ‡æ›ç•¶å‰æ“ä½œå¸³æˆ¶
- **è‚¡ç¥¨çµ±è¨ˆ**: è‡ªå‹•çµ±è¨ˆæ¯å€‹å¸³æˆ¶çš„è‚¡ç¥¨æ•¸é‡

### 2. è‚¡ç¥¨ç®¡ç†ç³»çµ±

#### 2.1 è‚¡ç¥¨è¨˜éŒ„è³‡æ–™çµæ§‹
```typescript
interface StockRecord {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  accountId: string;             // æ‰€å±¬å¸³æˆ¶ID
  symbol: string;                // è‚¡ç¥¨ä»£ç¢¼ (å¦‚: 2330)
  name: string;                  // è‚¡ç¥¨åç¨± (å¦‚: å°ç©é›»)
  shares: number;                // æŒè‚¡æ•¸ (å«é…è‚¡èª¿æ•´)
  costPrice: number;             // åŸå§‹æˆæœ¬åƒ¹
  adjustedCostPrice?: number;    // èª¿æ•´å¾Œæˆæœ¬åƒ¹ (æ‰£é™¤è‚¡æ¯)
  purchaseDate: Date;            // è³¼è²·æ—¥æœŸ
  currentPrice: number;          // ç¾åƒ¹
  change: number;                // æ¼²è·Œé‡‘é¡
  changePercent: number;         // æ¼²è·Œç™¾åˆ†æ¯”
  lastUpdated: Date;             // æœ€å¾Œæ›´æ–°æ™‚é–“
  priceSource: string;           // åƒ¹æ ¼ä¾†æº (Yahoo/FinMind/Vercel)
  dividendRecords?: DividendRecord[]; // é™¤æ¬Šæ¯è¨˜éŒ„
  lastDividendUpdate?: string;   // æœ€å¾Œé™¤æ¬Šæ¯æ›´æ–°æ™‚é–“
  isBondETF?: boolean;           // æ˜¯å¦ç‚ºå‚µåˆ¸ETF
  transactionTaxRate?: number;   // äº¤æ˜“ç¨…ç‡ (å‚µåˆ¸ETFç‚º0.1%)
}
```

#### 2.2 è‚¡ç¥¨æ“ä½œåŠŸèƒ½
- **QuickAddStock**: å¿«é€Ÿæ–°å¢è‚¡ç¥¨ï¼Œæ™ºèƒ½æœå°‹å’Œè‚¡åƒ¹ç²å–
  - ğŸ†• ä¿®å¾©æç¤ºè©ï¼šå°‡"é»æ“Šç²å–å³æ™‚è‚¡åƒ¹"æ”¹ç‚º"å¤šå€‹çµæœ"
  - æ™ºèƒ½è‚¡ç¥¨ä»£ç¢¼æœå°‹ï¼Œæ”¯æ´æ¨¡ç³ŠåŒ¹é…
  - å³æ™‚è‚¡åƒ¹ç²å–å’Œé¡¯ç¤º
- **AddStockForm**: å®Œæ•´çš„è‚¡ç¥¨æ–°å¢è¡¨å–®
  - ğŸ†• è‡ªå‹•é…è‚¡é…æ¯è™•ç†ï¼šæ–°å¢è‚¡ç¥¨æ™‚è‡ªå‹•å¸¶å…¥æ­·å²é…è‚¡é…æ¯
  - å‚µåˆ¸ETFè‡ªå‹•è­˜åˆ¥å’Œç¨…ç‡è¨­å®š
- **ç·¨è¼¯è‚¡ç¥¨**: ä¿®æ”¹æŒè‚¡æ•¸ã€æˆæœ¬åƒ¹ç­‰è³‡è¨Š
- **åˆªé™¤è‚¡ç¥¨**: ç§»é™¤è‚¡ç¥¨è¨˜éŒ„
- **æ‰¹æ¬¡æ›´æ–°**: å³ä¸Šè§’æ‰¹é‡æ›´æ–°è‚¡åƒ¹å’Œé…è‚¡é…æ¯
- **å€‹è‚¡æ›´æ–°**: å–®ä¸€è‚¡ç¥¨çš„è‚¡åƒ¹å’Œé…è‚¡é…æ¯æ›´æ–°

#### 2.3 ğŸ†• æ–°å¢è‚¡ç¥¨è‡ªå‹•é…è‚¡é…æ¯è™•ç† (v1.0.2.0364)
```typescript
// æ–°å¢è‚¡ç¥¨æ™‚çš„è‡ªå‹•è™•ç†æµç¨‹
const handleAddStock = async (stockData: StockFormData) => {
  // 1. å‰µå»ºåŸºæœ¬è‚¡ç¥¨è¨˜éŒ„
  const newStock: StockRecord = { /* åŸºæœ¬è³‡æ–™ */ };
  
  // 2. ä½¿ç”¨å¢å¼·ç‰ˆæ–°å¢åŠŸèƒ½ï¼ˆçµ±ä¸€é…è‚¡é…æ¯è™•ç†ï¼‰
  const result = await StockEnhancementService.addStockWithEnhancements(newStock);
  
  // 3. è‡ªå‹•è™•ç†æµç¨‹
  // â”œâ”€â”€ è­˜åˆ¥å‚µåˆ¸ETFä¸¦è¨­å®šè­‰äº¤ç¨…ç‡ (0.1%)
  // â”œâ”€â”€ çµ±ä¸€ä½¿ç”¨ RightsEventService.processStockRightsEvents
  // â”œâ”€â”€ è‡ªå‹•ç²å–é…è‚¡é…æ¯è³‡æ–™ï¼ˆå¾è³¼è²·æ—¥æœŸé–‹å§‹ï¼‰
  // â”œâ”€â”€ è¨ˆç®—èª¿æ•´å¾ŒæŒè‚¡æ•¸å’Œæˆæœ¬åƒ¹
  // â”œâ”€â”€ è¨˜éŒ„è©³ç´°çš„è™•ç†æ—¥èªŒ
  // â””â”€â”€ ç¢ºä¿æ–°å¢è‚¡ç¥¨ç¸½æ˜¯åŸ·è¡Œé…è‚¡é…æ¯è™•ç†
};

// é—œéµä¿®å¾©ï¼šçµ±ä¸€ä½¿ç”¨ RightsEventService
// - DividendAutoService çµ±ä¸€èª¿ç”¨ RightsEventService.processStockRightsEvents
// - StockEnhancementService ç¢ºä¿æ–°å¢è‚¡ç¥¨ç¸½æ˜¯åŸ·è¡Œé…è‚¡é…æ¯è™•ç†
// - ç§»é™¤é‡è¤‡çš„é…è‚¡é…æ¯è¨ˆç®—é‚è¼¯ï¼Œé¿å…ä¸ä¸€è‡´å•é¡Œ
```

### 3. é™¤æ¬Šæ¯è¨ˆç®—ç³»çµ±

#### 3.1 ğŸ†• çµ±ä¸€é™¤æ¬Šæ¯è™•ç†æœå‹™ (v1.0.2.0364)
```typescript
// æ‰€æœ‰é…è‚¡é…æ¯è™•ç†çµ±ä¸€ä½¿ç”¨ RightsEventService
class RightsEventService {
  static async processStockRightsEvents(
    stockRecord: StockRecord,
    onProgress?: (message: string) => void,
    forceRecalculate: boolean = false
  ): Promise<StockRecord> {
    // 1. ç²å– API é™¤æ¬Šæ¯è³‡æ–™ï¼ˆFinMind APIï¼‰
    // 2. æŒ‰æ™‚é–“æ’åºï¼ˆå¾èˆŠåˆ°æ–°ï¼‰
    // 3. ç´¯ç©è¨ˆç®—é…è‚¡
    // 4. æ›´æ–°è‚¡ç¥¨è¨˜éŒ„
  }
}

// æ‰€æœ‰å…¥å£éƒ½ä½¿ç”¨æ­¤æœå‹™ï¼š
// â”œâ”€â”€ æ–°å¢è‚¡ç¥¨æ™‚ï¼šautoUpdateDividends â†’ RightsEventService
// â”œâ”€â”€ å€‹è‚¡æ›´æ–°ï¼šRightsEventManager â†’ RightsEventService  
// â”œâ”€â”€ æ‰¹é‡æ›´æ–°ï¼šupdateAllStockPrices â†’ RightsEventService
// â””â”€â”€ æ‰‹å‹•æ›´æ–°ï¼šç”¨æˆ¶é»æ“Š â†’ RightsEventService
```

#### 3.2 é™¤æ¬Šæ¯è¨˜éŒ„çµæ§‹
```typescript
interface DividendRecord {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  stockId: string;               // é—œè¯è‚¡ç¥¨è¨˜éŒ„ID
  symbol: string;                // è‚¡ç¥¨ä»£ç¢¼
  exDividendDate: Date;          // é™¤æ¬Šæ¯æ—¥æœŸ
  cashDividendPerShare: number;  // æ¯è‚¡ç¾é‡‘è‚¡åˆ©
  totalCashDividend: number;     // ç¸½ç¾é‡‘è‚¡åˆ©é‡‘é¡
  stockDividendRatio: number;    // é…è‚¡æ¯”ä¾‹ (æ¯1000è‚¡é…Xè‚¡)
  stockDividendShares: number;   // é…å¾—è‚¡æ•¸
  sharesBeforeRight: number;     // é™¤æ¬Šæ¯å‰æŒè‚¡æ•¸
  sharesAfterRight: number;      // é™¤æ¬Šæ¯å¾ŒæŒè‚¡æ•¸
  costPriceBeforeRight: number;  // é™¤æ¬Šæ¯å‰æˆæœ¬åƒ¹
  costPriceAfterRight: number;   // é™¤æ¬Šæ¯å¾Œèª¿æ•´æˆæœ¬åƒ¹
  recordDate?: Date;             // åœæ­¢éæˆ¶æ—¥
  paymentDate?: Date;            // ç™¼æ”¾æ—¥
  type: 'cash' | 'stock' | 'both'; // é™¤æ¬Šæ¯é¡å‹
}
```

#### 3.3 é™¤æ¬Šæ¯æ¨¡å¼åˆ‡æ›
- **ä¸å«æ¬Šæ¯æ¨¡å¼** (`excluding_rights`): é¡¯ç¤ºåŸå§‹æˆæœ¬åƒ¹å’Œæç›Š
- **å«æ¬Šæ¯æ¨¡å¼** (`including_rights`): é¡¯ç¤ºèª¿æ•´å¾Œæˆæœ¬åƒ¹å’Œæç›Š

### 2. Stock List ç³»çµ± (è‚¡ç¥¨æ¸…å–®ç®¡ç†)

#### 2.1 Stock List è³‡æ–™çµæ§‹
```typescript
interface StockListData {
  date: string;                  // è³‡æ–™æ—¥æœŸ (YYYY-MM-DD)
  timestamp: string;             // æ›´æ–°æ™‚é–“æˆ³
  count: number;                 // è‚¡ç¥¨ç¸½æ•¸
  stocks: Record<string, {
    name: string;                // è‚¡ç¥¨ä¸­æ–‡åç¨±
    industry: string;            // è¡Œæ¥­åˆ†é¡
    market: string;              // å¸‚å ´ (å°è‚¡)
    marketType?: 'ä¸Šå¸‚' | 'ä¸Šæ«ƒ' | 'èˆˆæ«ƒ'; // å¸‚å ´é¡å‹
    yahooSuffix?: '.TW' | '.TWO'; // Yahoo Finance å¾Œç¶´
  }>;
}
```

#### 2.2 ğŸ†• Stock List çµ±ä¸€ç®¡ç†æ©Ÿåˆ¶ (v1.0.2.0364)

##### å•é¡Œä¿®å¾©
- **æœ¬æ©Ÿç«¯æª”æ¡ˆè¢«åˆªé™¤å•é¡Œ**: çµ±ä¸€ä½¿ç”¨ `public/stock_list.json`
- **è³‡æ–™éèˆŠå•é¡Œ**: æ›´æ–°åˆ°æœ€æ–° 1/29 è³‡æ–™ï¼ˆ4056æ”¯è‚¡ç¥¨ï¼Œæ¯”ä¹‹å‰å¤š1æ”¯ï¼‰
- **503 éŒ¯èª¤å¹²æ“¾**: æœ¬æ©Ÿç’°å¢ƒå®Œå…¨è·³éå¾Œç«¯æª¢æŸ¥ï¼Œç›´æ¥ä½¿ç”¨å‰ç«¯æª”æ¡ˆ

##### çµ±ä¸€ç®¡ç†ç­–ç•¥
```typescript
// StockListService çµ±ä¸€ç®¡ç†é‚è¼¯
class StockListService {
  async loadStockList(): Promise<StockListData | null> {
    // æœ¬æ©Ÿç’°å¢ƒï¼šç›´æ¥ä½¿ç”¨å‰ç«¯æª”æ¡ˆï¼Œè·³éå¾Œç«¯æª¢æŸ¥
    if (window.location.hostname === 'localhost') {
      return await this.loadFromFrontend();
    }
    
    // é›²ç«¯ç’°å¢ƒï¼šæ­£å¸¸çš„å¾Œç«¯æª¢æŸ¥æµç¨‹
    return await this.loadWithBackendCheck();
  }
  
  private async loadFromFrontend(): Promise<StockListData | null> {
    try {
      const response = await fetch('/stock_list.json');
      if (response.ok) {
        const data = await response.json();
        logger.info('stock', `âœ… è¼‰å…¥ Stock List: ${data.count} æ”¯è‚¡ç¥¨ (${data.date})`);
        return data;
      }
    } catch (error) {
      logger.error('stock', 'Stock List è¼‰å…¥å¤±æ•—', error);
    }
    return null;
  }
}
```

##### è³‡æ–™ä¾†æºèˆ‡æ›´æ–°
```
è³‡æ–™ä¾†æº: FinMind API (TaiwanStockInfo è³‡æ–™é›†)
æ›´æ–°é »ç‡: æ¯æ—¥è‡ªå‹•æ›´æ–° (GitHub Actions UTC 22:00)
æª”æ¡ˆä½ç½®: public/stock_list.json (çµ±ä¸€æª”æ¡ˆ)
ç•¶å‰è³‡æ–™: 2026-01-29 (4056æ”¯è‚¡ç¥¨)
è‡ªå‹•åŒ–: GitHub Actions + Python è…³æœ¬
```

##### è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶
```typescript
// æ¯æ—¥æª¢æŸ¥èˆ‡æ›´æ–°æµç¨‹
class StockListUpdateService {
  // 1. æª¢æŸ¥ç•¶å‰ Stock List æ˜¯å¦ç‚ºä»Šæ—¥è³‡æ–™
  async checkStockListFreshness(): Promise<boolean> {
    const today = new Date().toISOString().split('T')[0];
    const stockListData = await stockListService.loadStockList();
    return stockListData?.date === today;
  }
  
  // 2. è§¸ç™¼æ›´æ–° (æœ¬æ©Ÿç«¯/é›²ç«¯ä¸åŒç­–ç•¥)
  async triggerStockListUpdate(): Promise<boolean> {
    const envInfo = stockListService.getEnvironmentInfo();
    
    if (envInfo.isDevelopment) {
      // æœ¬æ©Ÿç«¯: èª¿ç”¨å¾Œç«¯ API æˆ– npm è…³æœ¬
      return await this.triggerBackendUpdate();
    } else {
      // é›²ç«¯: GitHub Actions è‡ªå‹•æ›´æ–°
      return true;
    }
  }
}
```

##### æ›´æ–°ç­–ç•¥è©³è§£

**æœ¬æ©Ÿç«¯æ›´æ–°ç­–ç•¥**:
```typescript
// æœ¬æ©Ÿç«¯è‡ªå‹•æ›´æ–°æµç¨‹
private async triggerBackendUpdate(): Promise<boolean> {
  try {
    // 1. å˜—è©¦èª¿ç”¨å¾Œç«¯æ›´æ–° API
    const response = await fetch('http://localhost:3001/api/update-stock-list', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        trigger: 'frontend-auto-check',
        timestamp: new Date().toISOString()
      })
    });
    
    if (response.ok) {
      logger.success('stock', 'å¾Œç«¯è‡ªå‹•æ›´æ–°æˆåŠŸ');
      return true;
    }
  } catch (error) {
    // 2. å¾Œç«¯ API ä¸å¯ç”¨ï¼Œæä¾›æ‰‹å‹•æ›´æ–°æŒ‡å¼•
    logger.info('stock', 'è«‹æ‰‹å‹•åŸ·è¡Œ: npm run update:stock-list');
    return false;
  }
}
```

**é›²ç«¯æ›´æ–°ç­–ç•¥**:
```yaml
# GitHub Actions è‡ªå‹•æ›´æ–° (.github/workflows/update-stock-list.yml)
name: Update Stock List
on:
  schedule:
    - cron: '0 1 * * 1-5'  # æ¯å€‹å·¥ä½œæ—¥å‡Œæ™¨1é»åŸ·è¡Œ
  workflow_dispatch:        # æ”¯æ´æ‰‹å‹•è§¸ç™¼

jobs:
  update-stock-list:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: |
          pip install requests pandas
          
      - name: Update Stock List
        run: |
          python scripts/update_stock_list.py
          
      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add stock_list_*.json
          git commit -m "Auto update stock list $(date +%Y-%m-%d)" || exit 0
          git push
```

##### æ›´æ–°è…³æœ¬å¯¦ä½œ
```python
# scripts/update_stock_list.py
import requests
import json
from datetime import datetime

def update_stock_list():
    """å¾ FinMind API æ›´æ–°è‚¡ç¥¨æ¸…å–®"""
    
    # 1. èª¿ç”¨ FinMind API ç²å–æœ€æ–°è‚¡ç¥¨æ¸…å–®
    url = "https://api.finmindtrade.com/api/v4/data"
    params = {
        "dataset": "TaiwanStockInfo",
        "token": ""  # å…è²»ä½¿ç”¨
    }
    
    response = requests.get(url, params=params)
    if response.status_code != 200:
        raise Exception(f"API èª¿ç”¨å¤±æ•—: {response.status_code}")
    
    data = response.json()
    if not data.get('data'):
        raise Exception("API è¿”å›ç©ºè³‡æ–™")
    
    # 2. è™•ç†è‚¡ç¥¨è³‡æ–™
    stocks = {}
    for item in data['data']:
        stock_id = item['stock_id']
        stocks[stock_id] = {
            'name': item['stock_name'],
            'industry': item['industry_category'],
            'market': 'å°è‚¡'
        }
    
    # 3. ç”Ÿæˆæ–°çš„è‚¡ç¥¨æ¸…å–®æª”æ¡ˆ
    today = datetime.now().strftime('%Y-%m-%d')
    stock_list_data = {
        'date': today,
        'timestamp': datetime.now().isoformat(),
        'count': len(stocks),
        'stocks': stocks
    }
    
    # 4. ä¿å­˜æª”æ¡ˆ
    filename = f'stock_list_{today}.json'
    with open(filename, 'w', encoding='utf-8') as f:
        json.dump(stock_list_data, f, ensure_ascii=False, indent=2)
    
    # 5. æ›´æ–°ä¸»è¦æª”æ¡ˆé€£çµ
    with open('stock_list.json', 'w', encoding='utf-8') as f:
        json.dump(stock_list_data, f, ensure_ascii=False, indent=2)
    
    print(f"âœ… è‚¡ç¥¨æ¸…å–®æ›´æ–°å®Œæˆ: {len(stocks)} æ”¯è‚¡ç¥¨")
    return True

if __name__ == "__main__":
    update_stock_list()
```

##### æ‡‰ç”¨å•Ÿå‹•æ™‚çš„æª¢æŸ¥æ©Ÿåˆ¶
```typescript
// App.tsx ä¸­çš„åˆå§‹åŒ–é‚è¼¯
useEffect(() => {
  const initializeStockListService = async () => {
    try {
      // 1. åˆå§‹åŒ–è‚¡ç¥¨æ¸…å–®æ›´æ–°æœå‹™
      stockListUpdateService.init();
      
      // 2. æª¢æŸ¥ä¸¦æ›´æ–°è‚¡ç¥¨æ¸…å–® (å¦‚æœéœ€è¦)
      await stockListUpdateService.checkAndUpdate();
      
      logger.info('stock', 'è‚¡ç¥¨æ¸…å–®æœå‹™åˆå§‹åŒ–å®Œæˆ');
    } catch (error) {
      logger.error('stock', 'è‚¡ç¥¨æ¸…å–®æœå‹™åˆå§‹åŒ–å¤±æ•—', error);
    }
  };
  
  initializeStockListService();
}, []);
```

##### å®šæœŸæª¢æŸ¥æ©Ÿåˆ¶
```typescript
// æ¯å°æ™‚æª¢æŸ¥ä¸€æ¬¡è‚¡ç¥¨æ¸…å–®æ–°é®®åº¦
class StockListUpdateService {
  private readonly CHECK_INTERVAL = 60 * 60 * 1000; // 1å°æ™‚
  
  init(): void {
    // è¨­å®šå®šæœŸæª¢æŸ¥
    setInterval(() => {
      this.checkStockListFreshness().then(needsUpdate => {
        if (needsUpdate) {
          logger.info('stock', 'æª¢æ¸¬åˆ°è‚¡ç¥¨æ¸…å–®éœ€è¦æ›´æ–°');
          this.triggerStockListUpdate();
        }
      });
    }, this.CHECK_INTERVAL);
    
    logger.info('stock', 'è‚¡ç¥¨æ¸…å–®æ›´æ–°æœå‹™å·²åˆå§‹åŒ–');
  }
}
```

#### 2.4 Stock List çš„æ ¸å¿ƒä½œç”¨

##### ä½œç‚ºè‚¡ç¥¨åç¨±çš„å–®ä¸€çœŸç›¸ä¾†æº
```typescript
// Stock List æä¾›çµ±ä¸€çš„è‚¡ç¥¨åç¨±ä¾†æº
interface StockNameProvider {
  // 1. æœå°‹æ™‚æä¾›ä¸­æ–‡åç¨±
  searchByName(query: string): StockInfo[];
  
  // 2. è‚¡åƒ¹æ›´æ–°æ™‚è£œå……åç¨±
  getStockName(symbol: string): string | null;
  
  // 3. æ–°å¢è‚¡ç¥¨æ™‚é©—è­‰ä»£ç¢¼
  validateStockSymbol(symbol: string): boolean;
}

// å¯¦éš›ä½¿ç”¨ç¯„ä¾‹
const getStockInfo = async (symbol: string) => {
  const stockListData = await stockListService.loadStockList();
  const stockInfo = stockListData?.stocks[symbol];
  
  return {
    symbol,
    name: stockInfo?.name || symbol,           // å„ªå…ˆä½¿ç”¨ Stock List åç¨±
    market: stockInfo?.market || 'å°ç£',
    marketType: stockInfo?.marketType || 'ä¸Šå¸‚',
    yahooSuffix: stockInfo?.yahooSuffix || '.TW'
  };
};
```

##### æ”¯æ´æ™ºèƒ½è‚¡ç¥¨ä»£ç¢¼å¾Œç¶´åˆ¤æ–·
```typescript
// Stock List å¢å¼·å¾Œæä¾› Yahoo Finance å¾Œç¶´è³‡è¨Š
const getYahooSymbolFromStockList = (symbol: string): string => {
  const stockListData = stockListService.getCachedData();
  const stockInfo = stockListData?.stocks[symbol];
  
  if (stockInfo?.yahooSuffix) {
    // ä½¿ç”¨ Stock List æä¾›çš„å¾Œç¶´
    return `${symbol}${stockInfo.yahooSuffix}`;
  }
  
  // å‚™æ´ï¼šä½¿ç”¨æ™ºèƒ½åˆ¤æ–·é‚è¼¯
  return stockListService.getYahooSuffix(symbol);
};
```

##### æä¾›å®Œæ•´çš„å¸‚å ´åˆ†é¡è³‡è¨Š
```typescript
// Stock List æä¾›è©³ç´°çš„å¸‚å ´åˆ†é¡
interface EnhancedStockInfo {
  name: string;                    // ä¸­æ–‡åç¨±
  industry: string;                // è¡Œæ¥­åˆ†é¡
  market: string;                  // å¸‚å ´ (å°è‚¡)
  marketType: 'ä¸Šå¸‚' | 'ä¸Šæ«ƒ' | 'èˆˆæ«ƒ'; // å…·é«”å¸‚å ´é¡å‹
  yahooSuffix: '.TW' | '.TWO';     // Yahoo Finance å¾Œç¶´
}

// ä½¿ç”¨ç¯„ä¾‹ï¼šæ ¹æ“šå¸‚å ´é¡å‹é¸æ“‡ä¸åŒçš„è‚¡åƒ¹ API ç­–ç•¥
const selectPriceAPI = (stockInfo: EnhancedStockInfo) => {
  if (stockInfo.marketType === 'ä¸Šæ«ƒ') {
    // ä¸Šæ«ƒè‚¡ç¥¨å¯èƒ½éœ€è¦ç‰¹æ®Šè™•ç†
    return 'yahoo_with_two_suffix';
  } else {
    // ä¸Šå¸‚è‚¡ç¥¨ä½¿ç”¨æ¨™æº–è™•ç†
    return 'yahoo_with_tw_suffix';
  }
};
```
#### 2.5 ç’°å¢ƒé©æ‡‰è¼‰å…¥ç­–ç•¥
```typescript
// æœ¬æ©Ÿç«¯è¼‰å…¥ç­–ç•¥
async loadFromDevelopment(): Promise<StockListData | null> {
  // 1. å„ªå…ˆå˜—è©¦å¾Œç«¯ API
  try {
    const response = await fetch('http://localhost:3001/api/stock-list');
    if (response.ok) return await response.json();
  } catch (error) {
    // å¾Œç«¯ä¸å¯ç”¨ï¼Œä½¿ç”¨å‚™ç”¨æ–¹æ¡ˆ
  }
  
  // 2. å‚™ç”¨: å‰ç«¯æª”æ¡ˆ
  return await this.loadFromFile();
}

// é›²ç«¯è¼‰å…¥ç­–ç•¥  
async loadFromProduction(): Promise<StockListData | null> {
  // ç›´æ¥ä½¿ç”¨å‰ç«¯æª”æ¡ˆ
  return await this.loadFromFile();
}

// çµ±ä¸€æª”æ¡ˆè¼‰å…¥
async loadFromFile(): Promise<StockListData | null> {
  const filePaths = [
    './stock_list.json',           // ä¸»è¦è·¯å¾‘
    '/stock_list.json',            // å‚™ç”¨è·¯å¾‘ 1
    './public/stock_list.json',    // å‚™ç”¨è·¯å¾‘ 2
  ];
  
  for (const filePath of filePaths) {
    try {
      const response = await fetch(filePath);
      if (response.ok) {
        const data = await response.json();
        if (this.validateStockListData(data)) {
          return this.enhanceStockList(data); // å¢å¼·å¸‚å ´é¡å‹å’Œå¾Œç¶´
        }
      }
    } catch (error) {
      continue; // å˜—è©¦ä¸‹ä¸€å€‹è·¯å¾‘
    }
  }
  
  return null;
}
```

#### 2.3 Stock List å‹•æ…‹å¢å¼·æ©Ÿåˆ¶ (v1.0.2.0356)

##### æ ¸å¿ƒåŸç†
Stock List æ¡ç”¨ **å‹•æ…‹å¢å¼·æ©Ÿåˆ¶** è€Œééœæ…‹å®šç¾©ï¼ŒåŸå§‹æª”æ¡ˆä¿æŒç°¡æ½”ï¼Œç³»çµ±è¼‰å…¥æ™‚è‡ªå‹•æ·»åŠ  Yahoo Finance å¾Œç¶´å’Œå¸‚å ´åˆ†é¡è³‡è¨Šã€‚

##### åŸå§‹æª”æ¡ˆçµæ§‹
```json
// public/stock_list.json - åŸå§‹æª”æ¡ˆåªåŒ…å«åŸºæœ¬è³‡è¨Š
{
  "date": "2026-01-27",
  "count": 4054,
  "stocks": {
    "2330": {
      "name": "å°ç©é›»",
      "industry": "åŠå°é«”æ¥­", 
      "market": "å°è‚¡"
    },
    "6188": {
      "name": "å»£æ˜",
      "industry": "å…¶ä»–é›»å­é¡",
      "market": "å°è‚¡"
    }
  }
}
```

##### å‹•æ…‹å¢å¼·æµç¨‹
```typescript
// ç³»çµ±è¼‰å…¥æ™‚çš„å¢å¼·æµç¨‹
class StockListService {
  async loadStockList(): Promise<StockListData | null> {
    // 1. è¼‰å…¥åŸå§‹è³‡æ–™
    const data = await this.loadFromFile();
    
    if (data) {
      // 2. å‹•æ…‹å¢å¼·ï¼šæ·»åŠ å¸‚å ´é¡åˆ¥å’Œ Yahoo å¾Œç¶´
      const enhancedData = this.enhanceStockList(data);
      this.cachedData = enhancedData;
      return enhancedData;
    }
    
    return null;
  }
  
  // å¢å¼·è‚¡ç¥¨æ¸…å–®
  private enhanceStockList(data: StockListData): StockListData {
    const enhancedStocks: Record<string, any> = {};
    
    for (const [stockId, basicInfo] of Object.entries(data.stocks)) {
      const enhancedInfo = this.enhanceStockInfo(stockId, basicInfo);
      enhancedStocks[stockId] = enhancedInfo;
    }
    
    return {
      ...data,
      stocks: enhancedStocks,
      enhanced: true,
      enhancedAt: new Date().toISOString()
    };
  }
}
```

##### å¾Œç¶´åˆ¤æ–·é‚è¼¯
```typescript
// æ™ºèƒ½å¾Œç¶´åˆ¤æ–·é‚è¼¯ - åŸºæ–¼è‚¡ç¥¨ä»£ç¢¼ç¯„åœå’Œé¡å‹
private enhanceStockInfo(stockId: string, basicInfo: any): any {
  const code = parseInt(stockId.substring(0, 4));
  const isBondETF = /^00\d{2,3}B$/i.test(stockId);
  const isETF = /^00\d{2,3}[A-Z]?$/i.test(stockId);
  
  let marketType: 'ä¸Šå¸‚' | 'ä¸Šæ«ƒ' | 'èˆˆæ«ƒ';
  let yahooSuffix: '.TW' | '.TWO';
  let reasoning: string;
  
  // ç‰¹æ®Šæ¡ˆä¾‹è™•ç†ï¼ˆåŸºæ–¼å¯¦éš›æ¸¬è©¦çµæœï¼‰
  const specialCases: Record<string, { suffix: '.TW' | '.TWO', market: 'ä¸Šå¸‚' | 'ä¸Šæ«ƒ' | 'èˆˆæ«ƒ', reason: string }> = {
    '8112': { suffix: '.TW', market: 'ä¸Šæ«ƒ', reason: 'è‡³ä¸Šï¼šé›–åœ¨ 8000 ç¯„åœä½† Yahoo Finance ä½¿ç”¨ .TW' },
    '4585': { suffix: '.TW', market: 'èˆˆæ«ƒ', reason: 'é”æ˜ï¼šèˆˆæ«ƒè‚¡ç¥¨ï¼Œæœ€å¸¸ç”¨ .TW' },
  };
  
  if (specialCases[stockId]) {
    const special = specialCases[stockId];
    marketType = special.market;
    yahooSuffix = special.suffix;
    reasoning = special.reason;
  } else if (isBondETF) {
    // å‚µåˆ¸ ETFï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'å‚µåˆ¸ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (isETF) {
    // ä¸€èˆ¬ ETFï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'ä¸€èˆ¬ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (code >= 3000 && code <= 8999) {
    // ä¸Šæ«ƒè‚¡ç¥¨ï¼ˆ3000-8999ï¼‰ï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'ä¸Šæ«ƒè‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (code >= 1000 && code <= 2999) {
    // ä¸Šå¸‚è‚¡ç¥¨ï¼ˆ1000-2999ï¼‰ï¼šå„ªå…ˆè­‰äº¤æ‰€
    marketType = 'ä¸Šå¸‚';
    yahooSuffix = '.TW';
    reasoning = 'ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
  } else {
    // å…¶ä»–æƒ…æ³ï¼šé è¨­è­‰äº¤æ‰€
    marketType = 'ä¸Šå¸‚';
    yahooSuffix = '.TW';
    reasoning = 'å…¶ä»–æƒ…æ³ï¼Œé è¨­ä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
  }
  
  return {
    ...basicInfo,
    marketType,
    yahooSuffix,
    reasoning,
    enhanced: true
  };
}
```

##### å¢å¼·å¾Œçš„è³‡æ–™çµæ§‹
```typescript
// å¢å¼·å¾Œçš„è‚¡ç¥¨è³‡è¨Šçµæ§‹
interface EnhancedStockInfo {
  name: string;                    // è‚¡ç¥¨ä¸­æ–‡åç¨± (åŸå§‹)
  industry: string;                // è¡Œæ¥­åˆ†é¡ (åŸå§‹)
  market: string;                  // å¸‚å ´ (åŸå§‹)
  marketType: 'ä¸Šå¸‚' | 'ä¸Šæ«ƒ' | 'èˆˆæ«ƒ'; // å¸‚å ´é¡å‹ (å‹•æ…‹æ·»åŠ )
  yahooSuffix: '.TW' | '.TWO';     // Yahoo Finance å¾Œç¶´ (å‹•æ…‹æ·»åŠ )
  reasoning: string;               // åˆ¤æ–·é‚è¼¯èªªæ˜ (å‹•æ…‹æ·»åŠ )
  enhanced: boolean;               // å¢å¼·æ¨™è¨˜ (å‹•æ…‹æ·»åŠ )
}

// å¯¦éš›ä½¿ç”¨ç¯„ä¾‹
const stockInfo = enhancedStockList.stocks['2330'];
// {
//   name: "å°ç©é›»",
//   industry: "åŠå°é«”æ¥­",
//   market: "å°è‚¡",
//   marketType: "ä¸Šå¸‚",
//   yahooSuffix: ".TW",
//   reasoning: "ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)",
//   enhanced: true
// }
```

##### å¾Œç¶´åˆ¤æ–·è¦å‰‡è¡¨
| è‚¡ç¥¨é¡å‹ | ä»£ç¢¼ç¯„åœ | Yahoo å¾Œç¶´ | å¸‚å ´åˆ†é¡ | ç¯„ä¾‹ |
|---------|---------|-----------|---------|------|
| ä¸Šå¸‚è‚¡ç¥¨ | 1000-2999 | `.TW` | ä¸Šå¸‚ | 2330 (å°ç©é›») |
| ä¸Šæ«ƒè‚¡ç¥¨ | 3000-8999 | `.TWO` | ä¸Šæ«ƒ | 6188 (å»£æ˜) |
| ä¸€èˆ¬ ETF | 00XXX | `.TWO` | ä¸Šæ«ƒ | 0050 (å…ƒå¤§å°ç£50) |
| å‚µåˆ¸ ETF | 00XXXB | `.TWO` | ä¸Šæ«ƒ | 00679B (å…ƒå¤§ç¾å‚µ20å¹´) |
| ç‰¹æ®Šæ¡ˆä¾‹ | 8112 | `.TW` | ä¸Šæ«ƒ | 8112 (è‡³ä¸Š) |
| ç‰¹æ®Šæ¡ˆä¾‹ | 4585 | `.TW` | èˆˆæ«ƒ | 4585 (é”æ˜) |

##### ä½¿ç”¨æ–¹å¼
```typescript
// 1. ç²å–è‚¡ç¥¨çš„ Yahoo Finance å¾Œç¶´
const yahooSuffix = await stockListService.getYahooSuffix('2330');
// è¿”å›: '.TW'

// 2. ç²å–å®Œæ•´çš„ Yahoo Finance ç¬¦è™Ÿ
const yahooSymbol = await stockListService.getYahooSymbol('2330');
// è¿”å›: '2330.TW'

// 3. è‚¡åƒ¹æœå‹™ä¸­çš„ä½¿ç”¨
const getStockPrice = async (symbol: string) => {
  // å„ªå…ˆä½¿ç”¨ Stock List é å®šç¾©å¾Œç¶´
  const yahooSymbol = await stockListService.getYahooSymbol(symbol);
  
  // èª¿ç”¨ Yahoo Finance API
  const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${yahooSymbol}`);
  // ...
};
```

##### è¨­è¨ˆå„ªå‹¢
1. **æª”æ¡ˆç°¡æ½”**: åŸå§‹æª”æ¡ˆåªåŒ…å«å¿…è¦è³‡è¨Šï¼Œæ˜“æ–¼ç¶­è­·
2. **é‚è¼¯é›†ä¸­**: å¾Œç¶´åˆ¤æ–·é‚è¼¯çµ±ä¸€ç®¡ç†ï¼Œæ˜“æ–¼ä¿®æ”¹
3. **è‡ªå‹•é©æ‡‰**: æ–°è‚¡ç¥¨è‡ªå‹•å¥—ç”¨æ­£ç¢ºå¾Œç¶´è¦å‰‡
4. **å¯æ“´å±•æ€§**: å®¹æ˜“æ·»åŠ æ–°çš„ç‰¹æ®Šæ¡ˆä¾‹æˆ–è¦å‰‡
5. **å‘å¾Œç›¸å®¹**: ä¸å½±éŸ¿ç¾æœ‰çš„ Stock List æª”æ¡ˆæ ¼å¼

##### æ¸¬è©¦é©—è­‰
ç³»çµ±æä¾›å°ˆç”¨æ¸¬è©¦å·¥å…·é©—è­‰å¾Œç¶´æ©Ÿåˆ¶ï¼š
- `tests/test-suffix-logic-only.html` - ç´” JavaScript å¾Œç¶´é‚è¼¯æ¸¬è©¦
- `tests/test-stock-list-suffix-mechanism.html` - å®Œæ•´æ©Ÿåˆ¶æ¸¬è©¦ (éœ€é–‹ç™¼ä¼ºæœå™¨)

æ¸¬è©¦çµæœé¡¯ç¤ºæ‰€æœ‰è‚¡ç¥¨é¡å‹çš„å¾Œç¶´åˆ¤æ–·éƒ½ 100% æ­£ç¢ºã€‚

### 3. è‚¡ç¥¨æœå°‹ç³»çµ±

#### 3.1 æœå°‹æµç¨‹æ¶æ§‹
```
ç”¨æˆ¶è¼¸å…¥æœå°‹é—œéµå­—
    â†“
ç’°å¢ƒæª¢æ¸¬ (æœ¬æ©Ÿç«¯ vs é›²ç«¯)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœ¬æ©Ÿç«¯æœå°‹     â”‚    é›²ç«¯æœå°‹      â”‚
â”‚                â”‚                â”‚
â”‚ 1. å¾Œç«¯ API     â”‚ 1. å‰ç«¯ç›´æ¥æœå°‹  â”‚
â”‚ 2. å‰ç«¯å‚™æ´     â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
å¾ Stock List å–å¾—è‚¡ç¥¨åç¨±
    â†“
èª¿ç”¨å°æ‡‰ç’°å¢ƒçš„è‚¡åƒ¹ API ç²å–å³æ™‚è‚¡åƒ¹
    â†“
è¿”å›å®Œæ•´æœå°‹çµæœ (åç¨± + å³æ™‚è‚¡åƒ¹)
```

#### 3.2 æœ¬æ©Ÿç«¯æœå°‹å¯¦ä½œ
```typescript
// æœ¬æ©Ÿç«¯æœå°‹ç­–ç•¥
const searchStocks = async (searchQuery: string): Promise<StockSearchResult[]> => {
  const envInfo = stockListService.getEnvironmentInfo();
  
  if (envInfo.isDevelopment) {
    // 1. å„ªå…ˆä½¿ç”¨å¾Œç«¯æœå°‹ API
    try {
      const response = await fetch(API_ENDPOINTS.searchStock(searchQuery));
      if (response.ok) {
        const stockDataArray = await response.json();
        // å¾Œç«¯å·²æ•´åˆ Stock List + å³æ™‚è‚¡åƒ¹
        return Array.isArray(stockDataArray) ? stockDataArray : [stockDataArray];
      }
    } catch (backendError) {
      // å¾Œç«¯å¤±æ•—ï¼Œä½¿ç”¨å‰ç«¯å‚™æ´
    }
  }
  
  // 2. å‰ç«¯ç›´æ¥æœå°‹ (é›²ç«¯ç’°å¢ƒæˆ–æœ¬æ©Ÿç«¯å‚™æ´)
  return await searchStocksDirectly(searchQuery);
};
```

#### 3.3 å‰ç«¯ç›´æ¥æœå°‹å¯¦ä½œ
```typescript
// å‰ç«¯ç›´æ¥æœå°‹ (ä½¿ç”¨ Stock List + é›²ç«¯è‚¡åƒ¹ API)
const searchStocksDirectly = async (query: string): Promise<StockSearchResult[]> => {
  // 1. å¾ Stock List æœå°‹è‚¡ç¥¨åç¨±
  const stockListData = await stockListService.loadStockList();
  if (!stockListData?.stocks) return [];
  
  // 2. æ™ºèƒ½æœå°‹é‚è¼¯ (ç²¾ç¢ºåŒ¹é…å„ªå…ˆ)
  const stocks = Object.entries(stockListData.stocks);
  const filtered = stocks.filter(([symbol, info]) => {
    const queryUpper = query.toUpperCase().trim();
    const symbolUpper = symbol.toUpperCase();
    const queryLower = query.toLowerCase().trim();
    const nameLower = info.name.toLowerCase();
    
    // ç²¾ç¢ºåŒ¹é…è‚¡ç¥¨ä»£ç¢¼ (æœ€é«˜å„ªå…ˆç´š)
    if (symbolUpper === queryUpper) return true;
    
    // è‚¡ç¥¨ä»£ç¢¼é–‹é ­åŒ¹é… (é«˜å„ªå…ˆç´š)
    if (symbolUpper.startsWith(queryUpper)) return true;
    
    // ä¸­æ–‡åç¨±åŒ…å«æŸ¥è©¢å­—ä¸² (ä¸­å„ªå…ˆç´š)
    if (nameLower.includes(queryLower)) return true;
    
    // è‚¡ç¥¨ä»£ç¢¼åŒ…å«æŸ¥è©¢å­—ä¸² (ä½å„ªå…ˆç´šï¼ŒæŸ¥è©¢é•·åº¦>=3)
    if (query.length >= 3 && symbolUpper.includes(queryUpper)) return true;
    
    return false;
  });
  
  // 3. æŒ‰åŒ¹é…å„ªå…ˆç´šæ’åºï¼Œé™åˆ¶çµæœæ•¸é‡
  const sortedFiltered = filtered.sort(([aSymbol], [bSymbol]) => {
    const aSymbolUpper = aSymbol.toUpperCase();
    const bSymbolUpper = bSymbol.toUpperCase();
    const queryUpper = query.toUpperCase().trim();
    
    // ç²¾ç¢ºåŒ¹é…æ’åœ¨æœ€å‰é¢
    if (aSymbolUpper === queryUpper && bSymbolUpper !== queryUpper) return -1;
    if (bSymbolUpper === queryUpper && aSymbolUpper !== queryUpper) return 1;
    
    // é–‹é ­åŒ¹é…æ’åœ¨å‰é¢
    const aStarts = aSymbolUpper.startsWith(queryUpper);
    const bStarts = bSymbolUpper.startsWith(queryUpper);
    if (aStarts && !bStarts) return -1;
    if (bStarts && !aStarts) return 1;
    
    // å…¶ä»–æŒ‰å­—æ¯é †åº
    return aSymbolUpper.localeCompare(bSymbolUpper);
  }).slice(0, 10);
  
  // 4. ç‚ºæ¯å€‹è‚¡ç¥¨ç²å–å³æ™‚è‚¡åƒ¹
  const stocksWithPrice = await Promise.all(
    sortedFiltered.map(async ([symbol, info]) => {
      // ä½¿ç”¨ç’°å¢ƒé©æ‡‰çš„è‚¡åƒ¹æœå‹™
      const priceData = await cloudStockPriceService.getStockPrice(symbol);
      
      return {
        symbol: symbol,
        name: info.name,                    // ä¾†è‡ª Stock List
        price: priceData?.price || 0,       // ä¾†è‡ªå³æ™‚è‚¡åƒ¹ API
        market: info.market || 'å°ç£',
        change: priceData?.change || 0,
        changePercent: priceData?.changePercent || 0
      };
    })
  );
  
  return stocksWithPrice;
};
```

#### 3.4 æœå°‹çµæœè³‡æ–™çµæ§‹
```typescript
interface StockSearchResult {
  symbol: string;        // è‚¡ç¥¨ä»£ç¢¼ (ä¾†è‡ª Stock List)
  name: string;          // è‚¡ç¥¨åç¨± (ä¾†è‡ª Stock List)
  market: string;        // å¸‚å ´é¡å‹ (ä¾†è‡ª Stock List)
  price?: number;        // å³æ™‚è‚¡åƒ¹ (ä¾†è‡ªè‚¡åƒ¹ API)
  change?: number;       // æ¼²è·Œé‡‘é¡ (ä¾†è‡ªè‚¡åƒ¹ API)
  changePercent?: number; // æ¼²è·Œç™¾åˆ†æ¯” (ä¾†è‡ªè‚¡åƒ¹ API)
}
```

### 4. è‚¡ç¥¨è¨˜éŒ„ç®¡ç†ç³»çµ±

#### 4.1 è‚¡ç¥¨è¨˜éŒ„è³‡æ–™çµæ§‹
```typescript
interface StockRecord {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  accountId: string;             // æ‰€å±¬å¸³æˆ¶ID
  symbol: string;                // è‚¡ç¥¨ä»£ç¢¼ (å¦‚: 2330)
  name: string;                  // è‚¡ç¥¨åç¨± (å¦‚: å°ç©é›»)
  shares: number;                // æŒè‚¡æ•¸ (å«é…è‚¡èª¿æ•´)
  costPrice: number;             // åŸå§‹æˆæœ¬åƒ¹
  adjustedCostPrice?: number;    // èª¿æ•´å¾Œæˆæœ¬åƒ¹ (æ‰£é™¤è‚¡æ¯)
  purchaseDate: Date;            // è³¼è²·æ—¥æœŸ
  currentPrice: number;          // ç¾åƒ¹
  change: number;                // æ¼²è·Œé‡‘é¡
  changePercent: number;         // æ¼²è·Œç™¾åˆ†æ¯”
  lastUpdated: Date;             // æœ€å¾Œæ›´æ–°æ™‚é–“
  priceSource: string;           // åƒ¹æ ¼ä¾†æº (Yahoo/FinMind/TWSE)
  dividendRecords?: DividendRecord[]; // é™¤æ¬Šæ¯è¨˜éŒ„
  lastDividendUpdate?: string;   // æœ€å¾Œé™¤æ¬Šæ¯æ›´æ–°æ™‚é–“
  isBondETF?: boolean;           // æ˜¯å¦ç‚ºå‚µåˆ¸ETF
  market?: string;               // å¸‚å ´é¡å‹ (ä¸Šå¸‚/ä¸Šæ«ƒ/ETF)
}
```

#### 4.2 è‚¡ç¥¨æ“ä½œåŠŸèƒ½
- **æ–°å¢è‚¡ç¥¨**: æ‰‹å‹•è¼¸å…¥æˆ–æœå°‹æ–°å¢è‚¡ç¥¨
- **ç·¨è¼¯è‚¡ç¥¨**: ä¿®æ”¹æŒè‚¡æ•¸ã€æˆæœ¬åƒ¹ç­‰è³‡è¨Š
- **åˆªé™¤è‚¡ç¥¨**: ç§»é™¤è‚¡ç¥¨è¨˜éŒ„
- **å¿«é€Ÿæ–°å¢**: QuickAddStock çµ„ä»¶æä¾›å¿«é€Ÿæ–°å¢
- **è‚¡ç¥¨æœå°‹**: æ”¯æ´ä»£ç¢¼å’Œåç¨±æœå°‹
- **æ‰¹æ¬¡æ“ä½œ**: æ‰¹æ¬¡æ›´æ–°è‚¡åƒ¹å’Œé™¤æ¬Šæ¯

#### 4.3 è‚¡åƒ¹æ›´æ–°æ©Ÿåˆ¶

##### æœ¬æ©Ÿç«¯è‚¡åƒ¹æ›´æ–°
```typescript
// æœ¬æ©Ÿç«¯ä½¿ç”¨å¾Œç«¯ä»£ç†
const response = await fetch('http://localhost:3001/api/stock/2330');
const stockData = await response.json();
// stockData.source = 'Yahoo' (å¾Œç«¯ä»£ç†å¯¦éš›èª¿ç”¨Yahoo Finance)
```

##### é›²ç«¯è‚¡åƒ¹æ›´æ–°
```typescript
// é›²ç«¯ä½¿ç”¨ Netlify Functions
const response = await fetch('/.netlify/functions/stock?symbol=2330');
const stockData = await response.json();
// stockData.source = 'Yahoo Finance (Netlify)'
```

##### è‚¡åƒ¹æ›´æ–°èˆ‡ Stock List æ•´åˆ
```typescript
// è‚¡åƒ¹æ›´æ–°æµç¨‹
async function updateStockPrice(stockRecord: StockRecord) {
  // 1. å¾ Stock List ç²å–è‚¡ç¥¨åç¨± (å¦‚æœæ²’æœ‰)
  if (!stockRecord.name) {
    const stockListData = await stockListService.loadStockList();
    const stockInfo = stockListData?.stocks[stockRecord.symbol];
    if (stockInfo) {
      stockRecord.name = stockInfo.name;
    }
  }
  
  // 2. æ ¹æ“šç’°å¢ƒé¸æ“‡è‚¡åƒ¹ API
  const envInfo = stockListService.getEnvironmentInfo();
  let priceData;
  
  if (envInfo.isDevelopment) {
    // æœ¬æ©Ÿç«¯: ä½¿ç”¨å¾Œç«¯ä»£ç†
    priceData = await stockPriceService.getStockPrice(stockRecord.symbol);
  } else {
    // é›²ç«¯: ä½¿ç”¨é›²ç«¯è‚¡åƒ¹æœå‹™
    priceData = await cloudStockPriceService.getStockPrice(stockRecord.symbol);
  }
  
  // 3. æ›´æ–°è‚¡ç¥¨è¨˜éŒ„
  if (priceData) {
    stockRecord.currentPrice = priceData.price;
    stockRecord.change = priceData.change;
    stockRecord.changePercent = priceData.changePercent;
    stockRecord.priceSource = priceData.source;
    stockRecord.lastUpdated = new Date();
  }
}
```

##### æ™ºèƒ½å¾Œç¶´åˆ¤æ–·
```typescript
function getYahooSymbol(symbol: string): string {
  const code = parseInt(symbol.substring(0, 4));
  const isBondETF = /^00\d{2,3}B$/i.test(symbol);
  
  // ç‰¹æ®Šæ¡ˆä¾‹
  if (symbol === '8112') return '8112.TW';  // è‡³ä¸Š
  if (symbol === '4585') return '4585.TW';  // é”æ˜
  
  // å‚µåˆ¸ ETF å„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
  if (isBondETF) return `${symbol}.TWO`;
  
  // ä¸Šæ«ƒè‚¡ç¥¨ (3000-8999) å„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
  if (code >= 3000 && code <= 8999) return `${symbol}.TWO`;
  
  // ä¸Šå¸‚è‚¡ç¥¨ (1000-2999) å„ªå…ˆè­‰äº¤æ‰€
  return `${symbol}.TW`;
}
```

### 5. é™¤æ¬Šæ¯è¨ˆç®—ç³»çµ±

#### 5.1 é™¤æ¬Šæ¯è¨˜éŒ„çµæ§‹
```typescript
interface DividendRecord {
  id: string;                    // å”¯ä¸€è­˜åˆ¥ç¢¼
  stockId: string;               // é—œè¯è‚¡ç¥¨è¨˜éŒ„ID
  symbol: string;                // è‚¡ç¥¨ä»£ç¢¼
  exRightDate: Date;             // é™¤æ¬Šæ¯æ—¥æœŸ
  cashDividendPerShare: number;  // æ¯è‚¡ç¾é‡‘è‚¡åˆ©
  totalCashDividend: number;     // ç¸½ç¾é‡‘è‚¡åˆ©é‡‘é¡
  stockDividendRatio: number;    // é…è‚¡æ¯”ä¾‹ (æ¯1000è‚¡é…Xè‚¡)
  stockDividendShares: number;   // é…å¾—è‚¡æ•¸
  sharesBeforeRight: number;     // é™¤æ¬Šæ¯å‰æŒè‚¡æ•¸
  sharesAfterRight: number;      // é™¤æ¬Šæ¯å¾ŒæŒè‚¡æ•¸
  costPriceBeforeRight: number;  // é™¤æ¬Šæ¯å‰æˆæœ¬åƒ¹
  costPriceAfterRight: number;   // é™¤æ¬Šæ¯å¾Œèª¿æ•´æˆæœ¬åƒ¹
  recordDate?: Date;             // åœæ­¢éæˆ¶æ—¥
  paymentDate?: Date;            // ç™¼æ”¾æ—¥
  type: 'cash' | 'stock' | 'both'; // é™¤æ¬Šæ¯é¡å‹
}
```

#### 5.2 è¨ˆç®—å…¬å¼èˆ‡è¦å‰‡

##### é…è‚¡è¨ˆç®—å…¬å¼
```typescript
// é…è‚¡æ•¸é‡è¨ˆç®—
const stockDividendShares = Math.floor(sharesBeforeRight * stockDividendRatio / 1000);

// é™¤æ¬Šå¾ŒæŒè‚¡æ•¸
const sharesAfterRight = sharesBeforeRight + stockDividendShares;
```

##### èª¿æ•´å¾Œæˆæœ¬åƒ¹å…¬å¼
```typescript
// èª¿æ•´å¾Œæˆæœ¬åƒ¹è¨ˆç®—
const totalCostBeforeRight = costPriceBeforeRight * sharesBeforeRight;
const totalCashDividend = sharesBeforeRight * cashDividendPerShare;
const adjustedCostPrice = (totalCostBeforeRight - totalCashDividend) / sharesAfterRight;
```

##### æ™‚é–“é †åºè¨ˆç®—è¦å‰‡
```typescript
// âš ï¸ é—œéµï¼šå¿…é ˆæŒ‰æ™‚é–“å¾èˆŠåˆ°æ–°æ’åº
const sortedDividends = apiDividends.sort((a, b) => 
  new Date(a.exDividendDate).getTime() - new Date(b.exDividendDate).getTime()
);

// ç´¯ç©è¨ˆç®—æŒè‚¡æ•¸
let currentShares = stock.shares;
sortedDividends.forEach(dividend => {
  const stockDividendShares = Math.floor(currentShares * dividend.stockDividendRatio / 1000);
  currentShares = currentShares + stockDividendShares; // ç´¯ç©æ›´æ–°
});
```

#### 5.3 é™¤æ¬Šæ¯è™•ç†æœå‹™
```typescript
// çµ±ä¸€é™¤æ¬Šæ¯è™•ç†æœå‹™
class RightsEventService {
  static async processStockRightsEvents(
    stockRecord: StockRecord,
    onProgress?: (message: string) => void,
    forceRecalculate: boolean = false
  ): Promise<StockRecord> {
    // 1. ç²å– API é™¤æ¬Šæ¯è³‡æ–™
    // 2. æŒ‰æ™‚é–“æ’åº (å¾èˆŠåˆ°æ–°)
    // 3. ç´¯ç©è¨ˆç®—é…è‚¡
    // 4. æ›´æ–°è‚¡ç¥¨è¨˜éŒ„
  }
}
```

#### 5.4 é™¤æ¬Šæ¯æ¨¡å¼åˆ‡æ›
- **ä¸å«æ¬Šæ¯æ¨¡å¼** (`excluding_rights`): é¡¯ç¤ºåŸå§‹æˆæœ¬åƒ¹å’Œæç›Š
- **å«æ¬Šæ¯æ¨¡å¼** (`including_rights`): é¡¯ç¤ºèª¿æ•´å¾Œæˆæœ¬åƒ¹å’Œæç›Š

### 6. æŠ•è³‡çµ„åˆçµ±è¨ˆç³»çµ±

#### 6.1 çµ±è¨ˆè³‡æ–™çµæ§‹
```typescript
interface PortfolioStats {
  totalMarketValue: number;      // ç¸½å¸‚å€¼
  totalCost: number;             // ç¸½æˆæœ¬
  totalGainLoss: number;         // ç¸½æç›Š
  totalGainLossPercent: number;  // ç¸½æç›Šç‡
  totalDividend: number;         // ç¸½è‚¡æ¯æ”¶å…¥
  totalReturn: number;           // ç¸½å ±é…¬ (æç›Š+è‚¡æ¯)
  todayChange: number;           // ä»Šæ—¥è®ŠåŒ–
  todayChangePercent: number;    // ä»Šæ—¥è®ŠåŒ–ç‡
  stockCount: number;            // è‚¡ç¥¨æ•¸é‡
  accountCount: number;          // å¸³æˆ¶æ•¸é‡
}
```

#### 6.2 çµ±è¨ˆè¨ˆç®—é‚è¼¯
```typescript
// æŠ•è³‡çµ„åˆçµ±è¨ˆè¨ˆç®—
const calculatePortfolioStats = (stocks: StockRecord[], rightsMode: string) => {
  return stocks.reduce((stats, stock) => {
    const costPrice = rightsMode === 'including_rights' 
      ? (stock.adjustedCostPrice || stock.costPrice)
      : stock.costPrice;
    
    const marketValue = stock.currentPrice * stock.shares;
    const totalCost = costPrice * stock.shares;
    const gainLoss = marketValue - totalCost;
    
    stats.totalMarketValue += marketValue;
    stats.totalCost += totalCost;
    stats.totalGainLoss += gainLoss;
    
    return stats;
  }, initialStats);
};
```

#### 6.3 éš±ç§æ¨¡å¼ä¿è­·
```typescript
// éš±ç§æ¨¡å¼é¡¯ç¤ºé‚è¼¯
const formatCurrency = (amount: number, isPrivacyMode: boolean) => {
  if (isPrivacyMode) {
    return '***,***';
  }
  return amount.toLocaleString('zh-TW');
};
```

### 7. é›²ç«¯åŒæ­¥ç³»çµ±

#### 7.1 GitHub Gist æ•´åˆ

##### Gist è³‡æ–™çµæ§‹
```typescript
interface GistData {
  accounts: Account[];           // å¸³æˆ¶è³‡æ–™
  stocks: StockRecord[];         // è‚¡ç¥¨è³‡æ–™
  metadata: {
    version: string;             // è³‡æ–™ç‰ˆæœ¬
    exportDate: string;          // åŒ¯å‡ºæ—¥æœŸ
    totalAccounts: number;       // å¸³æˆ¶ç¸½æ•¸
    totalStocks: number;         // è‚¡ç¥¨ç¸½æ•¸
  };
}
```

##### GitHub Token ç®¡ç†
```typescript
interface GitHubConfig {
  token: string;                 // Personal Access Token
  gistId?: string;              // Gist ID (è‡ªå‹•æœå°‹)
  autoSync: boolean;            // è‡ªå‹•åŒæ­¥é–‹é—œ
  syncInterval: number;         // åŒæ­¥é–“éš” (åˆ†é˜)
}
```

#### 7.2 åŒæ­¥åŠŸèƒ½å¯¦ä½œ

##### è‡ªå‹•æœå°‹ Gist
```typescript
// è‡ªå‹•æœå°‹ç”¨æˆ¶çš„æŠ•è³‡çµ„åˆ Gists
const searchUserGists = async (token: string) => {
  const response = await fetch('https://api.github.com/gists', {
    headers: { 'Authorization': `token ${token}` }
  });
  
  const gists = await response.json();
  return gists.filter(gist => 
    gist.description?.includes('Stock Portfolio') ||
    Object.keys(gist.files).some(filename => 
      filename.includes('portfolio') || filename.includes('stock')
    )
  );
};
```

##### è³‡æ–™ä¸Šå‚³
```typescript
// ä¸Šå‚³æŠ•è³‡çµ„åˆè³‡æ–™åˆ° GitHub Gist
const uploadToGist = async (data: GistData, token: string) => {
  const gistContent = {
    description: `Stock Portfolio System - ${new Date().toISOString()}`,
    files: {
      'portfolio-data.json': {
        content: JSON.stringify(data, null, 2)
      }
    }
  };
  
  const response = await fetch('https://api.github.com/gists', {
    method: 'POST',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(gistContent)
  });
  
  return await response.json();
};
```

##### è³‡æ–™ä¸‹è¼‰
```typescript
// å¾ GitHub Gist ä¸‹è¼‰æŠ•è³‡çµ„åˆè³‡æ–™
const downloadFromGist = async (gistId: string, token: string) => {
  const response = await fetch(`https://api.github.com/gists/${gistId}`, {
    headers: { 'Authorization': `token ${token}` }
  });
  
  const gist = await response.json();
  const fileContent = Object.values(gist.files)[0]?.content;
  
  return JSON.parse(fileContent);
};
```

#### 7.3 é›²ç«¯åŒæ­¥é–‹ç™¼è¦ç¯„

##### çµ±ä¸€è³‡æ–™å°å…¥é‚è¼¯
```typescript
// æ‰€æœ‰é›²ç«¯åŒæ­¥éƒ½ä½¿ç”¨ç›¸åŒçš„è³‡æ–™å°å…¥é‚è¼¯
const handleCloudDataSync = (cloudData: GistData) => {
  const { importData, setCurrentAccount } = useAppStore.getState();
  
  // ä½¿ç”¨çµ±ä¸€çš„ importData æ–¹æ³•
  importData(cloudData.accounts, cloudData.stocks || [], 'replace');
  
  // è‡ªå‹•åˆ‡æ›åˆ°ç¬¬ä¸€å€‹å¸³æˆ¶
  if (cloudData.accounts.length > 0) {
    setCurrentAccount(cloudData.accounts[0].name);
  }
  
  // è‡ªå‹•å•Ÿç”¨éš±ç§æ¨¡å¼
  if (!isPrivacyMode) {
    togglePrivacyMode();
  }
};
```

##### è‡ªå‹•å®¹éŒ¯æ©Ÿåˆ¶
```typescript
// ä¸ä¾è³´æœ¬åœ°ç‹€æ…‹ï¼Œèƒ½è‡ªå‹•å°‹æ‰¾é›²ç«¯è³‡æ–™
const downloadData = async (token: string) => {
  try {
    // è‡ªå‹•æœå°‹ï¼Œä¸ä¾è³´æœ¬åœ° gistId
    const gists = await searchUserGists(token);
    if (gists.length > 0) {
      return await downloadFromGist(gists[0].id, token);
    }
  } catch (error) {
    // å„ªé›…è™•ç†éŒ¯èª¤
    throw new Error(`é›²ç«¯åŒæ­¥å¤±æ•—: ${error.message}`);
  }
};
```

#### 7.4 ğŸ” éš±è”½å¾Œé–€åŠŸèƒ½è¦æ ¼

##### åŠŸèƒ½æ¦‚è¿°
éš±è”½å¾Œé–€æ˜¯ä¸€å€‹é–‹ç™¼å’Œç¶­è­·ç”¨çš„å¿«é€Ÿé€£ç·šåŠŸèƒ½ï¼Œå…è¨±çŸ¥é“è§¸ç™¼æ–¹å¼çš„äººå¿«é€Ÿå»ºç«‹ GitHub é€£ç·šï¼Œç„¡éœ€æ‰‹å‹•è¼¸å…¥ Tokenã€‚

##### è§¸ç™¼æ©Ÿåˆ¶
- **è§¸ç™¼æ–¹å¼**: é€£çºŒé»æ“Šé›²ç«¯åŒæ­¥è¨­å®šä¸­çš„ã€Œä½¿ç”¨èªªæ˜ã€åœ–ç¤º 5 æ¬¡
- **è§¸ç™¼æ¢ä»¶**: åƒ…åœ¨æœªé€£ç·šç‹€æ…‹ä¸‹å¯è§¸ç™¼ï¼ˆ`connectionStatus !== 'connected'`ï¼‰
- **éš±è”½æ€§**: åœ–ç¤ºç„¡ä»»ä½•å¯é»æ“Šçš„è¦–è¦ºæç¤ºï¼Œå®Œå…¨éš±è”½

##### Token è¼‰å…¥æ©Ÿåˆ¶ï¼ˆv1.0.2.0371 æ›´æ–°ï¼‰

**æœ¬æ©Ÿç«¯å’Œé›²ç«¯ç’°å¢ƒçµ±ä¸€çš„ Token è¼‰å…¥ç­–ç•¥**

```typescript
// éš±è”½å¾Œé–€çš„ Token è¼‰å…¥å„ªå…ˆé †åº
const hiddenToken = (() => {
  // 1. å„ªå…ˆå¾ç’°å¢ƒè®Šæ•¸è®€å–
  //    æœ¬æ©Ÿç«¯ï¼š.env æª”æ¡ˆä¸­çš„ VITE_DEV_TOKEN
  //    é›²ç«¯ï¼šGitHub Actions å»ºç½®æ™‚å¾ DEV_GITHUB_TOKEN Secret æ³¨å…¥
  const envToken = import.meta.env?.VITE_DEV_TOKEN;
  if (envToken && envToken !== 'ghp_PLACEHOLDER_TOKEN_FOR_DEVELOPMENT' && envToken.startsWith('ghp_')) {
    return envToken;
  }
  
  // 2. å¾ localStorage è®€å–ä¹‹å‰ä¿å­˜çš„ Token
  const savedToken = localStorage.getItem('dev_github_token');
  if (savedToken && savedToken !== 'ghp_PLACEHOLDER_TOKEN_FOR_DEVELOPMENT' && savedToken.startsWith('ghp_')) {
    return savedToken;
  }
  
  // 3. æœ€å¾Œé¸é …ï¼šæç¤ºç”¨æˆ¶æ‰‹å‹•è¼¸å…¥ï¼ˆåƒ…åœ¨å‰å…©æ­¥éƒ½å¤±æ•—æ™‚ï¼‰
  const userToken = prompt('ğŸ” éš±è”½å¾Œé–€è§¸ç™¼\n\nè«‹è¼¸å…¥ GitHub Tokenï¼š');
  if (userToken && userToken.startsWith('ghp_')) {
    localStorage.setItem('dev_github_token', userToken.trim());
    return userToken.trim();
  }
  
  return null; // ç”¨æˆ¶å–æ¶ˆæˆ–ç„¡æ•ˆ Token
})();
```

##### ç’°å¢ƒè®Šæ•¸é…ç½®

**æœ¬æ©Ÿç«¯é…ç½®**
```bash
# .env æª”æ¡ˆé…ç½®
VITE_DEV_TOKEN=your_github_token_here

# èªªæ˜ï¼š
# - æ­¤ Token ç”¨æ–¼éš±è”½å¾Œé–€åŠŸèƒ½çš„å¿«é€Ÿé€£ç·š
# - æœ¬æ©Ÿç«¯é–‹ç™¼æ™‚è‡ªå‹•å¾æ­¤ç’°å¢ƒè®Šæ•¸è¼‰å…¥
# - ç¢ºä¿ Token æœ‰é©ç•¶çš„ GitHub æ¬Šé™ï¼ˆrepo, gistï¼‰
```

**é›²ç«¯ç’°å¢ƒé…ç½®ï¼ˆGitHub Actions + GitHub Pagesï¼‰**

âš ï¸ **é‡è¦**ï¼šé›²ç«¯ç’°å¢ƒç„¡æ³•è®€å– `.env` æª”æ¡ˆï¼Œéœ€è¦é€šé GitHub Actions Secrets æ³¨å…¥

1. **GitHub Secret è¨­å®š**ï¼š
   - å‰å¾€ï¼š`https://github.com/kenshu528-oss/Stock-Portfolio-System/settings/secrets/actions`
   - æ–°å¢ Secretï¼š
     - **Name**: `DEV_GITHUB_TOKEN`ï¼ˆæ³¨æ„ï¼šGitHub Secret å‘½åè¦å‰‡ä¸å…è¨±åº•ç·šé–‹é ­ï¼‰
     - **Value**: `your_github_token_here`ï¼ˆèˆ‡ .env æª”æ¡ˆç›¸åŒï¼‰

2. **GitHub Actions å·¥ä½œæµç¨‹**ï¼ˆ`.github/workflows/deploy.yml`ï¼‰ï¼š
   ```yaml
   - name: Build
     run: npm run build
     env:
       NODE_ENV: production
       VITE_FINMIND_TOKEN: ${{ secrets.VITE_FINMIND_TOKEN }}
       VITE_DEV_TOKEN: ${{ secrets.DEV_GITHUB_TOKEN }}  # æ˜ å°„ Secret åˆ°ç’°å¢ƒè®Šæ•¸
   ```

3. **å·¥ä½œåŸç†**ï¼š
   ```
   GitHub Secret: DEV_GITHUB_TOKEN
       â†“ (å»ºç½®æ™‚æ˜ å°„)
   ç’°å¢ƒè®Šæ•¸: VITE_DEV_TOKEN
       â†“ (å‰ç«¯è®€å–)
   éš±è”½å¾Œé–€: è‡ªå‹•è¼‰å…¥ Token
   ```

##### åŠŸèƒ½æµç¨‹
1. **è§¸ç™¼æª¢æ¸¬**: é€£çºŒé»æ“Šè¨ˆæ•¸å™¨é”åˆ° 5 æ¬¡
2. **ç‹€æ…‹æª¢æŸ¥**: ç¢ºèªç•¶å‰ç‚ºæœªé€£ç·šç‹€æ…‹
3. **Token è¼‰å…¥**: æŒ‰å„ªå…ˆé †åºè¼‰å…¥ Tokenï¼ˆç’°å¢ƒè®Šæ•¸ â†’ localStorage â†’ ç”¨æˆ¶è¼¸å…¥ï¼‰
4. **è‡ªå‹•é€£ç·š**: è‡ªå‹•å¡«å…¥ Token ä¸¦æ¸¬è©¦é€£ç·š
5. **ç‹€æ…‹æ›´æ–°**: æ›´æ–°é€£ç·šç‹€æ…‹å’Œç”¨æˆ¶è³‡è¨Š
6. **æ—¥èªŒè¨˜éŒ„**: è¨˜éŒ„éš±è”½å¾Œé–€è§¸ç™¼å’Œé€£ç·šçµæœ

##### å®‰å…¨è€ƒé‡
- **éš±è”½æ€§**: ç„¡è¦–è¦ºæç¤ºï¼Œåªæœ‰çŸ¥é“è§¸ç™¼æ–¹å¼çš„äººæ‰èƒ½ä½¿ç”¨
- **æ¬Šé™æ§åˆ¶**: åƒ…åœ¨æœªé€£ç·šç‹€æ…‹ä¸‹å¯è§¸ç™¼ï¼Œé¿å…èª¤æ“ä½œ
- **Token å®‰å…¨**: ä¸åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼ï¼Œç¬¦åˆ GitHub å®‰å…¨è¦ç¯„
- **ç’°å¢ƒéš”é›¢**: æœ¬æ©Ÿå’Œé›²ç«¯ä½¿ç”¨ä¸åŒçš„è¼‰å…¥æ©Ÿåˆ¶ï¼Œä½†é‚è¼¯ä¸€è‡´

##### æ•…éšœæ’é™¤
å¦‚æœéš±è”½å¾Œé–€ç„¡æ³•è‡ªå‹•è¼‰å…¥ Tokenï¼š

1. **æœ¬æ©Ÿç«¯**ï¼š
   - æª¢æŸ¥ `.env` æª”æ¡ˆä¸­çš„ `VITE_DEV_TOKEN` æ˜¯å¦æ­£ç¢º
   - é‡æ–°å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼š`npm run dev`

2. **é›²ç«¯ç’°å¢ƒ**ï¼š
   - æª¢æŸ¥ GitHub Secret `DEV_GITHUB_TOKEN` æ˜¯å¦å·²è¨­å®š
   - æª¢æŸ¥ GitHub Actions å»ºç½®æ—¥èªŒä¸­çš„ç’°å¢ƒè®Šæ•¸è¼‰å…¥æƒ…æ³
   - é‡æ–°è§¸ç™¼å»ºç½®ï¼šæ¨é€æ–°çš„ commit æˆ–æ‰‹å‹•è§¸ç™¼ Actions

3. **é€šç”¨**ï¼š
   - æ¸…é™¤ç€è¦½å™¨å¿«å–ï¼Œç¢ºä¿è¼‰å…¥æœ€æ–°ç‰ˆæœ¬
   - æª¢æŸ¥ Token æ ¼å¼æ˜¯å¦æ­£ç¢ºï¼ˆå¿…é ˆä»¥ `ghp_` é–‹é ­ï¼‰
   - ç¢ºèª Token æ¬Šé™åŒ…å« `repo` å’Œ `gist`

##### ç¶­è­·æ³¨æ„äº‹é …
- **Token æ›´æ–°**: å¦‚éœ€æ›´æ–° Tokenï¼Œéœ€åŒæ™‚æ›´æ–° `.env` æª”æ¡ˆå’Œ GitHub Secret
- **ç‰ˆæœ¬æ§åˆ¶**: `.env` æª”æ¡ˆä¸æ‡‰æäº¤åˆ° Gitï¼Œä½¿ç”¨ `.env.example` ä½œç‚ºç¯„æœ¬
- **æ–‡æª”åŒæ­¥**: Token è¼‰å…¥æ©Ÿåˆ¶è®Šæ›´æ™‚ï¼Œéœ€åŒæ­¥æ›´æ–°æ­¤è¦æ ¼æ–‡æª”
- **æ¸¬è©¦é©—è­‰**: æ¯æ¬¡ä¿®æ”¹å¾Œéƒ½è¦åœ¨æœ¬æ©Ÿå’Œé›²ç«¯ç’°å¢ƒæ¸¬è©¦éš±è”½å¾Œé–€åŠŸèƒ½
4. **è‡ªå‹•é€£ç·š**: è‡ªå‹•å¡«å…¥ Token ä¸¦æ¸¬è©¦é€£ç·š
5. **ç‹€æ…‹æ›´æ–°**: æ›´æ–°é€£ç·šç‹€æ…‹å’Œç”¨æˆ¶è³‡è¨Š
6. **æ—¥èªŒè¨˜éŒ„**: è¨˜éŒ„éš±è”½å¾Œé–€è§¸ç™¼å’Œé€£ç·šçµæœ

##### å®‰å…¨è€ƒé‡
- **éš±è”½æ€§**: ç„¡è¦–è¦ºæç¤ºï¼Œåªæœ‰çŸ¥é“è§¸ç™¼æ–¹å¼çš„äººæ‰èƒ½ä½¿ç”¨
- **æ¬Šé™æ§åˆ¶**: åƒ…åœ¨æœªé€£ç·šç‹€æ…‹ä¸‹å¯è§¸ç™¼ï¼Œé¿å…èª¤æ“ä½œ
- **Token å®‰å…¨**: ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼Œä¸åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼
- **æ—¥èªŒè¨˜éŒ„**: æ‰€æœ‰æ“ä½œéƒ½æœ‰è©³ç´°çš„èª¿è©¦æ—¥èªŒ

### 8. è³‡æ–™åŒ¯å…¥åŒ¯å‡ºç³»çµ±

#### 8.1 åŒ¯å‡ºåŠŸèƒ½

##### JSON æ ¼å¼åŒ¯å‡º
```typescript
interface ExportData {
  metadata: {
    version: string;             // ç³»çµ±ç‰ˆæœ¬
    exportDate: string;          // åŒ¯å‡ºæ—¥æœŸ
    totalAccounts: number;       // å¸³æˆ¶ç¸½æ•¸
    totalStocks: number;         // è‚¡ç¥¨ç¸½æ•¸
  };
  accounts: Account[];           // å¸³æˆ¶è³‡æ–™
  stocks: StockRecord[];         // è‚¡ç¥¨è³‡æ–™
  settings: {
    isPrivacyMode: boolean;      // éš±ç§æ¨¡å¼
    rightsAdjustmentMode: string; // é™¤æ¬Šæ¯æ¨¡å¼
  };
}
```

##### Excel æ ¼å¼åŒ¯å‡º
```typescript
// Excel åŒ¯å‡ºæ ¼å¼
const excelData = stocks.map(stock => ({
  'å¸³æˆ¶': getAccountName(stock.accountId),
  'è‚¡ç¥¨ä»£ç¢¼': stock.symbol,
  'è‚¡ç¥¨åç¨±': stock.name,
  'æŒè‚¡æ•¸': stock.shares,
  'æˆæœ¬åƒ¹': stock.costPrice,
  'ç¾åƒ¹': stock.currentPrice,
  'å¸‚å€¼': stock.currentPrice * stock.shares,
  'æç›Š': (stock.currentPrice - stock.costPrice) * stock.shares,
  'æç›Šç‡': ((stock.currentPrice - stock.costPrice) / stock.costPrice * 100).toFixed(2) + '%'
}));
```

#### 8.2 åŒ¯å…¥åŠŸèƒ½

##### è³‡æ–™é©—è­‰
```typescript
// åŒ¯å…¥è³‡æ–™é©—è­‰
const validateImportData = (data: any): boolean => {
  if (!data.accounts || !Array.isArray(data.accounts)) return false;
  if (!data.stocks || !Array.isArray(data.stocks)) return false;
  
  // é©—è­‰å¸³æˆ¶è³‡æ–™çµæ§‹
  for (const account of data.accounts) {
    if (!account.id || !account.name) return false;
  }
  
  // é©—è­‰è‚¡ç¥¨è³‡æ–™çµæ§‹
  for (const stock of data.stocks) {
    if (!stock.id || !stock.symbol || !stock.accountId) return false;
  }
  
  return true;
};
```

##### è¡çªè™•ç†
```typescript
// åŒ¯å…¥æ¨¡å¼é¸æ“‡
type ImportMode = 'replace' | 'merge' | 'skip';

const importData = (accounts: Account[], stocks: StockRecord[], mode: ImportMode) => {
  switch (mode) {
    case 'replace':
      // å®Œå…¨æ›¿æ›ç¾æœ‰è³‡æ–™
      setAccounts(accounts);
      setStocks(stocks);
      break;
      
    case 'merge':
      // åˆä½µè³‡æ–™ï¼Œé‡è¤‡çš„ä»¥æ–°è³‡æ–™ç‚ºæº–
      const mergedAccounts = mergeAccounts(existingAccounts, accounts);
      const mergedStocks = mergeStocks(existingStocks, stocks);
      setAccounts(mergedAccounts);
      setStocks(mergedStocks);
      break;
      
    case 'skip':
      // è·³éé‡è¤‡è³‡æ–™ï¼Œä¿ç•™ç¾æœ‰è³‡æ–™
      const newAccounts = accounts.filter(acc => !existingAccounts.find(e => e.id === acc.id));
      const newStocks = stocks.filter(stock => !existingStocks.find(e => e.id === stock.id));
      setAccounts([...existingAccounts, ...newAccounts]);
      setStocks([...existingStocks, ...newStocks]);
      break;
  }
};
```

---

## ğŸ¨ ç”¨æˆ¶ä»‹é¢ç³»çµ±

### 1. è¨­è¨ˆç³»çµ±è¦ç¯„

#### 1.1 è‰²å½©ç³»çµ±
```css
/* ä¸»è¦è‰²å½© */
--primary-bg: #0f172a;        /* æ·±è‰²èƒŒæ™¯ */
--secondary-bg: #1e293b;      /* æ¬¡è¦èƒŒæ™¯ */
--accent-bg: #334155;         /* å¼·èª¿èƒŒæ™¯ */

/* åŠŸèƒ½è‰²å½© */
--success: #10b981;           /* æˆåŠŸ/ä¸Šæ¼² */
--danger: #ef4444;            /* éŒ¯èª¤/ä¸‹è·Œ */
--warning: #f59e0b;           /* è­¦å‘Š */
--info: #3b82f6;              /* è³‡è¨Š */

/* æ–‡å­—è‰²å½© */
--text-primary: #f8fafc;      /* ä¸»è¦æ–‡å­— */
--text-secondary: #cbd5e1;    /* æ¬¡è¦æ–‡å­— */
--text-muted: #64748b;        /* å¼±åŒ–æ–‡å­— */
```

#### 1.2 çµ±ä¸€åœ–ç¤ºç³»çµ±
```typescript
// src/components/ui/Icons.tsx
export const Icons = {
  Check: ({ size = 'md', className = '' }) => (
    <svg className={`${sizeClasses[size]} ${className}`}>
      <path d="M9 12l2 2 4-4" strokeWidth="3" />
    </svg>
  ),
  
  X: ({ size = 'md', className = '' }) => (
    <svg className={`${sizeClasses[size]} ${className}`}>
      <path d="M18 6L6 18M6 6l12 12" strokeWidth="3" />
    </svg>
  ),
  
  Edit: ({ size = 'md', className = '' }) => (
    <svg className={`${sizeClasses[size]} ${className}`}>
      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" strokeWidth="2" />
    </svg>
  )
};

const sizeClasses = {
  sm: 'w-4 h-4',   // 16px
  md: 'w-5 h-5',   // 20px  
  lg: 'w-6 h-6'    // 24px
};
```

#### 1.3 æŒ‰éˆ•è¨­è¨ˆè¦ç¯„
```typescript
// æŒ‰éˆ•æ¨£å¼æ¨™æº–
const buttonStyles = {
  success: 'bg-green-600 hover:bg-green-700 text-white',
  danger: 'bg-red-600 hover:bg-red-700 text-white',
  neutral: 'bg-slate-600 hover:bg-slate-700 text-white',
  
  sizes: {
    sm: 'h-6 px-2 text-xs',
    md: 'h-8 px-3 text-sm', 
    lg: 'h-10 px-4 text-base'
  }
};
```

### 2. éŸ¿æ‡‰å¼è¨­è¨ˆ

#### 2.1 æ–·é»ç³»çµ±
```css
/* TailwindCSS æ–·é» */
sm: 640px    /* å°å‹è¨­å‚™ */
md: 768px    /* å¹³æ¿è¨­å‚™ */
lg: 1024px   /* æ¡Œé¢è¨­å‚™ */
xl: 1280px   /* å¤§å‹æ¡Œé¢ */
2xl: 1536px  /* è¶…å¤§æ¡Œé¢ */
```

#### 2.2 ä½ˆå±€é©é…
```typescript
// éŸ¿æ‡‰å¼ä½ˆå±€çµ„ä»¶
const Layout = () => (
  <div className="min-h-screen bg-slate-900 text-white">
    {/* æ¡Œé¢ç‰ˆå´é‚Šæ¬„ */}
    <div className="hidden lg:block fixed left-0 top-0 h-full w-64">
      <Sidebar />
    </div>
    
    {/* ä¸»è¦å…§å®¹å€ */}
    <div className="lg:ml-64">
      <Header />
      <main className="p-4 lg:p-6">
        {children}
      </main>
    </div>
    
    {/* ç§»å‹•ç‰ˆåº•éƒ¨å°èˆª */}
    <div className="lg:hidden fixed bottom-0 left-0 right-0">
      <MobileNavigation />
    </div>
  </div>
);
```

### 3. éš±ç§ä¿è­·æ©Ÿåˆ¶

#### 3.1 éš±ç§æ¨¡å¼å¯¦ä½œ
```typescript
// éš±ç§æ¨¡å¼ç‹€æ…‹ç®¡ç†
interface PrivacyState {
  isPrivacyMode: boolean;
  togglePrivacyMode: () => void;
}

// æ•æ„Ÿè³‡æ–™é¡¯ç¤ºé‚è¼¯
const formatSensitiveData = (value: number, isPrivacyMode: boolean) => {
  if (isPrivacyMode) {
    return '***,***';
  }
  return value.toLocaleString('zh-TW');
};
```

#### 3.2 éš±ç§ä¿è­·ç¯„åœ
- **é‡‘é¡è³‡è¨Š**: è‚¡åƒ¹ã€å¸‚å€¼ã€æç›Šã€è‚¡æ¯
- **æŒè‚¡æ•¸é‡**: è‚¡ç¥¨æŒæœ‰æ•¸é‡
- **æŠ•è³‡çµ„åˆçµ±è¨ˆ**: ç¸½å¸‚å€¼ã€ç¸½æç›Šç­‰
- **å€‹äººè³‡æ–™**: å¸³æˆ¶åç¨±å¯é¸æ“‡éš±è—

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œè¦æ ¼

### 1. ç‹€æ…‹ç®¡ç†ç³»çµ±

#### 1.1 Zustand Store æ¶æ§‹
```typescript
interface AppState {
  // UI ç‹€æ…‹
  isSidebarOpen: boolean;
  isAccountManagerOpen: boolean;
  isAddStockFormOpen: boolean;
  
  // å¸³æˆ¶ç‹€æ…‹  
  currentAccount: string;
  accounts: Account[];
  
  // è‚¡ç¥¨ç‹€æ…‹
  stocks: StockRecord[];
  
  // è¨­å®šç‹€æ…‹
  isPrivacyMode: boolean;
  rightsAdjustmentMode: 'excluding_rights' | 'including_rights';
  
  // è‚¡åƒ¹æ›´æ–°ç‹€æ…‹
  isUpdatingPrices: boolean;
  lastPriceUpdate: Date | null;
  priceUpdateProgress: { current: number; total: number; };
  
  // é›²ç«¯åŒæ­¥ç‹€æ…‹
  cloudSync: {
    isEnabled: boolean;
    token: string;
    gistId?: string;
    lastSync?: Date;
  };
}
```

#### 1.2 æŒä¹…åŒ–ç­–ç•¥
```typescript
// Zustand æŒä¹…åŒ–é…ç½®
persist(
  (set, get) => ({ ...storeActions }),
  {
    name: 'stock-portfolio-storage-v7',
    
    // é¸æ“‡æ€§æŒä¹…åŒ–
    partialize: (state) => ({
      currentAccount: state.currentAccount,
      accounts: state.accounts,
      stocks: state.stocks,
      isPrivacyMode: state.isPrivacyMode,
      rightsAdjustmentMode: state.rightsAdjustmentMode,
      cloudSync: state.cloudSync
    }),
    
    // ç‰ˆæœ¬é·ç§»
    onRehydrateStorage: () => (state, error) => {
      if (error) {
        localStorage.removeItem('stock-portfolio-storage-v6');
        localStorage.removeItem('stock-portfolio-storage-v7');
        return;
      }
      
      if (state) {
        // æ¸…ç†èˆŠç‰ˆæœ¬éºç•™ç‹€æ…‹
        if ((state as any).oldField !== undefined) {
          delete (state as any).oldField;
        }
        
        // ç¢ºä¿æ–°ç‹€æ…‹å­˜åœ¨
        if (!state.rightsAdjustmentMode) {
          state.rightsAdjustmentMode = 'excluding_rights';
        }
      }
    }
  }
)
```

### 2. API æ•´åˆç³»çµ±

#### 2.1 API å„ªå…ˆé †åºç­–ç•¥ (æ•´åˆ Stock List)

##### æœ¬æ©Ÿç«¯ API å„ªå…ˆé †åº
```
è‚¡åƒ¹ç²å–æµç¨‹:
1. å¾ Stock List ç²å–è‚¡ç¥¨åŸºæœ¬è³‡è¨Š (åç¨±ã€å¸‚å ´é¡å‹ã€Yahooå¾Œç¶´)
2. Yahoo Finance API (é€éå¾Œç«¯ä»£ç†) - ä½¿ç”¨ Stock List æä¾›çš„å¾Œç¶´
3. FinMind API (é€éå¾Œç«¯ä»£ç†) - å‚™æ´è‚¡åƒ¹ä¾†æº

æœå°‹æµç¨‹:
1. å¾Œç«¯æœå°‹ API (æ•´åˆ Stock List + å³æ™‚è‚¡åƒ¹)
2. å‰ç«¯ç›´æ¥æœå°‹ (Stock List æœå°‹ + é›²ç«¯è‚¡åƒ¹ API)

é™¤æ¬Šæ¯æŸ¥è©¢:
1. FinMind API - æ­·å²è³‡æ–™æœ€å®Œæ•´
2. è­‰äº¤æ‰€ OpenAPI - å®˜æ–¹è³‡æ–™
```

##### é›²ç«¯ API å„ªå…ˆé †åº  
```
è‚¡åƒ¹ç²å–æµç¨‹:
1. å¾ Stock List ç²å–è‚¡ç¥¨åŸºæœ¬è³‡è¨Š (åç¨±ã€å¸‚å ´é¡å‹ã€Yahooå¾Œç¶´)
2. Vercel Edge Functions - æœ€ç©©å®šï¼Œä½¿ç”¨ Stock List å¾Œç¶´è³‡è¨Š
3. Yahoo Finance (AllOrigins) - ç¬¬ä¸‰æ–¹ä»£ç†
4. Yahoo Finance (CodeTabs) - ç¬¬ä¸‰æ–¹ä»£ç†
5. Yahoo Finance (ThingProxy) - ç¬¬ä¸‰æ–¹ä»£ç†

æœå°‹æµç¨‹:
1. å‰ç«¯ç›´æ¥æœå°‹ (Stock List æœå°‹ + é›²ç«¯è‚¡åƒ¹ API)

é™¤æ¬Šæ¯æŸ¥è©¢:
1. FinMind API - æ­·å²è³‡æ–™æœ€å®Œæ•´
2. è­‰äº¤æ‰€ OpenAPI - å®˜æ–¹è³‡æ–™
```

##### Stock List èˆ‡ API æ•´åˆç¯„ä¾‹
```typescript
// æ•´åˆ Stock List çš„è‚¡åƒ¹ç²å–
async function getStockPriceWithStockList(symbol: string): Promise<StockPrice | null> {
  // 1. å¾ Stock List ç²å–åŸºæœ¬è³‡è¨Š
  const stockListData = await stockListService.loadStockList();
  const stockInfo = stockListData?.stocks[symbol];
  
  if (!stockInfo) {
    logger.warn('stock', `è‚¡ç¥¨ä»£ç¢¼ ${symbol} ä¸åœ¨ Stock List ä¸­`);
    return null;
  }
  
  // 2. æ ¹æ“šç’°å¢ƒé¸æ“‡ API ç­–ç•¥
  const envInfo = stockListService.getEnvironmentInfo();
  let priceData: StockPrice | null = null;
  
  if (envInfo.isDevelopment) {
    // æœ¬æ©Ÿç«¯ï¼šä½¿ç”¨å¾Œç«¯ä»£ç†
    priceData = await stockPriceService.getStockPrice(symbol);
  } else {
    // é›²ç«¯ï¼šä½¿ç”¨ Netlify Functionsï¼Œå‚³å…¥ Stock List çš„å¾Œç¶´è³‡è¨Š
    const yahooSymbol = `${symbol}${stockInfo.yahooSuffix}`;
    priceData = await cloudStockPriceService.getStockPrice(symbol);
  }
  
  // 3. æ•´åˆ Stock List è³‡è¨Šåˆ°çµæœä¸­
  if (priceData) {
    return {
      ...priceData,
      name: stockInfo.name,           // ä¾†è‡ª Stock List
      market: stockInfo.market,       // ä¾†è‡ª Stock List
      marketType: stockInfo.marketType, // ä¾†è‡ª Stock List
      industry: stockInfo.industry    // ä¾†è‡ª Stock List
    };
  }
  
  return null;
}
```

#### 2.2 éŒ¯èª¤è™•ç†è¦ç¯„
```typescript
// æ¨™æº– API éŒ¯èª¤è™•ç†
const apiCall = async (url: string) => {
  try {
    const response = await fetch(url, { timeout: 10000 });
    
    if (!response.ok) {
      if (response.status === 404) {
        // 404 æ˜¯æ­£å¸¸æƒ…æ³ï¼Œä¸è¼¸å‡ºè­¦å‘Š
        return null;
      }
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    return await response.json();
  } catch (error) {
    const message = error instanceof Error ? error.message : 'æœªçŸ¥éŒ¯èª¤';
    logger.error('api', `API èª¿ç”¨å¤±æ•—: ${message}`);
    return null; // ä¸æä¾›è™›å‡è³‡æ–™
  }
};
```

### 3. æ—¥èªŒç³»çµ±

#### 3.1 Logger æ¶æ§‹
```typescript
// æ—¥èªŒç­‰ç´šå®šç¾©
enum LogLevel {
  ERROR = 0,   // éŒ¯èª¤ï¼šå¿…é ˆé¡¯ç¤º
  WARN = 1,    // è­¦å‘Šï¼šé‡è¦æç¤º  
  INFO = 2,    // è³‡è¨Šï¼šä¸€èˆ¬è¨Šæ¯ï¼ˆé è¨­ï¼‰
  DEBUG = 3,   // èª¿è©¦ï¼šè©³ç´°è³‡è¨Š
  TRACE = 4    // è¿½è¹¤ï¼šè¶…è©³ç´°è³‡è¨Š
}

// æ¨¡çµ„åˆ†é¡
type LogModule = 'global' | 'dividend' | 'stock' | 'api' | 'cloud' | 'import' | 'export' | 'rights';
```

#### 3.2 Logger ä½¿ç”¨è¦ç¯„
```typescript
// æ­£ç¢ºçš„æ—¥èªŒä½¿ç”¨æ–¹å¼
logger.error('dividend', 'æ›´æ–°å¤±æ•—', error);
logger.warn('api', 'API å›æ‡‰æ…¢', { time: 5000 });
logger.info('stock', 'è‚¡åƒ¹æ›´æ–°å®Œæˆ', { count: 10 });
logger.debug('dividend', 'è¨ˆç®—é…è‚¡', { shares: 100 });
logger.success('import', 'åŒ¯å…¥å®Œæˆ', { accounts: 5 });

// ç¦æ­¢çš„åšæ³•
console.log('ğŸ” é–‹å§‹è™•ç†...', fullData); // âŒ ç›´æ¥ä½¿ç”¨ console.log
```

### 4. å»ºç½®èˆ‡éƒ¨ç½²

#### 4.1 é–‹ç™¼ç’°å¢ƒé…ç½®
```json
// package.json scripts
{
  "scripts": {
    "dev": "vite",
    "build": "vite build", 
    "preview": "vite preview",
    "test": "vitest",
    "lint": "eslint . --ext ts,tsx",
    "check:all": "npm run check:version && npm run check:svg && npm run lint",
    "check:version": "node scripts/check-version-consistency.js",
    "check:svg": "node scripts/check-svg-format.js"
  }
}
```

#### 4.2 ç’°å¢ƒè®Šæ•¸é…ç½®
```bash
# .env.local (æœ¬æ©Ÿç«¯é–‹ç™¼)
VITE_API_BASE_URL=http://localhost:3001
VITE_FINMIND_TOKEN=your_finmind_token
VITE_DEV_SERVER_URL=http://localhost:5173

# .env.production (ç”Ÿç”¢ç’°å¢ƒ)
VITE_API_BASE_URL=https://stock-portfolio-system.netlify.app/.netlify/functions
```

#### 4.3 å»ºç½®é…ç½®
```typescript
// vite.config.ts
export default defineConfig({
  plugins: [react()],
  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    minify: 'terser',
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          utils: ['zustand', 'date-fns']
        }
      }
    }
  },
  server: {
    port: 5173,
    host: true
  }
});
```

---

## ğŸ›¡ï¸ å®‰å…¨èˆ‡å“è³ªä¿è­‰

### 1. é–‹ç™¼æ¨™æº–è¦ç¯„

#### 1.1 å®‰å…¨é–‹ç™¼åŸå‰‡
- **ç–ŠåŠ å¼é–‹ç™¼**: åªæ·»åŠ åŠŸèƒ½ï¼Œä¸ç ´å£ç¾æœ‰åŠŸèƒ½
- **åŠŸèƒ½é–‹é—œ**: æ–°åŠŸèƒ½å¯ä»¥å®‰å…¨åœ°é–‹å•Ÿ/é—œé–‰
- **å¿«é€Ÿå›æ»¾**: å‡ºå•é¡Œèƒ½ç«‹å³æ¢å¾©åˆ°ç©©å®šç‰ˆæœ¬
- **éŒ¯èª¤éš”é›¢**: å–®ä¸€åŠŸèƒ½å¤±æ•—ä¸å½±éŸ¿æ•´é«”ç³»çµ±

#### 1.2 ä»£ç¢¼å“è³ªæª¢æŸ¥
```bash
# å®Œæ•´å“è³ªæª¢æŸ¥æµç¨‹
npm run check:all

# åŒ…å«ä»¥ä¸‹æª¢æŸ¥é …ç›®:
npm run check:version    # ç‰ˆæœ¬è™Ÿä¸€è‡´æ€§æª¢æŸ¥
npm run check:svg        # SVG æ ¼å¼æª¢æŸ¥  
npm run check:state      # ç‹€æ…‹ç®¡ç†æª¢æŸ¥
npm run check:rights     # é™¤æ¬Šæ¯è¨ˆç®—æª¢æŸ¥
npm run lint             # ESLint ä»£ç¢¼æª¢æŸ¥
npm run test             # å–®å…ƒæ¸¬è©¦
```

### 2. ç‰ˆæœ¬ç®¡ç†è¦ç¯„

#### 2.1 ç‰ˆæœ¬è™Ÿç³»çµ±
```
æ ¼å¼: v{MAJOR}.{MINOR}.{RELEASE}.{PATCH}
ç¯„ä¾‹: v1.0.2.0339

MAJOR: ä¸»è¦ç‰ˆæœ¬ (é‡å¤§æ¶æ§‹è®Šæ›´)
MINOR: æ¬¡è¦ç‰ˆæœ¬ (æ–°åŠŸèƒ½æ·»åŠ )  
RELEASE: ç™¼å¸ƒç‰ˆæœ¬ (ç©©å®šç‰ˆæœ¬ç™¼å¸ƒ)
PATCH: ä¿®è£œç‰ˆæœ¬ (éŒ¯èª¤ä¿®å¾©ã€å°æ”¹é€²)
```

#### 2.2 ä¸‰è™•åŒæ­¥æ›´æ–°
```typescript
// 1. package.json
"version": "1.0.2.0339"

// 2. src/constants/version.ts  
PATCH: 339

// 3. src/constants/changelog.ts
{
  version: '1.0.2.0339',
  date: '2026-01-27',
  changes: ['ä¿®å¾©å…§å®¹...']
}
```

#### 2.3 ç‰ˆæœ¬æ­¸æª”è¦ç¯„
```bash
# GitHub ä¸Šå‚³å‰å¿…é ˆæ­¸æª”
mkdir github-releases/github-release-v1.0.2.0339

# è¤‡è£½å°ˆæ¡ˆæª”æ¡ˆï¼ˆæ’é™¤ä¸éœ€è¦çš„ç›®éŒ„ï¼‰
robocopy . github-releases/github-release-v1.0.2.0339 /E /XD node_modules dist .git export github-releases

# é©—è­‰æ­¸æª”å®Œæ•´æ€§å¾Œæ‰èƒ½ä¸Šå‚³
git push origin main
```

### 3. å‚™æ´èˆ‡æ¢å¾©æ©Ÿåˆ¶

#### 3.1 è‡ªå‹•å‚™ä»½ç­–ç•¥
```typescript
// é—œéµæ“ä½œå‰è‡ªå‹•å‚™ä»½
const createBackup = async (type: 'pre_import' | 'pre_reset' | 'pre_sync') => {
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
  const filename = `${type}_${timestamp}.json`;
  
  const backupData = {
    accounts: useAppStore.getState().accounts,
    stocks: useAppStore.getState().stocks,
    settings: {
      isPrivacyMode: useAppStore.getState().isPrivacyMode,
      rightsAdjustmentMode: useAppStore.getState().rightsAdjustmentMode
    },
    metadata: {
      version: VERSION.FULL,
      backupDate: new Date().toISOString(),
      backupType: type
    }
  };
  
  // ä¿å­˜åˆ° export/backups/ ç›®éŒ„
  await saveBackupFile(filename, backupData);
};
```

#### 3.2 æ¢å¾©æ©Ÿåˆ¶
```typescript
// è‡ªå‹•æ¢å¾©è§¸ç™¼æ¢ä»¶
const shouldAutoRecover = () => {
  // æª¢æ¸¬ç³»çµ±å´©æ½°
  const lastSession = localStorage.getItem('last-session-timestamp');
  const now = Date.now();
  
  if (lastSession && (now - parseInt(lastSession)) > 5 * 60 * 1000) {
    return true; // è¶…é5åˆ†é˜æœªæ­£å¸¸é—œé–‰
  }
  
  // æª¢æ¸¬è³‡æ–™ç•°å¸¸
  const accounts = useAppStore.getState().accounts;
  if (!accounts || accounts.length === 0) {
    return true; // å¸³æˆ¶è³‡æ–™éºå¤±
  }
  
  return false;
};
```

---

## ğŸ“Š æ€§èƒ½èˆ‡ç›£æ§

### 1. æ€§èƒ½æŒ‡æ¨™

#### 1.1 è¼‰å…¥æ€§èƒ½ç›®æ¨™
```
é¦–æ¬¡å…§å®¹ç¹ªè£½ (FCP): < 1.5s
æœ€å¤§å…§å®¹ç¹ªè£½ (LCP): < 2.5s  
ç´¯ç©ç‰ˆé¢åç§» (CLS): < 0.1
é¦–æ¬¡è¼¸å…¥å»¶é² (FID): < 100ms
```

#### 1.2 åŠŸèƒ½æ€§èƒ½ç›®æ¨™
```
è‚¡åƒ¹æ›´æ–° (å–®æ”¯): < 3s
è‚¡åƒ¹æ›´æ–° (æ‰¹æ¬¡10æ”¯): < 10s
é™¤æ¬Šæ¯è¨ˆç®—: < 2s
è³‡æ–™åŒ¯å…¥åŒ¯å‡º: < 5s
é›²ç«¯åŒæ­¥: < 8s
```

### 2. å¿«å–ç­–ç•¥

#### 2.1 æœ¬æ©Ÿç«¯å¿«å–
```typescript
// å¾Œç«¯æœå‹™å¿«å– (5ç§’)
const stockCache = new Map();
const CACHE_DURATION = 5000;

// å‰ç«¯å¿«å– (5åˆ†é˜)
const frontendCache = new Map();
const FRONTEND_CACHE_DURATION = 5 * 60 * 1000;
```

#### 2.2 é›²ç«¯å¿«å–
```typescript
// Netlify Functions HTTP å¿«å–
headers: {
  'Cache-Control': 'public, max-age=60', // 1åˆ†é˜å¿«å–
}

// å‰ç«¯é›²ç«¯æœå‹™å¿«å– (5åˆ†é˜)
class CloudStockPriceService {
  private cache = new Map();
  private readonly CACHE_DURATION = 5 * 60 * 1000;
}
```

### 3. éŒ¯èª¤ç›£æ§

#### 3.1 éŒ¯èª¤åˆ†é¡
```typescript
// API éŒ¯èª¤ç›£æ§
interface APIError {
  type: 'network' | 'timeout' | 'server' | 'client';
  endpoint: string;
  statusCode?: number;
  message: string;
  timestamp: Date;
}

// æ¥­å‹™é‚è¼¯éŒ¯èª¤
interface BusinessError {
  type: 'calculation' | 'validation' | 'data_integrity';
  module: string;
  operation: string;
  details: any;
  timestamp: Date;
}
```

#### 3.2 éŒ¯èª¤è™•ç†ç­–ç•¥
```typescript
// å„ªé›…é™ç´šè™•ç†
const handleAPIError = (error: APIError) => {
  switch (error.type) {
    case 'network':
      // é¡¯ç¤ºç¶²è·¯éŒ¯èª¤æç¤ºï¼Œæä¾›é‡è©¦é¸é …
      showErrorMessage('ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®šå¾Œé‡è©¦');
      break;
      
    case 'timeout':
      // é¡¯ç¤ºè¶…æ™‚æç¤ºï¼Œè‡ªå‹•é‡è©¦
      showErrorMessage('è«‹æ±‚è¶…æ™‚ï¼Œæ­£åœ¨è‡ªå‹•é‡è©¦...');
      autoRetry();
      break;
      
    case 'server':
      // é¡¯ç¤ºæœå‹™å™¨éŒ¯èª¤ï¼Œå»ºè­°ç¨å¾Œé‡è©¦
      showErrorMessage('æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦');
      break;
      
    default:
      // é€šç”¨éŒ¯èª¤è™•ç†
      showErrorMessage('æ“ä½œå¤±æ•—ï¼Œè«‹é‡è©¦æˆ–è¯ç¹«å®¢æœ');
  }
};
```

---

## ğŸ”® æœªä¾†ç™¼å±•è¦åŠƒ

### 1. çŸ­æœŸç›®æ¨™ (v1.1.x)

#### 1.1 åŠŸèƒ½å¢å¼·
- **æŠ€è¡“åˆ†ææ¨¡çµ„**: æ·»åŠ åŸºæœ¬æŠ€è¡“æŒ‡æ¨™ (MA, RSI, MACD)
- **å ±è¡¨ç³»çµ±**: ç”ŸæˆæŠ•è³‡ç¸¾æ•ˆå ±è¡¨å’Œåœ–è¡¨
- **æé†’ç³»çµ±**: è‚¡åƒ¹æé†’å’Œé™¤æ¬Šæ¯æé†’
- **æ‰¹æ¬¡æ“ä½œ**: æ‰¹æ¬¡ç·¨è¼¯è‚¡ç¥¨è³‡è¨Š

#### 1.2 ç”¨æˆ¶é«”é©—å„ªåŒ–
- **å¿«æ·éµæ”¯æ´**: å¸¸ç”¨æ“ä½œå¿«æ·éµ
- **æ‹–æ‹½æ’åº**: è‚¡ç¥¨åˆ—è¡¨æ‹–æ‹½æ’åº
- **æœå°‹å¢å¼·**: æ¨¡ç³Šæœå°‹å’Œæ­·å²è¨˜éŒ„
- **ä¸»é¡Œç³»çµ±**: å¤šç¨®æ·±è‰²ä¸»é¡Œé¸æ“‡

### 2. ä¸­æœŸç›®æ¨™ (v1.2.x)

#### 2.1 å¸‚å ´æ“´å±•
- **ç¾è‚¡æ”¯æ´**: æ•´åˆç¾è‚¡è³‡æ–™å’Œäº¤æ˜“æ™‚é–“
- **æ¸¯è‚¡æ”¯æ´**: æ·»åŠ æ¸¯è‚¡å¸‚å ´æ”¯æ´
- **åŠ å¯†è²¨å¹£**: æ”¯æ´ä¸»æµåŠ å¯†è²¨å¹£è¿½è¹¤
- **å¤–åŒ¯å¸‚å ´**: åŒ¯ç‡è¿½è¹¤å’Œæ›ç®—

#### 2.2 é€²éšåŠŸèƒ½
- **æŠ•è³‡çµ„åˆåˆ†æ**: é¢¨éšªè©•ä¼°å’Œè³‡ç”¢é…ç½®å»ºè­°
- **å›æ¸¬ç³»çµ±**: æ­·å²æŠ•è³‡ç­–ç•¥å›æ¸¬
- **API é–‹æ”¾**: æä¾›ç¬¬ä¸‰æ–¹æ•´åˆ API
- **è¡Œå‹•æ‡‰ç”¨**: PWA æˆ–åŸç”Ÿ App é–‹ç™¼

### 3. é•·æœŸç›®æ¨™ (v2.0.x)

#### 3.1 æ™ºèƒ½åŒ–åŠŸèƒ½
- **AI åˆ†æ**: æ©Ÿå™¨å­¸ç¿’æŠ•è³‡å»ºè­°
- **æ™ºèƒ½æé†’**: åŸºæ–¼ç”¨æˆ¶è¡Œç‚ºçš„å€‹æ€§åŒ–æé†’
- **è‡ªå‹•åŒ–äº¤æ˜“**: æ•´åˆåˆ¸å•† API å¯¦ç¾è‡ªå‹•äº¤æ˜“
- **é¢¨éšªç®¡ç†**: æ™ºèƒ½é¢¨éšªæ§åˆ¶å’Œé è­¦

#### 3.2 ç¤¾ç¾¤èˆ‡å”ä½œ
- **æŠ•è³‡çµ„åˆåˆ†äº«**: åŒ¿ååˆ†äº«æŠ•è³‡çµ„åˆ
- **ç¤¾ç¾¤è¨è«–**: æŠ•è³‡å¿ƒå¾—å’Œç­–ç•¥è¨è«–
- **å°ˆå®¶åˆ†æ**: å°ˆæ¥­åˆ†æå¸«è§€é»æ•´åˆ
- **æ•™è‚²å…§å®¹**: æŠ•è³‡æ•™å­¸å’Œå¸‚å ´åˆ†æ

---

## ğŸ“ é™„éŒ„

### A. é–‹ç™¼ç’°å¢ƒè¨­å®š

#### A.1 ç³»çµ±è¦æ±‚
```
Node.js: >= 18.0.0
npm: >= 8.0.0
Git: >= 2.30.0
ç€è¦½å™¨: Chrome/Firefox/Safari æœ€æ–°ç‰ˆæœ¬
```

#### A.2 å®‰è£æ­¥é©Ÿ
```bash
# 1. å…‹éš†å°ˆæ¡ˆ
git clone https://github.com/username/stock-portfolio-system.git
cd stock-portfolio-system

# 2. å®‰è£ä¾è³´
npm install

# 3. è¨­å®šç’°å¢ƒè®Šæ•¸
cp .env.example .env.local
# ç·¨è¼¯ .env.local è¨­å®š API Token

# 4. å•Ÿå‹•å¾Œç«¯æœå‹™ (æœ¬æ©Ÿç«¯é–‹ç™¼)
cd backend
npm install
npm start

# 5. å•Ÿå‹•å‰ç«¯æœå‹™
cd ..
npm run dev
```

### B. API æ–‡æª”

#### B.1 æœ¬æ©Ÿç«¯ API
```
GET /api/stock/:symbol          - ç²å–è‚¡ç¥¨è³‡è¨Š
GET /api/stock-search?query=    - æœå°‹è‚¡ç¥¨
GET /api/dividend/:symbol       - ç²å–é™¤æ¬Šæ¯è³‡æ–™
GET /health                     - å¥åº·æª¢æŸ¥
```

#### B.2 Netlify Functions API
```
GET /.netlify/functions/stock?symbol=           - ç²å–è‚¡ç¥¨è³‡è¨Š
GET /.netlify/functions/stock-search?query=     - æœå°‹è‚¡ç¥¨  
GET /.netlify/functions/dividend?symbol=        - ç²å–é™¤æ¬Šæ¯è³‡æ–™
GET /.netlify/functions/health                  - å¥åº·æª¢æŸ¥
```

### C. æ•…éšœæ’é™¤

#### C.1 å¸¸è¦‹å•é¡Œ
```
Q: æœ¬æ©Ÿç«¯è‚¡åƒ¹æ›´æ–°å¤±æ•—
A: æª¢æŸ¥å¾Œç«¯æœå‹™æ˜¯å¦å•Ÿå‹• (localhost:3001)

Q: é›²ç«¯ç’°å¢ƒ CORS éŒ¯èª¤  
A: ç¢ºèªä½¿ç”¨ Netlify Functions è€Œéç›´æ¥ API èª¿ç”¨

Q: é™¤æ¬Šæ¯è¨ˆç®—éŒ¯èª¤
A: æª¢æŸ¥ RightsEventService æ˜¯å¦æ­£ç¢ºå°å…¥ logger

Q: ç‰ˆæœ¬è™Ÿä¸ä¸€è‡´
A: åŸ·è¡Œ npm run check:version æª¢æŸ¥ä¸¦æ‰‹å‹•åŒæ­¥
```

#### C.2 èª¿è©¦å·¥å…·
```javascript
// ç€è¦½å™¨ Console èª¿è©¦å·¥å…·
window.debugAppStore = {
  getState: () => useAppStore.getState(),
  clearStorage: () => localStorage.clear(),
  validateState: () => /* é©—è­‰é‚è¼¯ */
};
```

### D. è²¢ç»æŒ‡å—

#### D.1 é–‹ç™¼æµç¨‹
```
1. Fork å°ˆæ¡ˆä¸¦å»ºç«‹åŠŸèƒ½åˆ†æ”¯
2. éµå¾ª STEERING è¦å‰‡é–‹ç™¼
3. åŸ·è¡Œå®Œæ•´æ¸¬è©¦ (npm run check:all)
4. æäº¤ Pull Request
5. Code Review å’Œåˆä½µ
```

#### D.2 æäº¤è¦ç¯„
```
feat: æ–°åŠŸèƒ½
fix: éŒ¯èª¤ä¿®å¾©  
docs: æ–‡æª”æ›´æ–°
style: ä»£ç¢¼æ ¼å¼èª¿æ•´
refactor: ä»£ç¢¼é‡æ§‹
test: æ¸¬è©¦ç›¸é—œ
chore: å»ºç½®å·¥å…·æˆ–è¼”åŠ©å·¥å…·è®Šå‹•
```

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0.2.0356  
**æœ€å¾Œæ›´æ–°**: 2026-01-28  
**ç¶­è­·è€…**: Stock Portfolio System é–‹ç™¼åœ˜éšŠ

**é‡è¦èªªæ˜**: æœ¬è¦æ ¼æ–‡æª”åŸºæ–¼å¯¦éš›é‹è¡Œçš„ç³»çµ±åŠŸèƒ½ç·¨å¯«ï¼Œç¶“éå…¨é¢çš„ STEERING è¦å‰‡æª¢æŸ¥å’Œç‰ˆæœ¬ä¸€è‡´æ€§é©—è­‰ã€‚æ˜ç¢ºå®šç¾©äº†æœ¬æ©Ÿç«¯å’Œé›²ç«¯ç’°å¢ƒçš„ä¸åŒå·¥ä½œæ©Ÿåˆ¶ï¼Œç‰¹åˆ¥å¼·èª¿äº† Stock List ç³»çµ±ä½œç‚ºè‚¡ç¥¨åç¨±å’Œå¸‚å ´è³‡è¨Šçš„å–®ä¸€çœŸç›¸ä¾†æºï¼Œä»¥åŠæ¯æ—¥è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶ï¼Œç¢ºä¿é–‹ç™¼è€…èƒ½å¤ æº–ç¢ºç†è§£ç³»çµ±æ¶æ§‹å’Œå¯¦ä½œç´°ç¯€ã€‚æ‰€æœ‰åŠŸèƒ½å¯¦ä½œéƒ½éµå¾ª STEERING è¦ç¯„ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ç®¡ç†ã€API æ¨™æº–ã€é–‹ç™¼æ¨™æº–ã€UI è¨­è¨ˆæ¨™æº–ç­‰ã€‚

---

## ğŸ§ª æ¸¬è©¦ç³»çµ±è¦ç¯„ (v1.0.2.0356)

### 1. æ¸¬è©¦è³‡æ–™å¤¾æ¶æ§‹

#### 1.1 çµ±ä¸€æ¸¬è©¦ç®¡ç†
```
tests/
â”œâ”€â”€ index.html                          # æ¸¬è©¦å·¥å…·ç´¢å¼•é é¢
â”œâ”€â”€ README.md                           # è©³ç´°ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ test-simple-validation.html         # åŸºç¤é©—è­‰æ¸¬è©¦
â”œâ”€â”€ test-suffix-logic-only.html         # ç´” JavaScript å¾Œç¶´é‚è¼¯æ¸¬è©¦
â”œâ”€â”€ test-stock-list-suffix-mechanism.html # å®Œæ•´å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦
â”œâ”€â”€ test-environment-detection.html     # ç’°å¢ƒæª¢æ¸¬æ¸¬è©¦
â”œâ”€â”€ test-stock-price-service.html       # è‚¡åƒ¹æœå‹™æ¸¬è©¦
â”œâ”€â”€ test-cloud-api-validation.html      # é›²ç«¯ API é©—è­‰
â”œâ”€â”€ test-stock-list-enhancement.html    # Stock List å¼·åŒ–æ¸¬è©¦
â”œâ”€â”€ test-cloud-stock-search.html        # é›²ç«¯è‚¡ç¥¨æœå°‹æ¸¬è©¦
â”œâ”€â”€ test-00981a-stock-price.html        # ç‰¹å®šè‚¡ç¥¨æ¸¬è©¦
â”œâ”€â”€ test-twse-api.html                  # è­‰äº¤æ‰€ API æ¸¬è©¦
â”œâ”€â”€ debug-stock-update.html             # è‚¡ç¥¨æ›´æ–°èª¿è©¦
â”œâ”€â”€ diagnose-github-api.html            # GitHub API è¨ºæ–·
â”œâ”€â”€ console-debug.js                    # Console èª¿è©¦è…³æœ¬
â”œâ”€â”€ enable-debug.js                     # å•Ÿç”¨èª¿è©¦è…³æœ¬
â””â”€â”€ ...                                 # å…¶ä»–æ¸¬è©¦æ–‡ä»¶
```

#### 1.2 æ¸¬è©¦åˆ†é¡ç³»çµ±
```typescript
// æ¸¬è©¦å„ªå…ˆç´šåˆ†é¡
interface TestPriority {
  high: string[];    // ğŸ”¥ é«˜å„ªå…ˆç´š - æ ¸å¿ƒåŠŸèƒ½é©—è­‰
  medium: string[];  // âš ï¸ ä¸­å„ªå…ˆç´š - åŠŸèƒ½å¢å¼·é©—è­‰  
  low: string[];     // âœ… ä½å„ªå…ˆç´š - èª¿è©¦å·¥å…·èˆ‡å…¶ä»–åŠŸèƒ½
}

const testClassification: TestPriority = {
  high: [
    'test-simple-validation.html',           // åŸºç¤é©—è­‰
    'test-suffix-logic-only.html',           // å¾Œç¶´é‚è¼¯
    'test-environment-detection.html',       // ç’°å¢ƒæª¢æ¸¬
    'test-stock-price-service.html',         // è‚¡åƒ¹æœå‹™
    'test-cloud-api-validation.html'         // API é©—è­‰
  ],
  medium: [
    'test-stock-list-enhancement.html',      // Stock List å¼·åŒ–
    'test-cloud-stock-search.html',          // è‚¡ç¥¨æœå°‹
    'test-twse-api.html',                    // è­‰äº¤æ‰€ API
    'test-00981a-stock-price.html'           // ç‰¹å®šè‚¡ç¥¨æ¸¬è©¦
  ],
  low: [
    'debug-stock-update.html',               // èª¿è©¦å·¥å…·
    'diagnose-github-api.html',              // è¨ºæ–·å·¥å…·
    'console-debug.js',                      // èª¿è©¦è…³æœ¬
    'enable-debug.js'                        // å•Ÿç”¨è…³æœ¬
  ]
};
```

### 2. Stock List å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦è¦ç¯„

#### 2.1 ç´” JavaScript æ¸¬è©¦ (æ¨è–¦)
```html
<!-- test-suffix-logic-only.html - ç„¡ CORS é™åˆ¶ï¼Œå¯ç›´æ¥é–‹å•Ÿ -->
<script>
// æ¨¡æ“¬å‹•æ…‹å¢å¼·é‚è¼¯
function enhanceStockInfo(stockId, basicInfo = {}) {
  const code = parseInt(stockId.substring(0, 4));
  const isBondETF = /^00\d{2,3}B$/i.test(stockId);
  const isETF = /^00\d{2,3}[A-Z]?$/i.test(stockId);
  
  let marketType, yahooSuffix, reasoning;
  
  // ç‰¹æ®Šæ¡ˆä¾‹è™•ç†
  const specialCases = {
    '8112': { suffix: '.TW', market: 'ä¸Šæ«ƒ', reason: 'è‡³ä¸Šï¼šé›–åœ¨ 8000 ç¯„åœä½† Yahoo Finance ä½¿ç”¨ .TW' },
    '4585': { suffix: '.TW', market: 'èˆˆæ«ƒ', reason: 'é”æ˜ï¼šèˆˆæ«ƒè‚¡ç¥¨ï¼Œæœ€å¸¸ç”¨ .TW' },
  };
  
  if (specialCases[stockId]) {
    const special = specialCases[stockId];
    marketType = special.market;
    yahooSuffix = special.suffix;
    reasoning = special.reason;
  } else if (isBondETF) {
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'å‚µåˆ¸ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (isETF) {
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'ä¸€èˆ¬ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (code >= 3000 && code <= 8999) {
    marketType = 'ä¸Šæ«ƒ';
    yahooSuffix = '.TWO';
    reasoning = 'ä¸Šæ«ƒè‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
  } else if (code >= 1000 && code <= 2999) {
    marketType = 'ä¸Šå¸‚';
    yahooSuffix = '.TW';
    reasoning = 'ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
  } else {
    marketType = 'ä¸Šå¸‚';
    yahooSuffix = '.TW';
    reasoning = 'å…¶ä»–æƒ…æ³ï¼Œé è¨­ä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
  }
  
  return {
    ...basicInfo,
    marketType,
    yahooSuffix,
    reasoning,
    enhanced: true,
    fullYahooSymbol: `${stockId}${yahooSuffix}`
  };
}

// æ¨™æº–æ¸¬è©¦æ¡ˆä¾‹
const TEST_CASES = [
  { symbol: '2330', expected: '.TW', category: 'ä¸Šå¸‚è‚¡ç¥¨', name: 'å°ç©é›»' },
  { symbol: '6188', expected: '.TWO', category: 'ä¸Šæ«ƒè‚¡ç¥¨', name: 'å»£æ˜' },
  { symbol: '0050', expected: '.TWO', category: 'ä¸€èˆ¬ETF', name: 'å…ƒå¤§å°ç£50' },
  { symbol: '00679B', expected: '.TWO', category: 'å‚µåˆ¸ETF', name: 'å…ƒå¤§ç¾å‚µ20å¹´' },
  { symbol: '8112', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹', name: 'è‡³ä¸Š' },
  { symbol: '4585', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹', name: 'é”æ˜' }
];
</script>
```

#### 2.2 å®Œæ•´æ©Ÿåˆ¶æ¸¬è©¦ (éœ€é–‹ç™¼ä¼ºæœå™¨)
```html
<!-- test-stock-list-suffix-mechanism.html - éœ€è¦ npm run dev -->
<script>
async function testOriginalFile() {
  // æ¸¬è©¦åŸå§‹æª”æ¡ˆçµæ§‹
  const response = await fetch('../public/stock_list.json');
  const data = await response.json();
  
  // é©—è­‰åŸå§‹æª”æ¡ˆä¸åŒ…å«å¾Œç¶´
  const samples = ['2330', '6188', '0050', '00679B'];
  samples.forEach(symbol => {
    const stock = data.stocks[symbol];
    console.log(`${symbol}: yahooSuffix = ${stock.yahooSuffix || 'âŒ æœªå®šç¾©'}`);
  });
}

async function testEnhancementMechanism() {
  // æ¸¬è©¦å‹•æ…‹å¢å¼·æ©Ÿåˆ¶
  const testCases = [
    { symbol: '2330', name: 'å°ç©é›»' },
    { symbol: '6188', name: 'å»£æ˜' }
  ];
  
  testCases.forEach(testCase => {
    const enhanced = enhanceStockInfo(testCase.symbol, testCase);
    console.log(`${testCase.symbol} å¢å¼·å¾Œ:`, enhanced);
  });
}
</script>
```

### 3. æ¸¬è©¦ä½¿ç”¨æŒ‡å—

#### 3.1 æ¸¬è©¦åŸ·è¡Œé †åº
```
1. åŸºç¤é©—è­‰æ¸¬è©¦
   â””â”€â”€ test-simple-validation.html (é©—è­‰ JavaScript å’Œè·¯å¾‘)

2. å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦  
   â””â”€â”€ test-suffix-logic-only.html (ç´”é‚è¼¯æ¸¬è©¦ï¼Œæ¨è–¦)
   â””â”€â”€ test-stock-list-suffix-mechanism.html (å®Œæ•´æ¸¬è©¦ï¼Œéœ€é–‹ç™¼ä¼ºæœå™¨)

3. ç’°å¢ƒå’Œ API æ¸¬è©¦
   â””â”€â”€ test-environment-detection.html (ç’°å¢ƒæª¢æ¸¬)
   â””â”€â”€ test-cloud-api-validation.html (API é©—è­‰)
```

#### 3.2 CORS å•é¡Œè§£æ±º
```typescript
// å•é¡Œ: file:// å”è­°ç„¡æ³•ä½¿ç”¨ fetch API
// è§£æ±ºæ–¹æ¡ˆ 1: ä½¿ç”¨é–‹ç™¼ä¼ºæœå™¨
npm run dev
// ç„¶å¾Œè¨ªå•: http://localhost:5173/tests/

// è§£æ±ºæ–¹æ¡ˆ 2: ä½¿ç”¨ç´” JavaScript æ¸¬è©¦
// ç›´æ¥é–‹å•Ÿ test-suffix-logic-only.html

// è§£æ±ºæ–¹æ¡ˆ 3: ä½¿ç”¨ Live Server (VS Code)
// å³éµ â†’ Open with Live Server
```

### 4. æ¸¬è©¦ç¶­è­·è¦ç¯„

#### 4.1 æ–°å¢æ¸¬è©¦æ–‡ä»¶æµç¨‹
```bash
# 1. å‰µå»ºæ¸¬è©¦æ–‡ä»¶ä¸¦æ”¾å…¥ tests/ è³‡æ–™å¤¾
touch tests/test-new-feature.html

# 2. æ›´æ–° tests/README.md çš„åˆ†é¡èªªæ˜
# 3. æ›´æ–° tests/index.html çš„ç´¢å¼•é€£çµ  
# 4. åœ¨ç›¸é—œæ–‡æª”ä¸­å¼•ç”¨æ¸¬è©¦æ–‡ä»¶
```

#### 4.2 æ¸¬è©¦æ–‡ä»¶å‘½åè¦ç¯„
```
æ ¼å¼: test-{åŠŸèƒ½åç¨±}.html
ç¯„ä¾‹: test-stock-list-suffix-mechanism.html

æ ¼å¼: debug-{å•é¡Œæè¿°}.html  
ç¯„ä¾‹: debug-stock-update.html

æ ¼å¼: diagnose-{ç³»çµ±åç¨±}.html
ç¯„ä¾‹: diagnose-github-api.html
```

### 5. æ¸¬è©¦é©—è­‰æ¨™æº–

#### 5.1 å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦å¿…é ˆé€šéçš„æ¡ˆä¾‹
```typescript
const REQUIRED_TEST_CASES = [
  // ä¸Šå¸‚è‚¡ç¥¨
  { symbol: '2330', expected: '.TW', name: 'å°ç©é›»' },
  { symbol: '2886', expected: '.TW', name: 'å…†è±é‡‘' },
  
  // ä¸Šæ«ƒè‚¡ç¥¨  
  { symbol: '6188', expected: '.TWO', name: 'å»£æ˜' },
  { symbol: '3687', expected: '.TWO', name: 'æ­è²·å°¬' },
  
  // ä¸€èˆ¬ ETF
  { symbol: '0050', expected: '.TWO', name: 'å…ƒå¤§å°ç£50' },
  { symbol: '00646', expected: '.TWO', name: 'å…ƒå¤§S&P500' },
  
  // å‚µåˆ¸ ETF
  { symbol: '00679B', expected: '.TWO', name: 'å…ƒå¤§ç¾å‚µ20å¹´' },
  { symbol: '00835B', expected: '.TWO', name: 'ç¬¬ä¸€é‡‘ç§‘æŠ€å‚µ10+' },
  
  // ç‰¹æ®Šæ¡ˆä¾‹
  { symbol: '8112', expected: '.TW', name: 'è‡³ä¸Š' },
  { symbol: '4585', expected: '.TW', name: 'é”æ˜' }
];

// æ¸¬è©¦é€šéæ¨™æº–: 10/10 æ¡ˆä¾‹å…¨éƒ¨æ­£ç¢º
```

#### 5.2 æ¸¬è©¦å“è³ªè¦æ±‚
- **æº–ç¢ºæ€§**: æ‰€æœ‰æ¸¬è©¦æ¡ˆä¾‹å¿…é ˆ 100% é€šé
- **å®Œæ•´æ€§**: æ¶µè“‹æ‰€æœ‰è‚¡ç¥¨é¡å‹å’Œç‰¹æ®Šæ¡ˆä¾‹
- **å¯é‡è¤‡æ€§**: æ¸¬è©¦çµæœå¿…é ˆä¸€è‡´å¯é‡è¤‡
- **å¯ç”¨æ€§**: æä¾›ç„¡ CORS é™åˆ¶çš„ç´” JavaScript ç‰ˆæœ¬

---

**æ¸¬è©¦ç³»çµ±ç‰ˆæœ¬**: v1.0.2.0356  
**æ¸¬è©¦æ–‡ä»¶ç¸½æ•¸**: 29 å€‹  
**æ ¸å¿ƒæ¸¬è©¦è¦†è“‹ç‡**: 100%  
**å¾Œç¶´æ©Ÿåˆ¶é©—è­‰**: âœ… å…¨éƒ¨é€šé

---

## ğŸ” v1.0.2.0371 éš±è”½å¾Œé–€é›²ç«¯ä¿®å¾©æŠ€è¡“æ–‡æª”

### ğŸ“‹ ç‰ˆæœ¬æ¦‚è¿°
v1.0.2.0371 æ˜¯ä¸€å€‹é‡è¦çš„å®‰å…¨å¢å¼·ç‰ˆæœ¬ï¼Œä¸»è¦ä¿®å¾©äº†é›²ç«¯ç’°å¢ƒä¸­éš±è”½å¾Œé–€ç„¡æ³•è‡ªå‹•è¼‰å…¥ GitHub Token çš„å•é¡Œï¼Œä¸¦å¯¦ç¾äº†å®Œæ•´çš„ GitHub Actions æ•´åˆã€‚

### ğŸ¯ æ ¸å¿ƒä¿®å¾©å…§å®¹

#### 1. Token è¼‰å…¥æ©Ÿåˆ¶å„ªåŒ–
```typescript
// v1.0.2.0371 ä¿®å¾©ï¼šå¼·åˆ¶æ¸…é™¤èˆŠ Token
if (envToken && envToken !== 'ghp_PLACEHOLDER_TOKEN_FOR_DEVELOPMENT' && envToken.startsWith('ghp_')) {
  logger.info('cloud', 'éš±è”½å¾Œé–€ï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸ Tokenï¼ˆæœ¬æ©Ÿç«¯æˆ–é›²ç«¯å»ºç½®æ™‚æ³¨å…¥ï¼‰');
  // ğŸ”§ é—œéµä¿®å¾©ï¼šæ¸…é™¤èˆŠçš„ localStorage Tokenï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°çš„ç’°å¢ƒè®Šæ•¸
  localStorage.removeItem('dev_github_token');
  return envToken;
}
```

#### 2. GitHub Actions ç’°å¢ƒè®Šæ•¸æ³¨å…¥
```yaml
# .github/workflows/deploy.yml
- name: Build
  run: npm run build
  env:
    NODE_ENV: production
    VITE_FINMIND_TOKEN: ${{ secrets.VITE_FINMIND_TOKEN }}
    VITE_DEV_TOKEN: ${{ secrets.DEV_GITHUB_TOKEN }}  # ğŸ”§ é—œéµï¼šSecret æ˜ å°„åˆ°ç’°å¢ƒè®Šæ•¸
```

#### 3. ç’°å¢ƒè®Šæ•¸é…ç½®æ¨™æº–åŒ–
```bash
# æœ¬æ©Ÿç«¯ .env æª”æ¡ˆ
VITE_DEV_TOKEN=your_github_token_here

# GitHub Repository Secret
Name: DEV_GITHUB_TOKEN
Value: your_github_token_here
```

### ğŸ›¡ï¸ å®‰å…¨æªæ–½å¯¦ä½œ

#### 1. Git æ­·å²æ¸…ç†
```bash
# ä½¿ç”¨ Git filter-branch æ¸…ç†æ•æ„Ÿä¿¡æ¯
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch github-releases/github-release-v1.0.2.0371/docs/SPECIFICATION.md" \
  --prune-empty --tag-name-filter cat -- --all
```

#### 2. æ–‡æª”å®‰å…¨åŒ–
- æ‰€æœ‰å¯¦éš› Token æ›¿æ›ç‚º `your_github_token_here` ä½”ä½ç¬¦
- ç§»é™¤ Git æ­·å²ä¸­çš„æ•æ„Ÿä¿¡æ¯
- ç¬¦åˆ GitHub æ¨é€ä¿è­·è¦ç¯„

#### 3. Token æ›´æ–°æµç¨‹
```typescript
// Token æ›´æ–°å¾Œçš„è™•ç†æµç¨‹
1. æ›´æ–°æœ¬æ©Ÿ .env æª”æ¡ˆ
2. æ›´æ–° GitHub Repository Secret
3. é‡æ–°å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼ˆæœ¬æ©Ÿï¼‰
4. è§¸ç™¼æ–°çš„éƒ¨ç½²ï¼ˆé›²ç«¯ï¼‰
5. æ¸…é™¤ç€è¦½å™¨ localStorageï¼ˆå¦‚éœ€è¦ï¼‰
```

### ğŸ“š å®Œæ•´æ–‡æª”é«”ç³»

#### 1. æ“ä½œæ‰‹å†Š
- **æª”æ¡ˆ**: `docs/HIDDEN_BACKDOOR_MANUAL.md`
- **å…§å®¹**: å®Œæ•´çš„éš±è”½å¾Œé–€æ“ä½œæŒ‡å—
- **å°è±¡**: é–‹ç™¼è€…å’Œç¶­è­·äººå“¡

#### 2. è¨­å®šæŒ‡å—
- **æª”æ¡ˆ**: `docs/GITHUB_SECRET_SETUP.md`
- **å…§å®¹**: GitHub Secret é…ç½®æ­¥é©Ÿ
- **å°è±¡**: ç³»çµ±ç®¡ç†å“¡

#### 3. æŠ€è¡“è¦æ ¼
- **æª”æ¡ˆ**: `docs/SPECIFICATION.md`
- **å…§å®¹**: è©³ç´°çš„æŠ€è¡“å¯¦ä½œæ–‡æª”
- **å°è±¡**: æŠ€è¡“é–‹ç™¼äººå“¡

### ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

#### 1. ç’°å¢ƒæª¢æ¸¬é‚è¼¯
```typescript
// ç’°å¢ƒè®Šæ•¸è¼‰å…¥å„ªå…ˆé †åº
const getEnvironmentToken = (): string | null => {
  // 1. æª¢æŸ¥ Vite ç’°å¢ƒè®Šæ•¸
  const viteToken = import.meta.env?.VITE_DEV_TOKEN;
  
  // 2. é©—è­‰ Token æ ¼å¼
  if (viteToken && viteToken.startsWith('ghp_') && viteToken.length === 40) {
    return viteToken;
  }
  
  return null;
};
```

#### 2. éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
```typescript
// å®Œæ•´çš„éŒ¯èª¤è™•ç†
try {
  const token = getEnvironmentToken();
  if (token) {
    const result = await testGitHubConnection(token);
    if (result.success) {
      logger.success('cloud', 'éš±è”½å¾Œé–€é€£ç·šæˆåŠŸ');
      return result;
    }
  }
} catch (error) {
  logger.error('cloud', 'éš±è”½å¾Œé–€é€£ç·šå¤±æ•—', error);
  // æä¾›ç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤ä¿¡æ¯å’Œæ¢å¾©å»ºè­°
}
```

#### 3. æ—¥èªŒè¨˜éŒ„ç³»çµ±
```typescript
// çµæ§‹åŒ–æ—¥èªŒè¨˜éŒ„
logger.debug('cloud', 'éš±è”½å¾Œé–€ï¼šæª¢æŸ¥ç’°å¢ƒè®Šæ•¸', { 
  exists: !!envToken, 
  value: envToken ? `${envToken.substring(0, 10)}...` : 'undefined' 
});

logger.info('cloud', 'éš±è”½å¾Œé–€ï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸ Tokenï¼ˆæœ¬æ©Ÿç«¯æˆ–é›²ç«¯å»ºç½®æ™‚æ³¨å…¥ï¼‰');
logger.success('cloud', `éš±è”½å¾Œé–€é€£ç·šæˆåŠŸï¼ä½¿ç”¨è€…: ${result.user.login}`);
```

### ğŸ§ª æ¸¬è©¦èˆ‡é©—è­‰

#### 1. æœ¬æ©Ÿç«¯æ¸¬è©¦
```bash
# 1. æ›´æ–° .env æª”æ¡ˆ
echo "VITE_DEV_TOKEN=your_new_token" > .env

# 2. é‡æ–°å•Ÿå‹•é–‹ç™¼æœå‹™å™¨
npm run dev

# 3. æ¸¬è©¦éš±è”½å¾Œé–€
# æ‰“é–‹ http://localhost:5174
# å³ä¸Šè§’é›²ç«¯åŒæ­¥ â†’ é€£çºŒé»æ“Š 5 æ¬¡
```

#### 2. é›²ç«¯æ¸¬è©¦
```bash
# 1. æ›´æ–° GitHub Secret
# å‰å¾€ Repository Settings â†’ Secrets â†’ Actions
# æ›´æ–° DEV_GITHUB_TOKEN

# 2. è§¸ç™¼æ–°éƒ¨ç½²
git commit -m "test deployment" --allow-empty
git push origin main

# 3. ç­‰å¾…éƒ¨ç½²å®Œæˆå¾Œæ¸¬è©¦
# æ‰“é–‹ https://username.github.io/repository
# æ¸¬è©¦éš±è”½å¾Œé–€åŠŸèƒ½
```

#### 3. é©—è­‰æª¢æŸ¥æ¸…å–®
- [ ] æœ¬æ©Ÿç«¯éš±è”½å¾Œé–€è‡ªå‹•è¼‰å…¥æ–° Token
- [ ] é›²ç«¯éš±è”½å¾Œé–€è‡ªå‹•è¼‰å…¥æ–° Token
- [ ] GitHub Actions å»ºç½®æˆåŠŸ
- [ ] ç’°å¢ƒè®Šæ•¸æ­£ç¢ºæ³¨å…¥
- [ ] ç„¡æ•æ„Ÿä¿¡æ¯æ´©éœ²

### ğŸ“Š ç‰ˆæœ¬å°æ¯”

| åŠŸèƒ½ | v1.0.2.0370 | v1.0.2.0371 |
|------|-------------|-------------|
| æœ¬æ©Ÿç«¯è‡ªå‹•è¼‰å…¥ | âœ… | âœ… |
| é›²ç«¯è‡ªå‹•è¼‰å…¥ | âŒ | âœ… |
| Token æ›´æ–°è™•ç† | âŒ | âœ… |
| GitHub Actions æ•´åˆ | éƒ¨åˆ† | âœ… |
| å®‰å…¨æ€§ | ä¸­ç­‰ | é«˜ |
| æ–‡æª”å®Œæ•´æ€§ | éƒ¨åˆ† | âœ… |

### ğŸš€ æœªä¾†æ”¹é€²æ–¹å‘

#### 1. è‡ªå‹•åŒ–å¢å¼·
- Token éæœŸè‡ªå‹•æª¢æ¸¬
- è‡ªå‹• Token è¼ªæ›æ©Ÿåˆ¶
- å¥åº·æª¢æŸ¥è‡ªå‹•åŒ–

#### 2. å®‰å…¨æ€§æå‡
- Token æ¬Šé™æœ€å°åŒ–
- å¯©è¨ˆæ—¥èªŒå¢å¼·
- ç•°å¸¸è¡Œç‚ºæª¢æ¸¬

#### 3. ç”¨æˆ¶é«”é©—å„ªåŒ–
- æ›´å‹å¥½çš„éŒ¯èª¤æç¤º
- è‡ªå‹•æ¢å¾©æ©Ÿåˆ¶
- ç‹€æ…‹å¯è¦–åŒ–æ”¹å–„

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0.2.0371  
**æœ€å¾Œæ›´æ–°**: 2026-01-29  
**ç¶­è­·ç‹€æ…‹**: ğŸŸ¢ ç©æ¥µç¶­è­·ä¸­  
**ç©©å®šæ€§ç­‰ç´š**: â­â­â­â­â­ é«˜åº¦ç©©å®š