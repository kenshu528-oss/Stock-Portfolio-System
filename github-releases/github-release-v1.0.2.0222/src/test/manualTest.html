<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨æœå°‹æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e293b; color: white; }
        .test-item { margin: 10px 0; padding: 10px; background: #334155; border-radius: 5px; }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .loading { border-left: 4px solid #3b82f6; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        input { background: #475569; color: white; border: 1px solid #64748b; padding: 8px; border-radius: 4px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª è‚¡ç¥¨æœå°‹åŠŸèƒ½æ¸¬è©¦</h1>
    
    <div>
        <h2>æ‰‹å‹•æ¸¬è©¦</h2>
        <input type="text" id="manualInput" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼ (å¦‚: 2330, 0050, 00679B)" />
        <button onclick="testManualSearch()">æœå°‹</button>
        <div id="manualResult"></div>
    </div>
    
    <div>
        <h2>è‡ªå‹•æ¸¬è©¦</h2>
        <button onclick="runAutoTests()">åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
        <div id="autoResults"></div>
    </div>

    <script type="module">
        // æ¨¡æ“¬è‚¡åƒ¹æœå‹™
        class MockStockPriceService {
            async searchStock(symbol) {
                // æ¨¡æ“¬APIå»¶é²
                await new Promise(resolve => setTimeout(resolve, 200 + Math.random() * 300));
                
                // é©—è­‰æ ¼å¼
                if (!this.isValidStockSymbol(symbol)) {
                    return null;
                }
                
                // æ¨¡æ“¬è‚¡åƒ¹è³‡æ–™
                const mockData = {
                    '2330': { symbol: '2330', name: 'å°ç©é›»', market: 'ä¸Šå¸‚', price: 580, change: 5, changePercent: 0.87 },
                    '2317': { symbol: '2317', name: 'é´»æµ·', market: 'ä¸Šå¸‚', price: 105, change: -1, changePercent: -0.94 },
                    '2303': { symbol: '2303', name: 'è¯é›»', market: 'ä¸Šå¸‚', price: 45.5, change: 1.2, changePercent: 2.71 },
                    '1301': { symbol: '1301', name: 'å°å¡‘', market: 'ä¸Šå¸‚', price: 95, change: -2, changePercent: -2.06 },
                    '2881': { symbol: '2881', name: 'å¯Œé‚¦é‡‘', market: 'ä¸Šå¸‚', price: 65, change: 0.5, changePercent: 0.78 },
                    
                    '0050': { symbol: '0050', name: 'å…ƒå¤§å°ç£50', market: 'ETF', price: 145, change: 1.2, changePercent: 0.83 },
                    '0056': { symbol: '0056', name: 'å…ƒå¤§é«˜è‚¡æ¯', market: 'ETF', price: 35, change: -0.3, changePercent: -0.85 },
                    '00646': { symbol: '00646', name: 'å…ƒå¤§S&P500', market: 'ETF', price: 18.5, change: 0.1, changePercent: 0.54 },
                    '00662': { symbol: '00662', name: 'å¯Œé‚¦NASDAQ', market: 'ETF', price: 25.8, change: 0.3, changePercent: 1.18 },
                    '00679B': { symbol: '00679B', name: 'å…ƒå¤§ç¾å‚µ20å¹´', market: 'ETF', price: 40.2, change: -0.2, changePercent: -0.50 },
                    
                    '3006': { symbol: '3006', name: 'æ™¶è±ªç§‘', market: 'ä¸Šæ«ƒ', price: 85, change: 2, changePercent: 2.41 },
                    '4102': { symbol: '4102', name: 'æ°¸æ—¥', market: 'ä¸Šæ«ƒ', price: 45, change: -1, changePercent: -2.17 },
                    '6411': { symbol: '6411', name: 'æ™¶ç„±', market: 'ä¸Šæ«ƒ', price: 180, change: 5, changePercent: 2.86 },
                    
                    '4966': { symbol: '4966', name: 'è­œç‘', market: 'èˆˆæ«ƒ', price: 120, change: 3, changePercent: 2.56 },
                    '6508': { symbol: '6508', name: 'æƒ å…‰', market: 'èˆˆæ«ƒ', price: 95, change: -2, changePercent: -2.06 }
                };
                
                // å¦‚æœæœ‰é è¨­è³‡æ–™å°±è¿”å›ï¼Œå¦å‰‡ç”Ÿæˆéš¨æ©Ÿè³‡æ–™
                if (mockData[symbol]) {
                    return mockData[symbol];
                }
                
                // ç”Ÿæˆéš¨æ©Ÿè‚¡åƒ¹
                const price = this.generateRandomPrice(symbol);
                const change = (Math.random() - 0.5) * price * 0.1;
                
                return {
                    symbol,
                    name: this.getStockName(symbol),
                    market: this.getStockMarket(symbol),
                    price: Math.round(price * 100) / 100,
                    change: Math.round(change * 100) / 100,
                    changePercent: Math.round((change / price) * 100 * 100) / 100
                };
            }
            
            isValidStockSymbol(symbol) {
                return /^(\d{4}[A-Z]?|00\d{3}[A-Z]?)$/.test(symbol.toUpperCase());
            }
            
            getStockMarket(symbol) {
                if (/^00\d{2,3}[A-Z]?$/.test(symbol)) return 'ETF';
                const code = parseInt(symbol.substring(0, 4));
                if ((code >= 1000 && code <= 2999) || (code >= 3000 && code <= 3099)) return 'ä¸Šå¸‚';
                if (code >= 3000 && code <= 8999) return 'ä¸Šæ«ƒ';
                return 'æœªçŸ¥';
            }
            
            getStockName(symbol) {
                const names = {
                    '2330': 'å°ç©é›»', '2317': 'é´»æµ·', '2303': 'è¯é›»', '1301': 'å°å¡‘', '2881': 'å¯Œé‚¦é‡‘',
                    '0050': 'å…ƒå¤§å°ç£50', '0056': 'å…ƒå¤§é«˜è‚¡æ¯', '00646': 'å…ƒå¤§S&P500', '00662': 'å¯Œé‚¦NASDAQ', '00679B': 'å…ƒå¤§ç¾å‚µ20å¹´',
                    '3006': 'æ™¶è±ªç§‘', '4102': 'æ°¸æ—¥', '6411': 'æ™¶ç„±', '4966': 'è­œç‘', '6508': 'æƒ å…‰'
                };
                return names[symbol] || `è‚¡ç¥¨${symbol}`;
            }
            
            generateRandomPrice(symbol) {
                if (symbol.startsWith('00')) return 15 + Math.random() * 50;
                const code = parseInt(symbol.substring(0, 4));
                if (code >= 2880 && code <= 2899) return 15 + Math.random() * 50;
                if (code >= 2300 && code <= 2499) return 50 + Math.random() * 500;
                if (code >= 1000 && code <= 1999) return 30 + Math.random() * 150;
                return 20 + Math.random() * 200;
            }
        }
        
        const stockService = new MockStockPriceService();
        
        // æ‰‹å‹•æ¸¬è©¦
        window.testManualSearch = async function() {
            const input = document.getElementById('manualInput');
            const result = document.getElementById('manualResult');
            const symbol = input.value.trim().toUpperCase();
            
            if (!symbol) {
                result.innerHTML = '<div class="test-item error">è«‹è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼</div>';
                return;
            }
            
            result.innerHTML = '<div class="test-item loading">ğŸ” æœå°‹ä¸­...</div>';
            
            try {
                const stockData = await stockService.searchStock(symbol);
                
                if (stockData) {
                    const changeColor = stockData.change >= 0 ? '#10b981' : '#ef4444';
                    const changeSign = stockData.change >= 0 ? '+' : '';
                    
                    result.innerHTML = `
                        <div class="test-item success">
                            <h3>âœ… ${stockData.symbol} - ${stockData.name}</h3>
                            <p><strong>å¸‚å ´:</strong> ${stockData.market}</p>
                            <p><strong>è‚¡åƒ¹:</strong> $${stockData.price.toFixed(2)}</p>
                            <p><strong>æ¼²è·Œ:</strong> <span style="color: ${changeColor}">${changeSign}${stockData.change.toFixed(2)} (${changeSign}${stockData.changePercent.toFixed(2)}%)</span></p>
                        </div>
                    `;
                } else {
                    result.innerHTML = `<div class="test-item error">âŒ æ‰¾ä¸åˆ°è‚¡ç¥¨ä»£ç¢¼ ${symbol}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="test-item error">ğŸ’¥ æœå°‹éŒ¯èª¤: ${error.message}</div>`;
            }
        };
        
        // è‡ªå‹•æ¸¬è©¦
        window.runAutoTests = async function() {
            const results = document.getElementById('autoResults');
            results.innerHTML = '<div class="test-item loading">ğŸš€ åŸ·è¡Œè‡ªå‹•æ¸¬è©¦ä¸­...</div>';
            
            const testCases = [
                { symbol: '2330', type: 'ä¸Šå¸‚', expected: 'å°ç©é›»' },
                { symbol: '2317', type: 'ä¸Šå¸‚', expected: 'é´»æµ·' },
                { symbol: '2303', type: 'ä¸Šå¸‚', expected: 'è¯é›»' },
                { symbol: '1301', type: 'ä¸Šå¸‚', expected: 'å°å¡‘' },
                { symbol: '2881', type: 'ä¸Šå¸‚', expected: 'å¯Œé‚¦é‡‘' },
                
                { symbol: '0050', type: 'ETF', expected: 'å…ƒå¤§å°ç£50' },
                { symbol: '0056', type: 'ETF', expected: 'å…ƒå¤§é«˜è‚¡æ¯' },
                { symbol: '00646', type: 'ETF', expected: 'å…ƒå¤§S&P500' },
                { symbol: '00662', type: 'ETF', expected: 'å¯Œé‚¦NASDAQ' },
                { symbol: '00679B', type: 'ETF', expected: 'å…ƒå¤§ç¾å‚µ20å¹´' },
                
                { symbol: '3006', type: 'ä¸Šæ«ƒ', expected: 'æ™¶è±ªç§‘' },
                { symbol: '4102', type: 'ä¸Šæ«ƒ', expected: 'æ°¸æ—¥' },
                { symbol: '6411', type: 'ä¸Šæ«ƒ', expected: 'æ™¶ç„±' },
                
                { symbol: '4966', type: 'èˆˆæ«ƒ', expected: 'è­œç‘' },
                { symbol: '6508', type: 'èˆˆæ«ƒ', expected: 'æƒ å…‰' },
                
                // éš¨æ©Ÿæ¸¬è©¦
                { symbol: '1234', type: 'æ¸¬è©¦', expected: 'è‚¡ç¥¨1234' },
                { symbol: '5678', type: 'æ¸¬è©¦', expected: 'è‚¡ç¥¨5678' }
            ];
            
            let html = '<h3>ğŸ“Š æ¸¬è©¦çµæœ</h3>';
            let successCount = 0;
            
            for (const testCase of testCases) {
                try {
                    const result = await stockService.searchStock(testCase.symbol);
                    
                    if (result) {
                        const changeColor = result.change >= 0 ? '#10b981' : '#ef4444';
                        const changeSign = result.change >= 0 ? '+' : '';
                        
                        html += `
                            <div class="test-item success">
                                <strong>âœ… ${testCase.symbol} (${testCase.type})</strong><br>
                                ${result.symbol} - ${result.name} (${result.market})<br>
                                è‚¡åƒ¹: $${result.price.toFixed(2)} 
                                <span style="color: ${changeColor}">${changeSign}${result.change.toFixed(2)} (${changeSign}${result.changePercent.toFixed(2)}%)</span>
                            </div>
                        `;
                        successCount++;
                    } else {
                        html += `
                            <div class="test-item error">
                                <strong>âŒ ${testCase.symbol} (${testCase.type})</strong><br>
                                æ‰¾ä¸åˆ°è‚¡ç¥¨è³‡æ–™
                            </div>
                        `;
                    }
                } catch (error) {
                    html += `
                        <div class="test-item error">
                            <strong>ğŸ’¥ ${testCase.symbol} (${testCase.type})</strong><br>
                            éŒ¯èª¤: ${error.message}
                        </div>
                    `;
                }
                
                // é¿å…éå¿«è«‹æ±‚
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            html += `
                <div class="test-item" style="border-left: 4px solid #3b82f6;">
                    <h3>ğŸ“ˆ çµ±è¨ˆçµæœ</h3>
                    <p>æˆåŠŸ: ${successCount}/${testCases.length} (${((successCount/testCases.length)*100).toFixed(1)}%)</p>
                </div>
            `;
            
            results.innerHTML = html;
        };
    </script>
</body>
</html>