<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel API è¨ºæ–·æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” Vercel Edge Functions API è¨ºæ–·æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š API ç«¯é»æ¸¬è©¦</h2>
        <p>æ¸¬è©¦ Vercel API æ˜¯å¦æ­£å¸¸å›æ‡‰</p>
        <button onclick="testVercelAPI()">æ¸¬è©¦ Vercel API</button>
        <button onclick="testDirectYahoo()">æ¸¬è©¦ç›´æ¥ Yahoo API</button>
        <button onclick="clearResults()">æ¸…é™¤çµæœ</button>
        <div id="results"></div>
    </div>

    <script>
        const VERCEL_BASE_URL = 'https://vercel-stock-api.vercel.app/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testVercelAPI() {
            log('ğŸš€ é–‹å§‹æ¸¬è©¦ Vercel Edge Functions API...', 'info');
            
            const testSymbols = ['2330.TW', '2886.TW', '0050.TWO'];
            
            for (const symbol of testSymbols) {
                try {
                    log(`ğŸ“Š æ¸¬è©¦è‚¡ç¥¨: ${symbol}`, 'info');
                    
                    const url = `${VERCEL_BASE_URL}/stock?symbol=${encodeURIComponent(symbol)}`;
                    log(`ğŸ”— è«‹æ±‚ URL: ${url}`, 'info');
                    
                    const startTime = Date.now();
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'User-Agent': 'Stock-Portfolio-System/1.0.2.0375'
                        }
                    });
                    const endTime = Date.now();
                    
                    log(`â±ï¸ å›æ‡‰æ™‚é–“: ${endTime - startTime}ms`, 'info');
                    log(`ğŸ“¡ HTTP ç‹€æ…‹: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        log(`âŒ éŒ¯èª¤å›æ‡‰: ${errorText}`, 'error');
                        continue;
                    }
                    
                    const data = await response.json();
                    log(`âœ… æˆåŠŸç²å–è³‡æ–™:`, 'success');
                    log(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                    
                    // é©—è­‰è³‡æ–™æ ¼å¼
                    if (typeof data.price === 'number' && data.price > 0) {
                        log(`âœ… è³‡æ–™æ ¼å¼æ­£ç¢º: åƒ¹æ ¼ ${data.price}`, 'success');
                    } else {
                        log(`âŒ è³‡æ–™æ ¼å¼éŒ¯èª¤: price=${data.price}`, 'error');
                    }
                    
                } catch (error) {
                    log(`âŒ è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
                    log(`ğŸ” éŒ¯èª¤è©³æƒ…: ${error.stack}`, 'error');
                }
                
                log('---', 'info');
            }
            
            log('ğŸ Vercel API æ¸¬è©¦å®Œæˆ', 'info');
        }

        async function testDirectYahoo() {
            log('ğŸš€ é–‹å§‹æ¸¬è©¦ç›´æ¥ Yahoo Finance API...', 'info');
            
            const testSymbols = ['2330.TW', '2886.TW', '0050.TWO'];
            
            for (const symbol of testSymbols) {
                try {
                    log(`ğŸ“Š æ¸¬è©¦è‚¡ç¥¨: ${symbol}`, 'info');
                    
                    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}`;
                    log(`ğŸ”— è«‹æ±‚ URL: ${url}`, 'info');
                    
                    const startTime = Date.now();
                    const response = await fetch(url);
                    const endTime = Date.now();
                    
                    log(`â±ï¸ å›æ‡‰æ™‚é–“: ${endTime - startTime}ms`, 'info');
                    log(`ğŸ“¡ HTTP ç‹€æ…‹: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    
                    if (!response.ok) {
                        log(`âŒ ç›´æ¥ Yahoo API å¤±æ•— (é æœŸçš„ CORS éŒ¯èª¤)`, 'error');
                        continue;
                    }
                    
                    const data = await response.json();
                    const result = data?.chart?.result?.[0];
                    if (result?.meta) {
                        const price = result.meta.regularMarketPrice || result.meta.previousClose;
                        log(`âœ… ç›´æ¥ Yahoo API æˆåŠŸ: åƒ¹æ ¼ ${price}`, 'success');
                    }
                    
                } catch (error) {
                    if (error.message.includes('CORS')) {
                        log(`âŒ CORS éŒ¯èª¤ (é æœŸ): ${error.message}`, 'error');
                    } else {
                        log(`âŒ å…¶ä»–éŒ¯èª¤: ${error.message}`, 'error');
                    }
                }
                
                log('---', 'info');
            }
            
            log('ğŸ ç›´æ¥ Yahoo API æ¸¬è©¦å®Œæˆ', 'info');
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦
        window.addEventListener('load', () => {
            log('ğŸ“‹ Vercel API è¨ºæ–·æ¸¬è©¦å·²è¼‰å…¥', 'info');
            log('ğŸ¯ ç›®æ¨™ï¼šè¨ºæ–· v1.0.2.0373 é›²ç«¯è‚¡åƒ¹æ›´æ–°å¤±æ•ˆå•é¡Œ', 'info');
            log('ğŸ” æª¢æŸ¥ Vercel Edge Functions API æ˜¯å¦çœŸçš„å¤±æ•ˆ', 'info');
        });
    </script>
</body>
</html>