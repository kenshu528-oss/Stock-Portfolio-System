<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾Œç¶´é‚è¼¯æ¸¬è©¦ï¼ˆç´” JavaScriptï¼‰</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .result { margin: 10px 0; padding: 15px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        .test-case { margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 4px solid #007cba; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Stock List å¾Œç¶´é‚è¼¯æ¸¬è©¦</h1>
        <p><strong>èªªæ˜</strong>: é€™å€‹æ¸¬è©¦ä¸éœ€è¦è¼‰å…¥å¤–éƒ¨æª”æ¡ˆï¼Œç´”ç²¹æ¸¬è©¦å¾Œç¶´åˆ¤æ–·é‚è¼¯</p>
        
        <h3>ğŸ§ª æ¸¬è©¦å¾Œç¶´åˆ¤æ–·é‚è¼¯</h3>
        <button onclick="runAllTests()">åŸ·è¡Œå®Œæ•´æ¸¬è©¦</button>
        <div id="test-result"></div>
        
        <h3>ğŸ“Š å‹•æ…‹å¢å¼·æ©Ÿåˆ¶æ¼”ç¤º</h3>
        <button onclick="demonstrateEnhancement()">æ¼”ç¤ºå¢å¼·æ©Ÿåˆ¶</button>
        <div id="enhancement-result"></div>
        
        <h3>ğŸ” è‡ªè¨‚æ¸¬è©¦</h3>
        <input type="text" id="custom-symbol" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ (å¦‚: 2330)" style="padding: 8px; margin: 5px;">
        <button onclick="testCustomSymbol()">æ¸¬è©¦</button>
        <div id="custom-result"></div>
    </div>

    <script>
        // æ¨¡æ“¬ Stock List å¢å¼·é‚è¼¯
        function enhanceStockInfo(stockId, basicInfo = {}) {
            const code = parseInt(stockId.substring(0, 4));
            const isBondETF = /^00\d{2,3}B$/i.test(stockId);
            const isETF = /^00\d{2,3}[A-Z]?$/i.test(stockId);
            
            let marketType, yahooSuffix, reasoning;
            
            // ç‰¹æ®Šæ¡ˆä¾‹è™•ç†ï¼ˆåŸºæ–¼å¯¦éš›æ¸¬è©¦çµæœï¼‰
            const specialCases = {
                '8112': { suffix: '.TW', market: 'ä¸Šæ«ƒ', reason: 'è‡³ä¸Šï¼šé›–åœ¨ 8000 ç¯„åœä½† Yahoo Finance ä½¿ç”¨ .TW' },
                '4585': { suffix: '.TW', market: 'èˆˆæ«ƒ', reason: 'é”æ˜ï¼šèˆˆæ«ƒè‚¡ç¥¨ï¼Œæœ€å¸¸ç”¨ .TW' },
            };
            
            if (specialCases[stockId]) {
                const special = specialCases[stockId];
                marketType = special.market;
                yahooSuffix = special.suffix;
                reasoning = special.reason;
            } else if (isBondETF) {
                // å‚µåˆ¸ ETFï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'å‚µåˆ¸ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (isETF) {
                // ä¸€èˆ¬ ETFï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸€èˆ¬ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 3000 && code <= 8999) {
                // ä¸Šæ«ƒè‚¡ç¥¨ï¼ˆ3000-8999ï¼‰ï¼šå„ªå…ˆæ«ƒè²·ä¸­å¿ƒ
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸Šæ«ƒè‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 1000 && code <= 2999) {
                // ä¸Šå¸‚è‚¡ç¥¨ï¼ˆ1000-2999ï¼‰ï¼šå„ªå…ˆè­‰äº¤æ‰€
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            } else {
                // å…¶ä»–æƒ…æ³ï¼šé è¨­è­‰äº¤æ‰€
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'å…¶ä»–æƒ…æ³ï¼Œé è¨­ä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            }
            
            return {
                ...basicInfo,
                marketType,
                yahooSuffix,
                reasoning,
                enhanced: true,
                fullYahooSymbol: `${stockId}${yahooSuffix}`
            };
        }

        // åŸ·è¡Œå®Œæ•´æ¸¬è©¦
        function runAllTests() {
            const resultDiv = document.getElementById('test-result');
            
            const testCases = [
                // ä¸Šå¸‚è‚¡ç¥¨
                { symbol: '2330', expected: '.TW', category: 'ä¸Šå¸‚è‚¡ç¥¨', name: 'å°ç©é›»' },
                { symbol: '2886', expected: '.TW', category: 'ä¸Šå¸‚è‚¡ç¥¨', name: 'å…†è±é‡‘' },
                
                // ä¸Šæ«ƒè‚¡ç¥¨
                { symbol: '6188', expected: '.TWO', category: 'ä¸Šæ«ƒè‚¡ç¥¨', name: 'å»£æ˜' },
                { symbol: '3687', expected: '.TWO', category: 'ä¸Šæ«ƒè‚¡ç¥¨', name: 'æ­è²·å°¬' },
                
                // ä¸€èˆ¬ ETF
                { symbol: '0050', expected: '.TWO', category: 'ä¸€èˆ¬ETF', name: 'å…ƒå¤§å°ç£50' },
                { symbol: '00646', expected: '.TWO', category: 'ä¸€èˆ¬ETF', name: 'å…ƒå¤§S&P500' },
                
                // å‚µåˆ¸ ETF
                { symbol: '00679B', expected: '.TWO', category: 'å‚µåˆ¸ETF', name: 'å…ƒå¤§ç¾å‚µ20å¹´' },
                { symbol: '00835B', expected: '.TWO', category: 'å‚µåˆ¸ETF', name: 'ç¬¬ä¸€é‡‘ç§‘æŠ€å‚µ10+' },
                
                // ç‰¹æ®Šæ¡ˆä¾‹
                { symbol: '8112', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹', name: 'è‡³ä¸Š' },
                { symbol: '4585', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹', name: 'é”æ˜' }
            ];
            
            let result = 'ğŸ¯ å¾Œç¶´åˆ¤æ–·é‚è¼¯æ¸¬è©¦çµæœ:\n\n';
            let passCount = 0;
            
            for (const testCase of testCases) {
                const enhanced = enhanceStockInfo(testCase.symbol, { name: testCase.name });
                const passed = enhanced.yahooSuffix === testCase.expected;
                
                result += `${testCase.symbol} (${testCase.name}) - ${testCase.category}:\n`;
                result += `  é æœŸå¾Œç¶´: ${testCase.expected}\n`;
                result += `  å¯¦éš›å¾Œç¶´: ${enhanced.yahooSuffix}\n`;
                result += `  å®Œæ•´ç¬¦è™Ÿ: ${enhanced.fullYahooSymbol}\n`;
                result += `  å¸‚å ´åˆ†é¡: ${enhanced.marketType}\n`;
                result += `  åˆ¤æ–·é‚è¼¯: ${enhanced.reasoning}\n`;
                result += `  æ¸¬è©¦çµæœ: ${passed ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}\n\n`;
                
                if (passed) passCount++;
            }
            
            result += `ğŸ“Š ç¸½æ¸¬è©¦çµæœ: ${passCount}/${testCases.length} é€šé`;
            
            if (passCount === testCases.length) {
                result += '\n\nğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼å¾Œç¶´åˆ¤æ–·é‚è¼¯æ­£ç¢ºé‹ä½œã€‚';
                resultDiv.className = 'result success';
            } else {
                result += '\n\nâš ï¸ éƒ¨åˆ†æ¸¬è©¦å¤±æ•—ï¼Œéœ€è¦æª¢æŸ¥é‚è¼¯ã€‚';
                resultDiv.className = 'result error';
            }
            
            resultDiv.textContent = result;
        }

        // æ¼”ç¤ºå¢å¼·æ©Ÿåˆ¶
        function demonstrateEnhancement() {
            const resultDiv = document.getElementById('enhancement-result');
            
            const originalData = {
                '2330': { name: 'å°ç©é›»', industry: 'åŠå°é«”æ¥­', market: 'å°è‚¡' },
                '6188': { name: 'å»£æ˜', industry: 'å…¶ä»–é›»å­é¡', market: 'å°è‚¡' },
                '0050': { name: 'å…ƒå¤§å°ç£50', industry: 'ä¸Šå¸‚æŒ‡æ•¸è‚¡ç¥¨å‹åŸºé‡‘(ETF)', market: 'å°è‚¡' },
                '00679B': { name: 'å…ƒå¤§ç¾å‚µ20å¹´', industry: 'ä¸Šæ«ƒæŒ‡æ•¸è‚¡ç¥¨å‹åŸºé‡‘(ETF)', market: 'å°è‚¡' }
            };
            
            let result = 'âš™ï¸ Stock List å‹•æ…‹å¢å¼·æ©Ÿåˆ¶æ¼”ç¤º:\n\n';
            result += 'ğŸ“‹ åŸå§‹è³‡æ–™ â†’ å¢å¼·å¾Œè³‡æ–™\n\n';
            
            for (const [symbol, basicInfo] of Object.entries(originalData)) {
                const enhanced = enhanceStockInfo(symbol, basicInfo);
                
                result += `${symbol} (${basicInfo.name}):\n`;
                result += `  åŸå§‹: {\n`;
                result += `    name: "${basicInfo.name}",\n`;
                result += `    industry: "${basicInfo.industry}",\n`;
                result += `    market: "${basicInfo.market}"\n`;
                result += `  }\n`;
                result += `  å¢å¼·å¾Œ: {\n`;
                result += `    name: "${enhanced.name}",\n`;
                result += `    industry: "${enhanced.industry}",\n`;
                result += `    market: "${enhanced.market}",\n`;
                result += `    marketType: "${enhanced.marketType}",\n`;
                result += `    yahooSuffix: "${enhanced.yahooSuffix}",\n`;
                result += `    fullYahooSymbol: "${enhanced.fullYahooSymbol}",\n`;
                result += `    reasoning: "${enhanced.reasoning}",\n`;
                result += `    enhanced: ${enhanced.enhanced}\n`;
                result += `  }\n\n`;
            }
            
            result += 'âœ… çµè«–: ç³»çµ±æœƒè‡ªå‹•ç‚ºæ¯å€‹è‚¡ç¥¨æ·»åŠ  Yahoo Finance å¾Œç¶´å’Œå¸‚å ´åˆ†é¡';
            
            resultDiv.className = 'result info';
            resultDiv.textContent = result;
        }

        // æ¸¬è©¦è‡ªè¨‚è‚¡ç¥¨ä»£è™Ÿ
        function testCustomSymbol() {
            const input = document.getElementById('custom-symbol');
            const resultDiv = document.getElementById('custom-result');
            const symbol = input.value.trim().toUpperCase();
            
            if (!symbol) {
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ';
                return;
            }
            
            const enhanced = enhanceStockInfo(symbol, { name: `æ¸¬è©¦è‚¡ç¥¨${symbol}` });
            
            let result = `ğŸ” è‡ªè¨‚æ¸¬è©¦çµæœ - ${symbol}:\n\n`;
            result += `å®Œæ•´ Yahoo ç¬¦è™Ÿ: ${enhanced.fullYahooSymbol}\n`;
            result += `å¸‚å ´åˆ†é¡: ${enhanced.marketType}\n`;
            result += `Yahoo å¾Œç¶´: ${enhanced.yahooSuffix}\n`;
            result += `åˆ¤æ–·é‚è¼¯: ${enhanced.reasoning}\n\n`;
            
            // åˆ†æä»£ç¢¼
            const code = parseInt(symbol.substring(0, 4));
            const isBondETF = /^00\d{2,3}B$/i.test(symbol);
            const isETF = /^00\d{2,3}[A-Z]?$/i.test(symbol);
            
            result += `ä»£ç¢¼åˆ†æ:\n`;
            result += `  æ•¸å­—ä»£ç¢¼: ${code}\n`;
            result += `  æ˜¯å¦ç‚ºå‚µåˆ¸ETF: ${isBondETF ? 'æ˜¯' : 'å¦'}\n`;
            result += `  æ˜¯å¦ç‚ºä¸€èˆ¬ETF: ${isETF ? 'æ˜¯' : 'å¦'}\n`;
            result += `  ä»£ç¢¼ç¯„åœ: ${code >= 1000 && code <= 2999 ? 'ä¸Šå¸‚(1000-2999)' : 
                                   code >= 3000 && code <= 8999 ? 'ä¸Šæ«ƒ(3000-8999)' : 'å…¶ä»–'}\n`;
            
            resultDiv.className = 'result success';
            resultDiv.textContent = result;
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œä¸€æ¬¡æ¸¬è©¦
        window.onload = function() {
            runAllTests();
        };
    </script>
</body>
</html>