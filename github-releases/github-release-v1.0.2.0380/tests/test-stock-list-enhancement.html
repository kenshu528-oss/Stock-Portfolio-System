<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock List å¼·åŒ–æ©Ÿåˆ¶æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Stock List å¼·åŒ–æ©Ÿåˆ¶æ¸¬è©¦</h1>
    <p>æ¸¬è©¦å¾ Stock List ç²å–é å®šç¾©çš„ Yahoo Finance å¾Œç¶´</p>
    
    <button onclick="testStockListEnhancement()">æ¸¬è©¦ Stock List å¼·åŒ–</button>
    <button onclick="testSuffixQuery()">æ¸¬è©¦å¾Œç¶´æŸ¥è©¢</button>
    
    <div id="results"></div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        // æ¨¡æ“¬ Stock List å¢å¼·é‚è¼¯
        function enhanceStockInfo(stockId, basicInfo) {
            const code = parseInt(stockId.substring(0, 4));
            const isBondETF = /^00\d{2,3}B$/i.test(stockId);
            const isETF = /^00\d{2,3}[A-Z]?$/i.test(stockId);
            
            let marketType, yahooSuffix, reasoning;
            
            // ç‰¹æ®Šæ¡ˆä¾‹è™•ç†
            const specialCases = {
                '8112': { suffix: '.TW', market: 'ä¸Šæ«ƒ', reason: 'è‡³ä¸Šï¼šé›–åœ¨ 8000 ç¯„åœä½† Yahoo Finance ä½¿ç”¨ .TW' },
                '4585': { suffix: '.TW', market: 'èˆˆæ«ƒ', reason: 'é”æ˜ï¼šèˆˆæ«ƒè‚¡ç¥¨ï¼Œæœ€å¸¸ç”¨ .TW' },
            };
            
            if (specialCases[stockId]) {
                const special = specialCases[stockId];
                marketType = special.market;
                yahooSuffix = special.suffix;
                reasoning = special.reason;
            } else if (isBondETF) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'å‚µåˆ¸ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (isETF) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸€èˆ¬ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 3000 && code <= 8999) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸Šæ«ƒè‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 1000 && code <= 2999) {
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            } else {
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'å…¶ä»–æƒ…æ³ï¼Œé è¨­ä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            }
            
            return {
                ...basicInfo,
                marketType,
                yahooSuffix,
                reasoning,
                enhanced: true
            };
        }

        function testStockListEnhancement() {
            addResult('ğŸ§ª é–‹å§‹æ¸¬è©¦ Stock List å¼·åŒ–æ©Ÿåˆ¶...', 'info');
            
            const testStocks = {
                '00981A': { name: 'ä¸»å‹•çµ±ä¸€å°è‚¡å¢é•·', industry: 'ETF', market: 'å°è‚¡' },
                '0050': { name: 'å…ƒå¤§å°ç£50', industry: 'ETF', market: 'å°è‚¡' },
                '00679B': { name: 'å…ƒå¤§ç¾å‚µ20å¹´', industry: 'å‚µåˆ¸ETF', market: 'å°è‚¡' },
                '2330': { name: 'å°ç©é›»', industry: 'åŠå°é«”', market: 'å°è‚¡' },
                '6188': { name: 'å»£æ˜', industry: 'å…‰é›»', market: 'å°è‚¡' },
                '8112': { name: 'è‡³ä¸Š', industry: 'å…¶ä»–', market: 'å°è‚¡' },
                '4585': { name: 'é”æ˜', industry: 'å…‰é›»', market: 'å°è‚¡' }
            };

            let tableHTML = `
                <table>
                    <tr>
                        <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                        <th>è‚¡ç¥¨åç¨±</th>
                        <th>å¸‚å ´é¡å‹</th>
                        <th>Yahoo å¾Œç¶´</th>
                        <th>åˆ¤æ–·é‚è¼¯</th>
                    </tr>
            `;

            for (const [stockId, basicInfo] of Object.entries(testStocks)) {
                const enhanced = enhanceStockInfo(stockId, basicInfo);
                tableHTML += `
                    <tr>
                        <td>${stockId}</td>
                        <td>${enhanced.name}</td>
                        <td>${enhanced.marketType}</td>
                        <td><strong>${enhanced.yahooSuffix}</strong></td>
                        <td>${enhanced.reasoning}</td>
                    </tr>
                `;
            }

            tableHTML += '</table>';
            addResult('âœ… Stock List å¼·åŒ–æ¸¬è©¦å®Œæˆï¼š' + tableHTML, 'success');
        }

        function testSuffixQuery() {
            addResult('ğŸ” é–‹å§‹æ¸¬è©¦å¾Œç¶´æŸ¥è©¢åŠŸèƒ½...', 'info');
            
            const testCases = [
                { symbol: '00981A', expectedSuffix: '.TWO', type: 'ä¸€èˆ¬ ETF' },
                { symbol: '0050', expectedSuffix: '.TWO', type: 'ä¸€èˆ¬ ETF' },
                { symbol: '00679B', expectedSuffix: '.TWO', type: 'å‚µåˆ¸ ETF' },
                { symbol: '2330', expectedSuffix: '.TW', type: 'ä¸Šå¸‚è‚¡ç¥¨' },
                { symbol: '6188', expectedSuffix: '.TWO', type: 'ä¸Šæ«ƒè‚¡ç¥¨' },
                { symbol: '8112', expectedSuffix: '.TW', type: 'ç‰¹æ®Šæ¡ˆä¾‹' },
                { symbol: '4585', expectedSuffix: '.TW', type: 'ç‰¹æ®Šæ¡ˆä¾‹' }
            ];

            testCases.forEach(testCase => {
                const enhanced = enhanceStockInfo(testCase.symbol, { name: `æ¸¬è©¦${testCase.symbol}` });
                const actualSuffix = enhanced.yahooSuffix;
                const isCorrect = actualSuffix === testCase.expectedSuffix;
                
                addResult(
                    `${testCase.symbol} (${testCase.type}): ${testCase.symbol}${actualSuffix} ${isCorrect ? 'âœ…' : 'âŒ'} (é æœŸ: ${testCase.expectedSuffix})`,
                    isCorrect ? 'success' : 'error'
                );
            });
        }
    </script>
</body>
</html>