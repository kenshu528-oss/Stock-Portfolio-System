<!DOCTYPE html>
<html>
<head>
    <title>GitHub API Ë®∫Êñ∑Â∑•ÂÖ∑</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        input { width: 500px; padding: 5px; margin: 5px; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>GitHub API Ë®∫Êñ∑Â∑•ÂÖ∑</h1>
    
    <div>
        <label>GitHub Token:</label><br>
        <input type="password" id="tokenInput" placeholder="Ëº∏ÂÖ•ÊÇ®ÁöÑ GitHub Token">
        <button onclick="toggleTokenVisibility()">È°ØÁ§∫/Èö±Ëóè</button>
    </div>
    
    <div>
        <button onclick="runDiagnosis()">ÈñãÂßãË®∫Êñ∑</button>
        <button onclick="clearResults()">Ê∏ÖÈô§ÁµêÊûú</button>
    </div>
    
    <div id="results"></div>

    <script>
        function toggleTokenVisibility() {
            const input = document.getElementById('tokenInput');
            input.type = input.type === 'password' ? 'text' : 'password';
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
        
        async function runDiagnosis() {
            const token = document.getElementById('tokenInput').value;
            
            if (!token) {
                addResult('‚ùå Ë´ãËº∏ÂÖ• GitHub Token', 'error');
                return;
            }
            
            clearResults();
            addResult('üîç ÈñãÂßãË®∫Êñ∑...', 'info');
            
            // 1. Ê™¢Êü• Token Ê†ºÂºè
            addResult(`üìã Token Ê†ºÂºèÊ™¢Êü•:`, 'info');
            addResult(`- Èï∑Â∫¶: ${token.length} Â≠óÁ¨¶`, 'info');
            addResult(`- ÈñãÈ†≠: ${token.substring(0, 20)}...`, 'info');
            
            if (token.startsWith('github_pat_')) {
                addResult('‚úÖ Token Ê†ºÂºèÊ≠£Á¢∫ (Fine-grained PAT)', 'success');
            } else if (token.startsWith('ghp_')) {
                addResult('‚úÖ Token Ê†ºÂºèÊ≠£Á¢∫ (Classic PAT)', 'success');
            } else {
                addResult('‚ö†Ô∏è Token Ê†ºÂºèÂèØËÉΩ‰∏çÊ≠£Á¢∫', 'warning');
            }
            
            // 2. Ê∏¨Ë©¶Âü∫Êú¨ API Ë™øÁî®
            addResult('üåê Ê∏¨Ë©¶ GitHub API ÈÄ£Êé•...', 'info');
            
            try {
                // Ê∏¨Ë©¶ token Ê†ºÂºè
                const tokenResponse = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                addResult(`üì° Token Ê†ºÂºèÂõûÊáâ: ${tokenResponse.status} ${tokenResponse.statusText}`, 
                    tokenResponse.ok ? 'success' : 'error');
                
                if (tokenResponse.ok) {
                    const user = await tokenResponse.json();
                    addResult(`‚úÖ Áî®Êà∂È©óË≠âÊàêÂäü: ${user.login} (${user.name || 'No name'})`, 'success');
                    addResult(`üìß Email: ${user.email || 'Êú™ÂÖ¨Èñã'}`, 'info');
                    addResult(`üè¢ ÂÖ¨Âè∏: ${user.company || 'Êú™Ë®≠ÂÆö'}`, 'info');
                    
                    // Ê∏¨Ë©¶ Gist Ê¨äÈôê
                    await testGistPermissions(token);
                    
                } else {
                    const errorData = await tokenResponse.json().catch(() => ({}));
                    addResult(`‚ùå Token È©óË≠âÂ§±Êïó: ${errorData.message || 'Êú™Áü•ÈåØË™§'}`, 'error');
                    
                    // ÂòóË©¶ Bearer Ê†ºÂºè
                    addResult('üîÑ ÂòóË©¶ Bearer Ê†ºÂºè...', 'info');
                    const bearerResponse = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    addResult(`üì° Bearer Ê†ºÂºèÂõûÊáâ: ${bearerResponse.status} ${bearerResponse.statusText}`, 
                        bearerResponse.ok ? 'success' : 'error');
                    
                    if (bearerResponse.ok) {
                        const user = await bearerResponse.json();
                        addResult(`‚úÖ Bearer Ê†ºÂºèÊàêÂäü: ${user.login}`, 'success');
                    }
                }
                
            } catch (error) {
                addResult(`‚ùå Á∂≤Ë∑ØÈåØË™§: ${error.message}`, 'error');
            }
            
            // 3. Ê™¢Êü• API ÈôêÂà∂
            await checkRateLimit(token);
        }
        
        async function testGistPermissions(token) {
            addResult('üîê Ê∏¨Ë©¶ Gist Ê¨äÈôê...', 'info');
            
            try {
                const gistResponse = await fetch('https://api.github.com/gists', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (gistResponse.ok) {
                    const gists = await gistResponse.json();
                    addResult(`‚úÖ Gist Ê¨äÈôêÊ≠£Â∏∏ÔºåÊâæÂà∞ ${gists.length} ÂÄã Gist`, 'success');
                } else {
                    addResult(`‚ùå Gist Ê¨äÈôê‰∏çË∂≥: ${gistResponse.status}`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Gist Ê∏¨Ë©¶ÈåØË™§: ${error.message}`, 'error');
            }
        }
        
        async function checkRateLimit(token) {
            addResult('‚è±Ô∏è Ê™¢Êü• API ÈôêÂà∂...', 'info');
            
            try {
                const rateLimitResponse = await fetch('https://api.github.com/rate_limit', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (rateLimitResponse.ok) {
                    const rateLimit = await rateLimitResponse.json();
                    const core = rateLimit.resources.core;
                    const remaining = core.remaining;
                    const limit = core.limit;
                    const resetTime = new Date(core.reset * 1000);
                    
                    addResult(`üìä API ÈôêÂà∂ÁãÄÊÖã: ${remaining}/${limit} Ââ©È§ò`, 
                        remaining > 100 ? 'success' : remaining > 10 ? 'warning' : 'error');
                    addResult(`üîÑ ÈáçÁΩÆÊôÇÈñì: ${resetTime.toLocaleString()}`, 'info');
                    
                    if (remaining === 0) {
                        addResult('‚ö†Ô∏è API ÈôêÂà∂Â∑≤ÈÅî‰∏äÈôêÔºåÈÄôÂèØËÉΩÊòØ 401 ÈåØË™§ÁöÑÂéüÂõ†ÔºÅ', 'error');
                    }
                } else {
                    addResult(`‚ùå ÁÑ°Ê≥ïÊ™¢Êü• API ÈôêÂà∂: ${rateLimitResponse.status}`, 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå API ÈôêÂà∂Ê™¢Êü•ÈåØË™§: ${error.message}`, 'error');
            }
        }
        
        // Ëá™ÂãïÂ°´ÂÖ• TokenÔºàÂ¶ÇÊûúÂú®ÈñãÁôºÁí∞Â¢ÉÔºâ
        window.addEventListener('load', () => {
            const devToken = 'ghp_PLACEHOLDER_TOKEN_FOR_DEVELOPMENT';
            document.getElementById('tokenInput').value = devToken;
        });
    </script>
</body>
</html>