<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock List å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #005a87;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            background: #f8f8f8;
            border: 1px solid #ddd;
        }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border-color: #bee5eb; color: #0c5460; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Stock List å¾Œç¶´æ©Ÿåˆ¶æ¸¬è©¦</h1>
            <p>æ¸¬è©¦ Stock List å¦‚ä½•å‹•æ…‹æ·»åŠ  Yahoo Finance å¾Œç¶´</p>
            <p><strong>ç‰ˆæœ¬</strong>: v1.0.2.0355</p>
        </div>

        <!-- æ¸¬è©¦ 1ï¼šæª¢æŸ¥åŸå§‹æª”æ¡ˆçµæ§‹ -->
        <div class="test-section">
            <div class="test-title">ğŸ“ æ¸¬è©¦ 1ï¼šæª¢æŸ¥åŸå§‹ Stock List æª”æ¡ˆçµæ§‹</div>
            <p>æª¢æŸ¥ public/stock_list.json çš„åŸå§‹çµæ§‹ï¼Œç¢ºèªæ˜¯å¦åŒ…å«å¾Œç¶´è³‡è¨Š</p>
            <button class="test-button" onclick="testOriginalFile()">æª¢æŸ¥åŸå§‹æª”æ¡ˆ</button>
            <div id="result1" class="result" style="display:none;"></div>
        </div>

        <!-- æ¸¬è©¦ 2ï¼šæ¸¬è©¦å‹•æ…‹å¢å¼·æ©Ÿåˆ¶ -->
        <div class="test-section">
            <div class="test-title">âš™ï¸ æ¸¬è©¦ 2ï¼šæ¸¬è©¦å‹•æ…‹å¢å¼·æ©Ÿåˆ¶</div>
            <p>æ¸¬è©¦ stockListService å¦‚ä½•å‹•æ…‹æ·»åŠ å¾Œç¶´å’Œå¸‚å ´åˆ†é¡</p>
            <button class="test-button" onclick="testEnhancementMechanism()">æ¸¬è©¦å¢å¼·æ©Ÿåˆ¶</button>
            <div id="result2" class="result" style="display:none;"></div>
        </div>

        <!-- æ¸¬è©¦ 3ï¼šæ¸¬è©¦å¾Œç¶´åˆ¤æ–·é‚è¼¯ -->
        <div class="test-section">
            <div class="test-title">ğŸ¯ æ¸¬è©¦ 3ï¼šæ¸¬è©¦å¾Œç¶´åˆ¤æ–·é‚è¼¯</div>
            <p>æ¸¬è©¦ä¸åŒè‚¡ç¥¨ä»£ç¢¼çš„å¾Œç¶´åˆ¤æ–·é‚è¼¯</p>
            <button class="test-button" onclick="testSuffixLogic()">æ¸¬è©¦å¾Œç¶´é‚è¼¯</button>
            <div id="result3" class="result" style="display:none;"></div>
        </div>

        <!-- æ¸¬è©¦ 4ï¼šæ¸¬è©¦å¯¦éš›ä½¿ç”¨æµç¨‹ -->
        <div class="test-section">
            <div class="test-title">ğŸ”„ æ¸¬è©¦ 4ï¼šæ¸¬è©¦å¯¦éš›ä½¿ç”¨æµç¨‹</div>
            <p>æ¸¬è©¦å¾è¼‰å…¥åˆ°ä½¿ç”¨çš„å®Œæ•´æµç¨‹</p>
            <button class="test-button" onclick="testCompleteFlow()">æ¸¬è©¦å®Œæ•´æµç¨‹</button>
            <div id="result4" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        // æ¸¬è©¦ 1ï¼šæª¢æŸ¥åŸå§‹æª”æ¡ˆçµæ§‹
        async function testOriginalFile() {
            const resultDiv = document.getElementById('result1');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ” æ­£åœ¨æª¢æŸ¥åŸå§‹æª”æ¡ˆ...';

            try {
                const response = await fetch('../public/stock_list.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                // æª¢æŸ¥å¹¾å€‹æ¨£æœ¬è‚¡ç¥¨
                const samples = ['2330', '6188', '0050', '00679B'];
                let result = `ğŸ“Š åŸå§‹æª”æ¡ˆçµæ§‹åˆ†æï¼š\n\n`;
                result += `ğŸ“… è³‡æ–™æ—¥æœŸ: ${data.date}\n`;
                result += `ğŸ“ˆ è‚¡ç¥¨ç¸½æ•¸: ${data.count}\n\n`;
                result += `ğŸ” æ¨£æœ¬è‚¡ç¥¨æª¢æŸ¥ï¼š\n`;

                for (const symbol of samples) {
                    const stock = data.stocks[symbol];
                    if (stock) {
                        result += `\n${symbol} (${stock.name}):\n`;
                        result += `  - industry: ${stock.industry}\n`;
                        result += `  - market: ${stock.market}\n`;
                        result += `  - yahooSuffix: ${stock.yahooSuffix || 'âŒ æœªå®šç¾©'}\n`;
                        result += `  - marketType: ${stock.marketType || 'âŒ æœªå®šç¾©'}\n`;
                    } else {
                        result += `\n${symbol}: âŒ ä¸å­˜åœ¨\n`;
                    }
                }

                result += `\n\nâœ… çµè«–ï¼šåŸå§‹æª”æ¡ˆåªåŒ…å«åŸºæœ¬è³‡è¨Šï¼ˆname, industry, marketï¼‰`;
                result += `\nâŒ åŸå§‹æª”æ¡ˆä¸åŒ…å« yahooSuffix å’Œ marketType`;
                result += `\nğŸ’¡ é€™äº›è³‡è¨Šéœ€è¦é€éå‹•æ…‹å¢å¼·æ©Ÿåˆ¶æ·»åŠ `;

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æª¢æŸ¥å¤±æ•—: ${error.message}`;
            }
        }

        // æ¸¬è©¦ 2ï¼šæ¸¬è©¦å‹•æ…‹å¢å¼·æ©Ÿåˆ¶
        async function testEnhancementMechanism() {
            const resultDiv = document.getElementById('result2');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'âš™ï¸ æ­£åœ¨æ¸¬è©¦å¢å¼·æ©Ÿåˆ¶...';

            try {
                // æ¨¡æ“¬å¢å¼·é‚è¼¯
                const testCases = [
                    { symbol: '2330', name: 'å°ç©é›»' },
                    { symbol: '6188', name: 'å»£æ˜' },
                    { symbol: '0050', name: 'å…ƒå¤§å°ç£50' },
                    { symbol: '00679B', name: 'å…ƒå¤§ç¾å‚µ20å¹´' },
                    { symbol: '8112', name: 'è‡³ä¸Š' },
                    { symbol: '4585', name: 'é”æ˜' }
                ];

                let result = `âš™ï¸ å‹•æ…‹å¢å¼·æ©Ÿåˆ¶æ¸¬è©¦ï¼š\n\n`;

                for (const testCase of testCases) {
                    const enhanced = enhanceStockInfo(testCase.symbol, testCase);
                    result += `${testCase.symbol} (${testCase.name}):\n`;
                    result += `  åŸå§‹: { name: "${testCase.name}" }\n`;
                    result += `  å¢å¼·å¾Œ:\n`;
                    result += `    - marketType: ${enhanced.marketType}\n`;
                    result += `    - yahooSuffix: ${enhanced.yahooSuffix}\n`;
                    result += `    - reasoning: ${enhanced.reasoning}\n\n`;
                }

                result += `âœ… çµè«–ï¼šç³»çµ±æœƒå‹•æ…‹ç‚ºæ¯å€‹è‚¡ç¥¨æ·»åŠ å¾Œç¶´å’Œå¸‚å ´åˆ†é¡`;

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${error.message}`;
            }
        }

        // æ¨¡æ“¬å¢å¼·é‚è¼¯
        function enhanceStockInfo(stockId, basicInfo) {
            const code = parseInt(stockId.substring(0, 4));
            const isBondETF = /^00\d{2,3}B$/i.test(stockId);
            const isETF = /^00\d{2,3}[A-Z]?$/i.test(stockId);
            
            let marketType, yahooSuffix, reasoning;
            
            // ç‰¹æ®Šæ¡ˆä¾‹è™•ç†
            const specialCases = {
                '8112': { suffix: '.TW', market: 'ä¸Šæ«ƒ', reason: 'è‡³ä¸Šï¼šé›–åœ¨ 8000 ç¯„åœä½† Yahoo Finance ä½¿ç”¨ .TW' },
                '4585': { suffix: '.TW', market: 'èˆˆæ«ƒ', reason: 'é”æ˜ï¼šèˆˆæ«ƒè‚¡ç¥¨ï¼Œæœ€å¸¸ç”¨ .TW' },
            };
            
            if (specialCases[stockId]) {
                const special = specialCases[stockId];
                marketType = special.market;
                yahooSuffix = special.suffix;
                reasoning = special.reason;
            } else if (isBondETF) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'å‚µåˆ¸ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (isETF) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸€èˆ¬ ETFï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 3000 && code <= 8999) {
                marketType = 'ä¸Šæ«ƒ';
                yahooSuffix = '.TWO';
                reasoning = 'ä¸Šæ«ƒè‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨æ«ƒè²·ä¸­å¿ƒ (.TWO)';
            } else if (code >= 1000 && code <= 2999) {
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'ä¸Šå¸‚è‚¡ç¥¨ï¼Œå„ªå…ˆä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            } else {
                marketType = 'ä¸Šå¸‚';
                yahooSuffix = '.TW';
                reasoning = 'å…¶ä»–æƒ…æ³ï¼Œé è¨­ä½¿ç”¨è­‰äº¤æ‰€ (.TW)';
            }
            
            return {
                ...basicInfo,
                marketType,
                yahooSuffix,
                reasoning,
                enhanced: true
            };
        }

        // æ¸¬è©¦ 3ï¼šæ¸¬è©¦å¾Œç¶´åˆ¤æ–·é‚è¼¯
        function testSuffixLogic() {
            const resultDiv = document.getElementById('result3');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            const testCases = [
                // ä¸Šå¸‚è‚¡ç¥¨
                { symbol: '2330', expected: '.TW', category: 'ä¸Šå¸‚è‚¡ç¥¨' },
                { symbol: '2886', expected: '.TW', category: 'ä¸Šå¸‚è‚¡ç¥¨' },
                
                // ä¸Šæ«ƒè‚¡ç¥¨
                { symbol: '6188', expected: '.TWO', category: 'ä¸Šæ«ƒè‚¡ç¥¨' },
                { symbol: '3687', expected: '.TWO', category: 'ä¸Šæ«ƒè‚¡ç¥¨' },
                
                // ETF
                { symbol: '0050', expected: '.TWO', category: 'ä¸€èˆ¬ETF' },
                { symbol: '00646', expected: '.TWO', category: 'ä¸€èˆ¬ETF' },
                
                // å‚µåˆ¸ETF
                { symbol: '00679B', expected: '.TWO', category: 'å‚µåˆ¸ETF' },
                { symbol: '00835B', expected: '.TWO', category: 'å‚µåˆ¸ETF' },
                
                // ç‰¹æ®Šæ¡ˆä¾‹
                { symbol: '8112', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹' },
                { symbol: '4585', expected: '.TW', category: 'ç‰¹æ®Šæ¡ˆä¾‹' }
            ];

            let result = `ğŸ¯ å¾Œç¶´åˆ¤æ–·é‚è¼¯æ¸¬è©¦ï¼š\n\n`;
            let passCount = 0;

            for (const testCase of testCases) {
                const enhanced = enhanceStockInfo(testCase.symbol, { name: `æ¸¬è©¦${testCase.symbol}` });
                const passed = enhanced.yahooSuffix === testCase.expected;
                
                result += `${testCase.symbol} (${testCase.category}):\n`;
                result += `  é æœŸ: ${testCase.expected}\n`;
                result += `  å¯¦éš›: ${enhanced.yahooSuffix}\n`;
                result += `  çµæœ: ${passed ? 'âœ… é€šé' : 'âŒ å¤±æ•—'}\n`;
                result += `  é‚è¼¯: ${enhanced.reasoning}\n\n`;
                
                if (passed) passCount++;
            }

            result += `ğŸ“Š æ¸¬è©¦çµæœ: ${passCount}/${testCases.length} é€šé`;

            resultDiv.className = passCount === testCases.length ? 'result success' : 'result warning';
            resultDiv.textContent = result;
        }

        // æ¸¬è©¦ 4ï¼šæ¸¬è©¦å®Œæ•´æµç¨‹
        async function testCompleteFlow() {
            const resultDiv = document.getElementById('result4');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æ¸¬è©¦å®Œæ•´æµç¨‹...';

            try {
                let result = `ğŸ”„ Stock List å¾Œç¶´æ©Ÿåˆ¶å®Œæ•´æµç¨‹ï¼š\n\n`;

                // æ­¥é©Ÿ 1ï¼šè¼‰å…¥åŸå§‹è³‡æ–™
                result += `æ­¥é©Ÿ 1: è¼‰å…¥åŸå§‹è³‡æ–™\n`;
                result += `  - å¾ public/stock_list.json è¼‰å…¥åŸºæœ¬è³‡è¨Š\n`;
                result += `  - åªåŒ…å«: name, industry, market\n`;
                result += `  - ä¸åŒ…å«: yahooSuffix, marketType\n\n`;

                // æ­¥é©Ÿ 2ï¼šå‹•æ…‹å¢å¼·
                result += `æ­¥é©Ÿ 2: å‹•æ…‹å¢å¼·è™•ç†\n`;
                result += `  - å‘¼å« enhanceStockList() æ–¹æ³•\n`;
                result += `  - å°æ¯å€‹è‚¡ç¥¨åŸ·è¡Œ enhanceStockInfo()\n`;
                result += `  - æ ¹æ“šè‚¡ç¥¨ä»£ç¢¼åˆ¤æ–·å¾Œç¶´å’Œå¸‚å ´åˆ†é¡\n\n`;

                // æ­¥é©Ÿ 3ï¼šå¾Œç¶´åˆ¤æ–·é‚è¼¯
                result += `æ­¥é©Ÿ 3: å¾Œç¶´åˆ¤æ–·é‚è¼¯\n`;
                result += `  - ç‰¹æ®Šæ¡ˆä¾‹: 8112â†’.TW, 4585â†’.TW\n`;
                result += `  - å‚µåˆ¸ETF (00XXXB): â†’.TWO\n`;
                result += `  - ä¸€èˆ¬ETF (00XXX): â†’.TWO\n`;
                result += `  - ä¸Šæ«ƒè‚¡ç¥¨ (3000-8999): â†’.TWO\n`;
                result += `  - ä¸Šå¸‚è‚¡ç¥¨ (1000-2999): â†’.TW\n`;
                result += `  - å…¶ä»–: â†’.TW (é è¨­)\n\n`;

                // æ­¥é©Ÿ 4ï¼šå¯¦éš›ä½¿ç”¨
                result += `æ­¥é©Ÿ 4: å¯¦éš›ä½¿ç”¨\n`;
                result += `  - getYahooSuffix(symbol) ç²å–å¾Œç¶´\n`;
                result += `  - getYahooSymbol(symbol) ç²å–å®Œæ•´ç¬¦è™Ÿ\n`;
                result += `  - è‚¡åƒ¹æœå‹™ä½¿ç”¨å¢å¼·å¾Œçš„è³‡è¨Š\n\n`;

                // æ¸¬è©¦å¯¦éš›æ¡ˆä¾‹
                const testSymbol = '6188';
                const enhanced = enhanceStockInfo(testSymbol, { name: 'å»£æ˜' });
                
                result += `ğŸ§ª å¯¦éš›æ¡ˆä¾‹æ¸¬è©¦ (${testSymbol}):\n`;
                result += `  åŸå§‹è³‡æ–™: { name: "å»£æ˜", industry: "...", market: "å°è‚¡" }\n`;
                result += `  å¢å¼·å¾Œ:\n`;
                result += `    - marketType: ${enhanced.marketType}\n`;
                result += `    - yahooSuffix: ${enhanced.yahooSuffix}\n`;
                result += `    - reasoning: ${enhanced.reasoning}\n`;
                result += `  æœ€çµ‚ Yahoo ç¬¦è™Ÿ: ${testSymbol}${enhanced.yahooSuffix}\n\n`;

                result += `âœ… çµè«–ï¼š\n`;
                result += `  1. åŸå§‹æª”æ¡ˆä¸åŒ…å«å¾Œç¶´è³‡è¨Š\n`;
                result += `  2. ç³»çµ±å‹•æ…‹è¨ˆç®—ä¸¦æ·»åŠ å¾Œç¶´\n`;
                result += `  3. åŸºæ–¼è‚¡ç¥¨ä»£ç¢¼ç¯„åœå’Œé¡å‹åˆ¤æ–·\n`;
                result += `  4. æ”¯æ´ç‰¹æ®Šæ¡ˆä¾‹è™•ç†\n`;
                result += `  5. æä¾›å®Œæ•´çš„æ¨ç†éç¨‹`;

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${error.message}`;
            }
        }
    </script>
</body>
</html>