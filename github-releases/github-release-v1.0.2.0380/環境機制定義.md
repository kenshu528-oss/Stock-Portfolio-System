# ç’°å¢ƒæ©Ÿåˆ¶å®šç¾©æ–‡æª”

## ğŸ¯ ç’°å¢ƒåˆ†é¡

### 1. æœ¬æ©Ÿç«¯ç’°å¢ƒ (Local Development)
**è­˜åˆ¥æ¢ä»¶**ï¼š
```typescript
const isLocalhost = window.location.hostname === 'localhost' || 
                   window.location.hostname === '127.0.0.1' ||
                   window.location.hostname === '0.0.0.0';
```

**ç‰¹å¾µ**ï¼š
- URL: `http://localhost:5173` (Vite é–‹ç™¼æœå‹™å™¨)
- ç’°å¢ƒè®Šæ•¸: `import.meta.env.DEV === true`
- å¾Œç«¯æœå‹™: `http://localhost:3001` (Node.js å¾Œç«¯)

### 2. é›²ç«¯ç’°å¢ƒ (Cloud Production)
**è­˜åˆ¥æ¢ä»¶**ï¼š
```typescript
const isCloudEnvironment = !isLocalhost;
```

**å­åˆ†é¡**ï¼š
- **GitHub Pages**: `*.github.io`
- **Netlify**: `*.netlify.app`
- **å…¶ä»–é›²ç«¯å¹³å°**

## ğŸ”§ è‚¡åƒ¹ç²å–æ©Ÿåˆ¶

### æœ¬æ©Ÿç«¯æ©Ÿåˆ¶
```typescript
if (shouldUseBackendProxy()) {
  // ä½¿ç”¨å¾Œç«¯ä»£ç†æœå‹™
  const { StockPriceService } = await import('../services/stockPriceService');
  const stockPriceService = new StockPriceService();
  priceData = await stockPriceService.getStockPrice(symbol);
}
```

**æµç¨‹**ï¼š
```
è‚¡ç¥¨ä»£ç¢¼ â†’ StockPriceService â†’ å¾Œç«¯ API (localhost:3001) â†’ Yahoo Finance â†’ è¿”å›è‚¡åƒ¹
```

**å„ªå‹¢**ï¼š
- âœ… ç„¡ CORS å•é¡Œ
- âœ… ç©©å®šå¯é 
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†
- âœ… æ”¯æ´æ‰¹æ¬¡è™•ç†

### é›²ç«¯æ©Ÿåˆ¶
```typescript
if (!shouldUseBackendProxy()) {
  // ä½¿ç”¨é›²ç«¯è‚¡åƒ¹æœå‹™
  const { cloudStockPriceService } = await import('../services/cloudStockPriceService');
  priceData = await cloudStockPriceService.getStockPrice(symbol);
}
```

**æµç¨‹**ï¼š
```
è‚¡ç¥¨ä»£ç¢¼ â†’ cloudStockPriceService â†’ å¤šé‡ä»£ç†æœå‹™ â†’ Yahoo Finance â†’ è¿”å›è‚¡åƒ¹
```

**ä»£ç†æœå‹™é †åº**ï¼š
1. AllOrigins (`https://api.allorigins.win/get?url=`)
2. CodeTabs (`https://api.codetabs.com/v1/proxy?quest=`)
3. ThingProxy (`https://thingproxy.freeboard.io/fetch/`)
4. æœ¬æ©Ÿç«¯ API (å‚™æ´)

## ğŸ“Š ç’°å¢ƒæª¢æ¸¬é‚è¼¯

### shouldUseBackendProxy() å‡½æ•¸
```typescript
export const shouldUseBackendProxy = (): boolean => {
  const isLocalhost = window.location.hostname === 'localhost' || 
                     window.location.hostname === '127.0.0.1' ||
                     window.location.hostname === '0.0.0.0';
  
  if (isLocalhost) {
    return true;  // æœ¬æ©Ÿç«¯ï¼šä½¿ç”¨å¾Œç«¯ä»£ç†
  }
  
  return false;   // é›²ç«¯ç’°å¢ƒï¼šä½¿ç”¨é›²ç«¯æœå‹™
};
```

### ç’°å¢ƒè³‡è¨Šç²å–
```typescript
export const getEnvironmentInfo = () => {
  const hostname = window.location.hostname;
  const isDevelopment = !import.meta.env.PROD;
  const isLocalhost = hostname === 'localhost' || 
                     hostname === '127.0.0.1' || 
                     hostname === '0.0.0.0';
  const isGitHubPages = hostname.includes('github.io');
  const isNetlify = hostname.includes('netlify.app');
  
  return {
    hostname,
    isDevelopment,
    isLocalhost,
    isGitHubPages,
    isNetlify,
    environment: isLocalhost ? 'local' : 
                isGitHubPages ? 'github-pages' : 
                isNetlify ? 'netlify' : 'unknown',
    useBackendProxy: shouldUseBackendProxy()
  };
};
```

## ğŸ”„ æ›´æ–°æ©Ÿåˆ¶çµ±ä¸€

### å³ä¸Šè§’æ›´æ–° (updateAllStockPrices)
```typescript
const { shouldUseBackendProxy } = await import('../config/api');

if (shouldUseBackendProxy()) {
  // æœ¬æ©Ÿç«¯ï¼šä½¿ç”¨å¾Œç«¯ä»£ç†
  const { StockPriceService } = await import('../services/stockPriceService');
  priceData = await stockPriceService.getStockPrice(symbol);
} else {
  // é›²ç«¯ç’°å¢ƒï¼šä½¿ç”¨é›²ç«¯æœå‹™
  const { cloudStockPriceService } = await import('../services/cloudStockPriceService');
  priceData = await cloudStockPriceService.getStockPrice(symbol);
}
```

### å€‹è‚¡æ›´æ–° (handleUpdatePrice)
```typescript
// v1.0.2.0353 ä¿®å¾©ï¼šä½¿ç”¨èˆ‡å³ä¸Šè§’ç›¸åŒçš„é‚è¼¯
const { shouldUseBackendProxy } = await import('../config/api');

if (shouldUseBackendProxy()) {
  // æœ¬æ©Ÿç«¯ï¼šä½¿ç”¨å¾Œç«¯ä»£ç†
  const { StockPriceService } = await import('../services/stockPriceService');
  priceData = await stockPriceService.getStockPrice(symbol);
} else {
  // é›²ç«¯ç’°å¢ƒï¼šä½¿ç”¨é›²ç«¯æœå‹™
  const { cloudStockPriceService } = await import('../services/cloudStockPriceService');
  priceData = await cloudStockPriceService.getStockPrice(symbol);
}
```

## ğŸ“‹ æœå‹™å°æ¯”è¡¨

| ç‰¹æ€§ | æœ¬æ©Ÿç«¯ (StockPriceService) | é›²ç«¯ (cloudStockPriceService) |
|------|---------------------------|------------------------------|
| **ç’°å¢ƒ** | localhost:5173 | GitHub Pages, Netlify |
| **å¾Œç«¯** | localhost:3001 | ç„¡å¾Œç«¯ |
| **CORS** | ç„¡å•é¡Œ | ä½¿ç”¨ä»£ç†è§£æ±º |
| **ç©©å®šæ€§** | é«˜ | ä¸­ï¼ˆä¾è³´ç¬¬ä¸‰æ–¹ä»£ç†ï¼‰ |
| **é€Ÿåº¦** | å¿« | ä¸­ï¼ˆå¤šé‡å˜—è©¦ï¼‰ |
| **å‚™æ´** | å¾Œç«¯å…§å»º | 4 å€‹ä»£ç†æœå‹™ |
| **ç¶­è­·** | éœ€è¦å¾Œç«¯æœå‹™å™¨ | ç´”å‰ç«¯ |

## ğŸ§ª ç’°å¢ƒæ¸¬è©¦

### æœ¬æ©Ÿç«¯æ¸¬è©¦
```javascript
// åœ¨ç€è¦½å™¨ Console ä¸­åŸ·è¡Œ
console.log('ç’°å¢ƒæª¢æ¸¬:', {
  hostname: window.location.hostname,
  shouldUseBackendProxy: shouldUseBackendProxy(),
  environment: window.location.hostname === 'localhost' ? 'æœ¬æ©Ÿç«¯' : 'é›²ç«¯'
});
```

### é›²ç«¯æ¸¬è©¦
```javascript
// éƒ¨ç½²åˆ° GitHub Pages å¾Œæ¸¬è©¦
console.log('ç’°å¢ƒæª¢æ¸¬:', {
  hostname: window.location.hostname,
  shouldUseBackendProxy: shouldUseBackendProxy(),
  environment: window.location.hostname.includes('github.io') ? 'GitHub Pages' : 'å…¶ä»–é›²ç«¯'
});
```

## ğŸ”§ é…ç½®å»ºè­°

### é–‹ç™¼ç’°å¢ƒé…ç½®
```bash
# .env.local
VITE_API_BASE_URL=http://localhost:3001
VITE_ENVIRONMENT=development
```

### ç”Ÿç”¢ç’°å¢ƒé…ç½®
```bash
# GitHub Pages / Netlify
VITE_ENVIRONMENT=production
# ä¸éœ€è¦ VITE_API_BASE_URLï¼ˆä½¿ç”¨ä»£ç†æœå‹™ï¼‰
```

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### 1. æœ¬æ©Ÿç«¯å¾Œç«¯æœå‹™æœªå•Ÿå‹•
**ç—‡ç‹€**ï¼š`shouldUseBackendProxy()` è¿”å› `true`ï¼Œä½†å¾Œç«¯ API èª¿ç”¨å¤±æ•—
**è§£æ±º**ï¼šå•Ÿå‹•å¾Œç«¯æœå‹™ `npm run dev:backend` æˆ– `node backend/server.js`

### 2. é›²ç«¯ä»£ç†æœå‹™å¤±æ•ˆ
**ç—‡ç‹€**ï¼šæ‰€æœ‰ä»£ç†æœå‹™éƒ½è¿”å›éŒ¯èª¤
**è§£æ±º**ï¼šæª¢æŸ¥ä»£ç†æœå‹™ç‹€æ…‹ï¼Œæˆ–æ·»åŠ æ–°çš„ä»£ç†æœå‹™

### 3. ç’°å¢ƒæª¢æ¸¬éŒ¯èª¤
**ç—‡ç‹€**ï¼šåœ¨éŒ¯èª¤ç’°å¢ƒä½¿ç”¨éŒ¯èª¤æœå‹™
**è§£æ±º**ï¼šæª¢æŸ¥ `shouldUseBackendProxy()` é‚è¼¯ï¼Œç¢ºèª hostname æª¢æ¸¬æ­£ç¢º

## ğŸ’¡ æœ€ä½³å¯¦è¸

### 1. ç’°å¢ƒä¸€è‡´æ€§
- ç¢ºä¿å…©å€‹æ›´æ–°å…¥å£ä½¿ç”¨ç›¸åŒçš„ç’°å¢ƒæª¢æ¸¬é‚è¼¯
- çµ±ä¸€éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„

### 2. å‚™æ´æ©Ÿåˆ¶
- æœ¬æ©Ÿç«¯ï¼šå¾Œç«¯æœå‹™ + é›²ç«¯æœå‹™å‚™æ´
- é›²ç«¯ï¼šå¤šå€‹ä»£ç†æœå‹™ + é™ç´šè™•ç†

### 3. èª¿è©¦å‹å¥½
- è©³ç´°çš„ç’°å¢ƒè³‡è¨Šæ—¥èªŒ
- æ¸…æ¥šçš„æœå‹™é¸æ“‡é‚è¼¯
- ç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤ä¿¡æ¯

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0.0  
**å»ºç«‹æ—¥æœŸ**: 2026-01-28  
**é©ç”¨ç‰ˆæœ¬**: v1.0.2.0353+