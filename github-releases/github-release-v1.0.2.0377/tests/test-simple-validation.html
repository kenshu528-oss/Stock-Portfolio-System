<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–®é©—è­‰æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ç°¡å–®é©—è­‰æ¸¬è©¦</h1>
        <p>æ¸¬è©¦åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        
        <h3>æ¸¬è©¦ 1ï¼šåŸºæœ¬ JavaScript åŠŸèƒ½</h3>
        <button onclick="testBasicJS()">æ¸¬è©¦ JavaScript</button>
        <div id="js-result"></div>
        
        <h3>æ¸¬è©¦ 2ï¼šæª”æ¡ˆè·¯å¾‘æ¸¬è©¦</h3>
        <button onclick="testFilePaths()">æ¸¬è©¦æª”æ¡ˆè·¯å¾‘</button>
        <div id="path-result"></div>
        
        <h3>æ¸¬è©¦ 3ï¼šStock List è¼‰å…¥æ¸¬è©¦</h3>
        <button onclick="testStockListLoad()">æ¸¬è©¦ Stock List</button>
        <div id="stock-result"></div>
        
        <h3>æ¸¬è©¦ 4ï¼šå¾Œç¶´é‚è¼¯æ¸¬è©¦</h3>
        <button onclick="testSuffixLogic()">æ¸¬è©¦å¾Œç¶´é‚è¼¯</button>
        <div id="suffix-result"></div>
    </div>

    <script>
        // æ¸¬è©¦ 1ï¼šåŸºæœ¬ JavaScript åŠŸèƒ½
        function testBasicJS() {
            const resultDiv = document.getElementById('js-result');
            try {
                const testData = {
                    timestamp: new Date().toISOString(),
                    browser: navigator.userAgent,
                    location: window.location.href
                };
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    âœ… JavaScript æ­£å¸¸å·¥ä½œ<br>
                    æ™‚é–“: ${testData.timestamp}<br>
                    ä½ç½®: ${testData.location}
                `;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ JavaScript éŒ¯èª¤: ${error.message}`;
            }
        }

        // æ¸¬è©¦ 2ï¼šæª”æ¡ˆè·¯å¾‘æ¸¬è©¦
        async function testFilePaths() {
            const resultDiv = document.getElementById('path-result');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ğŸ” æ¸¬è©¦æª”æ¡ˆè·¯å¾‘...';
            
            const pathsToTest = [
                '../public/stock_list.json',  // æ­£ç¢ºè·¯å¾‘ï¼štests/../public/
                '../../public/stock_list.json', // å‚™ç”¨è·¯å¾‘
                '../stock_list.json',         // å¦‚æœåœ¨æ ¹ç›®éŒ„
                '/stock_list.json'            // çµ•å°è·¯å¾‘
            ];
            
            let results = 'ğŸ“ æª”æ¡ˆè·¯å¾‘æ¸¬è©¦çµæœ:\n\n';
            
            for (const path of pathsToTest) {
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    results += `${path}: ${response.ok ? 'âœ… å¯è¨ªå•' : 'âŒ ç„¡æ³•è¨ªå• (' + response.status + ')'}\n`;
                } catch (error) {
                    results += `${path}: âŒ éŒ¯èª¤ (${error.message})\n`;
                }
            }
            
            resultDiv.className = 'test-result info';
            resultDiv.style.whiteSpace = 'pre-wrap';
            resultDiv.textContent = results;
        }

        // æ¸¬è©¦ 3ï¼šStock List è¼‰å…¥æ¸¬è©¦
        async function testStockListLoad() {
            const resultDiv = document.getElementById('stock-result');
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'ğŸ“Š è¼‰å…¥ Stock List...';
            
            try {
                // å˜—è©¦ä¸åŒè·¯å¾‘
                let data = null;
                let successPath = null;
                
                const paths = ['../public/stock_list.json', '../../public/stock_list.json', '../stock_list.json'];
                
                for (const path of paths) {
                    try {
                        const response = await fetch(path);
                        if (response.ok) {
                            data = await response.json();
                            successPath = path;
                            break;
                        }
                    } catch (e) {
                        continue;
                    }
                }
                
                if (data) {
                    const sampleStocks = ['2330', '6188', '0050', '00679B'];
                    let result = `âœ… Stock List è¼‰å…¥æˆåŠŸ\n`;
                    result += `è·¯å¾‘: ${successPath}\n`;
                    result += `æ—¥æœŸ: ${data.date}\n`;
                    result += `ç¸½æ•¸: ${data.count}\n\n`;
                    result += `æ¨£æœ¬è‚¡ç¥¨:\n`;
                    
                    for (const symbol of sampleStocks) {
                        const stock = data.stocks[symbol];
                        if (stock) {
                            result += `${symbol}: ${stock.name} (${stock.industry})\n`;
                        }
                    }
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.style.whiteSpace = 'pre-wrap';
                    resultDiv.textContent = result;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.textContent = 'âŒ ç„¡æ³•è¼‰å…¥ Stock List';
                }
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ è¼‰å…¥éŒ¯èª¤: ${error.message}`;
            }
        }

        // æ¸¬è©¦ 4ï¼šå¾Œç¶´é‚è¼¯æ¸¬è©¦
        function testSuffixLogic() {
            const resultDiv = document.getElementById('suffix-result');
            
            // æ¨¡æ“¬å¾Œç¶´åˆ¤æ–·é‚è¼¯
            function getSuffix(symbol) {
                const code = parseInt(symbol.substring(0, 4));
                const isBondETF = /^00\d{2,3}B$/i.test(symbol);
                const isETF = /^00\d{2,3}[A-Z]?$/i.test(symbol);
                
                // ç‰¹æ®Šæ¡ˆä¾‹
                if (symbol === '8112') return '.TW';
                if (symbol === '4585') return '.TW';
                
                if (isBondETF) return '.TWO';
                if (isETF) return '.TWO';
                if (code >= 3000 && code <= 8999) return '.TWO';
                if (code >= 1000 && code <= 2999) return '.TW';
                return '.TW';
            }
            
            const testCases = [
                { symbol: '2330', expected: '.TW', name: 'å°ç©é›»' },
                { symbol: '6188', expected: '.TWO', name: 'å»£æ˜' },
                { symbol: '0050', expected: '.TWO', name: 'å…ƒå¤§å°ç£50' },
                { symbol: '00679B', expected: '.TWO', name: 'å…ƒå¤§ç¾å‚µ20å¹´' },
                { symbol: '8112', expected: '.TW', name: 'è‡³ä¸Š' },
                { symbol: '4585', expected: '.TW', name: 'é”æ˜' }
            ];
            
            let result = 'ğŸ¯ å¾Œç¶´é‚è¼¯æ¸¬è©¦çµæœ:\n\n';
            let passCount = 0;
            
            for (const testCase of testCases) {
                const actual = getSuffix(testCase.symbol);
                const passed = actual === testCase.expected;
                
                result += `${testCase.symbol} (${testCase.name}):\n`;
                result += `  é æœŸ: ${testCase.expected}, å¯¦éš›: ${actual} ${passed ? 'âœ…' : 'âŒ'}\n\n`;
                
                if (passed) passCount++;
            }
            
            result += `ğŸ“Š æ¸¬è©¦çµæœ: ${passCount}/${testCases.length} é€šé`;
            
            resultDiv.className = passCount === testCases.length ? 'test-result success' : 'test-result error';
            resultDiv.style.whiteSpace = 'pre-wrap';
            resultDiv.textContent = result;
        }
    </script>
</body>
</html>